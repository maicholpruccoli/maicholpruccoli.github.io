"use strict";(self.webpackChunkwelcome_sbm=self.webpackChunkwelcome_sbm||[]).push([[616],{29735:(At,$,_)=>{_.d($,{h:()=>w});var t=_(65879),D=_(96485),U=_(30724),f=_(96814),k=_(56223),c=_(84187),tt=_(42400);const R=function(L){return{border:L}};class w{constructor(){this.valueChange=new t.vpe,this.colorChanged=new t.vpe}ngAfterViewInit(){this.colorPickerDirective&&(this.colorPickerDirective.cpPosition="bottom",this.colorPickerDirective.cpUseRootViewContainer=!0,this.options&&(this.options.width&&(this.colorPickerDirective.cpWidth=this.options.width),this.options.height&&(this.colorPickerDirective.cpHeight=this.options.height),this.options.dialogDisplay&&(this.colorPickerDirective.cpDialogDisplay=this.options.dialogDisplay),this.options.position&&(this.colorPickerDirective.cpPosition=this.options.position),this.options.positionOffset&&(this.colorPickerDirective.cpPositionOffset=this.options.positionOffset),this.options.positionRelativeToArrow&&(this.colorPickerDirective.cpPositionRelativeToArrow=this.options.positionRelativeToArrow),null!=this.options.useRootViewContainer&&(this.colorPickerDirective.cpUseRootViewContainer=this.options.useRootViewContainer)))}}w.\u0275fac=function(b){return new(b||w)},w.\u0275cmp=t.Xpm({type:w,selectors:[["app-color-picker"]],viewQuery:function(b,v){if(1&b&&t.Gf(D.Kk,5),2&b){let Q;t.iGM(Q=t.CRH())&&(v.colorPickerDirective=Q.first)}},inputs:{options:"options",value:"value",placeholder:"placeholder"},outputs:{valueChange:"valueChange",colorChanged:"colorChanged"},decls:2,vars:8,consts:[[1,"w-100"],["autocompleteOff","","matInput","","readonly","",3,"colorPicker","ngModel","ngClass","placeholder","colorPickerChange","cpSliderDragEnd","ngModelChange"]],template:function(b,v){1&b&&(t.TgZ(0,"mat-form-field",0)(1,"input",1),t.NdJ("colorPickerChange",function(et){return v.value=et})("colorPickerChange",function(){return v.valueChange.emit(v.value)})("cpSliderDragEnd",function(){return v.colorChanged.emit()})("ngModelChange",function(et){return v.value=et}),t.qZA()()),2&b&&(t.xp6(1),t.Udp("background",v.value),t.Q6J("colorPicker",v.value)("ngModel",v.value)("ngClass",t.VKq(6,R,!!v.value))("placeholder",v.placeholder))},dependencies:[U.X,f.mk,k.Fj,k.JJ,k.On,c.v_,tt.k0,D.Kk],styles:["input[_ngcontent-%COMP%]{box-sizing:border-box!important;border-radius:10px!important;color:transparent!important;-webkit-user-select:none!important;-moz-user-select:none!important;user-select:none!important;cursor:pointer!important}input[_ngcontent-%COMP%]::selection{background:transparent!important}input[_ngcontent-%COMP%]::-moz-selection{background:transparent!important}"]})},32836:(At,$,_)=>{_.d($,{P:()=>c});var t=_(65879),D=_(14090),U=_(2353),f=_(56223),k=_(60420);class c extends D.H{set text(R){if(this._text=R,this._text){let w=this.utility.extractTagsFromHtml(this._text,["style","link"]);w.length>0&&(this._text=this.utility.removeTagsFromHtml(this._text,["style","link"]),setTimeout(()=>{this.textChange.emit(this._text),this.onHeadRemove.emit(w.join())},200))}}getEditorConfig(){let R=this.height;return this.showToolbar&&!this.disabled&&!this.editorFocused&&(R+=42),{editable:!this.disabled,spellcheck:!0,height:R+"px",minHeight:R+"px",maxHeight:R+"px",width:"100%",minWidth:"100%",translate:"yes",enableToolbar:this.showToolbar&&!this.disabled&&this.editorFocused,showToolbar:this.showToolbar&&!this.disabled&&this.editorFocused,placeholder:"",defaultParagraphSeparator:"",defaultFontName:"",defaultFontSize:"",fonts:[{class:"arial",name:"Arial"},{class:"times-new-roman",name:"Times New Roman"},{class:"calibri",name:"Calibri"},{class:"comic-sans-ms",name:"Comic Sans MS"}],customClasses:null,uploadUrl:"",uploadWithCredentials:!1,sanitize:!1,outline:!1,toolbarPosition:"top",toolbarHiddenButtons:[["undo","redo"],["insertImage","insertVideo","removeFormat","customClasses"]]}}constructor(R){super(),this.utility=R,this.height=200,this.showToolbar=!0,this.disabled=!1,this.onBlur=new t.vpe,this.textChange=new t.vpe,this.onHeadRemove=new t.vpe,this.editorFocused=!1}}c.\u0275fac=function(R){return new(R||c)(t.Y36(U.t))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-editor"]],inputs:{text:"text",id:"id",height:"height",showToolbar:"showToolbar",disabled:"disabled"},outputs:{onBlur:"onBlur",textChange:"textChange",onHeadRemove:"onHeadRemove"},features:[t.qOj],decls:1,vars:3,consts:[[3,"id","config","ngModel","ngModelChange","focus","blur"]],template:function(R,w){1&R&&(t.TgZ(0,"angular-editor",0),t.NdJ("ngModelChange",function(b){return w._text=b})("ngModelChange",function(){return w.textChange.emit(w._text)})("focus",function(){return w.editorFocused=!0})("blur",function(){return w.editorFocused=!1,w.onBlur.emit()}),t.qZA()),2&R&&t.Q6J("id",w.id)("config",w.getEditorConfig())("ngModel",w._text)},dependencies:[f.JJ,f.On,k.s6]})},86427:(At,$,_)=>{_.d($,{t:()=>K});var t=_(706),U=_(14090),f=_(65879),k=_(30724),c=_(96814),tt=_(94505),R=_(27599),w=_(89515);function L(Z,P){if(1&Z&&(f.TgZ(0,"div",12),f._uU(1),f.ALo(2,"translate"),f.qZA()),2&Z){const E=f.oxw();f.xp6(1),f.hij(" ",f.lcZ(2,1,E.title),"\n")}}function b(Z,P){if(1&Z&&f._UZ(0,"img",13),2&Z){const E=f.oxw();f.Q6J("src",E.url?E.url:E.base64,f.LSH)}}function v(Z,P){1&Z&&f._UZ(0,"img",14)}function Q(Z,P){if(1&Z&&(f.TgZ(0,"div",7),f._uU(1),f.qZA()),2&Z){const E=f.oxw();f.xp6(1),f.hij(" ",E.url,"\n")}}function et(Z,P){if(1&Z){const E=f.EpF();f.TgZ(0,"button",15),f.NdJ("click",function(){f.CHM(E);const z=f.oxw();return f.KtG(z.delete())}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&Z&&(f.xp6(1),f.Oqu(f.lcZ(2,1,"globals.elimina")))}const ct=function(Z){return{"button-blue":Z}};class K extends U.H{set _url(P){this.url=P,this.url?this.deleteButtonEnabled=!0:this.deleteButtonEnabled=!1}constructor(){super(),this.maximumFileSize=0,this.deleteButtonEnabled=!0}fileSelected(P){let E=null==P.files||0==P.files.length?null:P.files[0];if(null!=E&&E.type&&E.type.startsWith("image/"))if(this.maximumFileSize<=0||E.size<=this.maximumFileSize){const I=new FileReader;I.readAsDataURL(E),I.onload=()=>{let z=I.result.toString();z?t.fromBuffer(Uint8Array.from(atob(z.slice(z.indexOf(",")+1)),Y=>Y.charCodeAt(0)),(Y,T)=>{!Y&&null!=T&&T.mime&&T.mime.startsWith("image/")?(this.url=null,this.base64=z):(P.value="",this.showError("globals.messages.fileNonValido"))}):(P.value="",this.showError("globals.messages.fileNonValido"))}}else P.value="",this.showError("globals.messages.fileTroppoGrande",{size:Math.floor(this.maximumFileSize/1e3)});else P.value="",this.showError("globals.messages.fileNonValido")}delete(){this.showDialogConfirm("globals.eliminareImmagine").then(P=>{this.dialogRef.close("")},P=>{})}}K.\u0275fac=function(P){return new(P||K)},K.\u0275cmp=f.Xpm({type:K,selectors:[["app-image-edit"]],inputs:{_url:"_url",maximumFileSize:"maximumFileSize",title:"title",dialogRef:"dialogRef",blue:"blue"},features:[f.qOj],decls:16,vars:13,consts:[["mat-icon-button","",1,"modal-close-button",3,"matDialogClose","disableRipple"],[1,"material-icons-round"],["class","mb-2 text-center font-weight-bold",4,"ngIf"],[1,"imageRow","text-center"],["class","rounded",3,"src",4,"ngIf"],["class","rounded","src","assets/images/sbm/no-image.png",4,"ngIf"],["class","mt-3 text-center",4,"ngIf"],[1,"mt-3","text-center"],["autocompleteOff","","type","file","accept","image/png, image/jpeg",3,"change"],["fileInput",""],["mat-flat-button","",3,"color","ngClass","click"],["mat-flat-button","","color","blank","class","ml-1",3,"click",4,"ngIf"],[1,"mb-2","text-center","font-weight-bold"],[1,"rounded",3,"src"],["src","assets/images/sbm/no-image.png",1,"rounded"],["mat-flat-button","","color","blank",1,"ml-1",3,"click"]],template:function(P,E){if(1&P){const I=f.EpF();f.TgZ(0,"button",0)(1,"i",1),f._uU(2,"clear"),f.qZA()(),f.YNc(3,L,3,3,"div",2),f.TgZ(4,"div",3),f.YNc(5,b,1,1,"img",4),f.YNc(6,v,1,0,"img",5),f.qZA(),f.YNc(7,Q,2,1,"div",6),f.TgZ(8,"div",7)(9,"input",8,9),f.NdJ("change",function(){f.CHM(I);const Y=f.MAs(10);return f.KtG(E.fileSelected(Y))}),f.qZA()(),f.TgZ(11,"div",7)(12,"button",10),f.NdJ("click",function(){return E.dialogRef.close(E.base64?E.base64.substring(E.base64.indexOf(",")+1):E.base64)}),f._uU(13),f.ALo(14,"translate"),f.qZA(),f.YNc(15,et,3,3,"button",11),f.qZA()}2&P&&(f.Q6J("disableRipple",!0),f.xp6(3),f.Q6J("ngIf",!!E.title),f.xp6(2),f.Q6J("ngIf",!!E.url||!!E.base64),f.xp6(1),f.Q6J("ngIf",!E.url&&!E.base64),f.xp6(1),f.Q6J("ngIf",!!E.url),f.xp6(5),f.Q6J("color",E.blue?null:"primary")("ngClass",f.VKq(11,ct,E.blue)),f.xp6(1),f.Oqu(f.lcZ(14,9,"globals.salva")),f.xp6(2),f.Q6J("ngIf",E.deleteButtonEnabled))},dependencies:[k.X,c.mk,c.O5,tt.eB,R.aO,w.X$],styles:[".imageRow[_ngcontent-%COMP%]{height:180px!important;max-height:180px!important}img[_ngcontent-%COMP%]{max-height:180px!important;max-width:100%!important}"]})},31534:(At,$,_)=>{_.d($,{c:()=>Z});var t=_(65879),D=_(96814),U=_(94505),f=_(29025),k=_(89515);function c(P,E){if(1&P&&(t.TgZ(0,"mat-card-title",6),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&P){const I=t.oxw(2);t.xp6(1),t.hij(" ",t.lcZ(2,1,I.title)," ")}}function tt(P,E){1&P&&t.GkF(0)}function R(P,E){if(1&P&&(t.TgZ(0,"mat-card",3),t.YNc(1,c,3,3,"mat-card-title",4),t.YNc(2,tt,1,0,"ng-container",5),t.qZA()),2&P){const I=t.oxw(),z=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!!I.title),t.xp6(1),t.Q6J("ngTemplateOutlet",z)}}function w(P,E){if(1&P&&(t.TgZ(0,"div",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&P){const I=t.oxw(2);t.xp6(1),t.Oqu(t.lcZ(2,1,I.title))}}function L(P,E){1&P&&t.GkF(0)}function b(P,E){if(1&P&&(t.ynx(0),t.YNc(1,w,3,3,"div",7),t.YNc(2,L,1,0,"ng-container",5),t.BQk()),2&P){const I=t.oxw(),z=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!!I.title),t.xp6(1),t.Q6J("ngTemplateOutlet",z)}}function v(P,E){if(1&P){const I=t.EpF();t.TgZ(0,"img",14),t.NdJ("click",function(){t.CHM(I);const Y=t.oxw(2);return t.KtG(Y.edit.emit())}),t.qZA()}if(2&P){const I=t.oxw(2);t.Q6J("src",I.url,t.LSH)}}function Q(P,E){if(1&P){const I=t.EpF();t.TgZ(0,"img",15),t.NdJ("click",function(){t.CHM(I);const Y=t.oxw(2);return t.KtG(Y.edit.emit())}),t.qZA()}}const et=function(P){return{"button-blue":P}};function ct(P,E){if(1&P){const I=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(I);const Y=t.oxw(2);return t.KtG(Y.delete.emit())}),t.TgZ(1,"i",17),t._uU(2,"delete"),t.qZA()()}if(2&P){const I=t.oxw(2);t.Q6J("color",I.blue?null:"primary")("ngClass",t.VKq(2,et,I.blue))}}function K(P,E){if(1&P&&(t.TgZ(0,"div",9)(1,"div",10),t.YNc(2,v,1,1,"img",11),t.YNc(3,Q,1,0,"img",12),t.qZA(),t.YNc(4,ct,3,4,"button",13),t.qZA()),2&P){const I=t.oxw();t.xp6(2),t.Q6J("ngIf",!!I.url),t.xp6(1),t.Q6J("ngIf",!I.url),t.xp6(1),t.Q6J("ngIf",I.deleteAlwaysVisible||!!I.url)}}class Z{constructor(){this.container=!0,this.deleteAlwaysVisible=!1,this.blue=!1,this.edit=new t.vpe,this.delete=new t.vpe}}Z.\u0275fac=function(E){return new(E||Z)},Z.\u0275cmp=t.Xpm({type:Z,selectors:[["app-image"]],inputs:{title:"title",url:"url",container:"container",deleteAlwaysVisible:"deleteAlwaysVisible",blue:"blue"},outputs:{edit:"edit",delete:"delete"},decls:4,vars:2,consts:[["class","border mat-elevation-z0",4,"ngIf"],[4,"ngIf"],["image",""],[1,"border","mat-elevation-z0"],["class","text-center",4,"ngIf"],[4,"ngTemplateOutlet"],[1,"text-center"],["class","text-center font-weight-bold mb-3",4,"ngIf"],[1,"text-center","font-weight-bold","mb-3"],[1,"imageRow"],[1,"imageHeight"],["class","rounded",3,"src","click",4,"ngIf"],["class","rounded","src","assets/images/sbm/no-image.png",3,"click",4,"ngIf"],["mat-icon-button","","class","delete-button",3,"color","ngClass","click",4,"ngIf"],[1,"rounded",3,"src","click"],["src","assets/images/sbm/no-image.png",1,"rounded",3,"click"],["mat-icon-button","",1,"delete-button",3,"color","ngClass","click"],[1,"material-icons","delete-icon"]],template:function(E,I){1&E&&(t.YNc(0,R,3,2,"mat-card",0),t.YNc(1,b,3,2,"ng-container",1),t.YNc(2,K,5,3,"ng-template",null,2,t.W1O)),2&E&&(t.Q6J("ngIf",I.container),t.xp6(1),t.Q6J("ngIf",!I.container))},dependencies:[D.mk,D.O5,D.tP,U.eB,f.S$,f.mi,k.X$],styles:[".imageHeight[_ngcontent-%COMP%]{max-height:200px!important;text-align:center;width:100%}.imageRow[_ngcontent-%COMP%]{height:200px!important;display:flex;align-items:center;position:relative}img[_ngcontent-%COMP%]{max-height:200px!important;max-width:100%!important}.delete-icon[_ngcontent-%COMP%]{height:30px!important;width:30px!important;font-size:30px!important;line-height:30px!important}.delete-button[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:20px;height:30px!important;width:30px!important;line-height:30px!important}mat-card[_ngcontent-%COMP%]{border:1px solid lightgrey}mat-card-title[_ngcontent-%COMP%]{font-weight:400;font-size:18px}"]})},70061:(At,$,_)=>{_.d($,{G:()=>ft});var t=_(65879),D=_(91);function U(g){return"string"==typeof g||g instanceof String}function f(g){var e;return"object"==typeof g&&null!=g&&"Object"===(null==g||null==(e=g.constructor)?void 0:e.name)}function k(g,e){return Array.isArray(e)?k(g,(i,a)=>e.includes(a)):Object.entries(g).reduce((i,a)=>{let[s,d]=a;return e(d,s)&&(i[s]=d),i},{})}const c_NONE="NONE",c_LEFT="LEFT",c_FORCE_LEFT="FORCE_LEFT",c_RIGHT="RIGHT",c_FORCE_RIGHT="FORCE_RIGHT";function R(g){return g.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function w(g,e){if(e===g)return!0;const i=Array.isArray(e),a=Array.isArray(g);let s;if(i&&a){if(e.length!=g.length)return!1;for(s=0;s<e.length;s++)if(!w(e[s],g[s]))return!1;return!0}if(i!=a)return!1;if(e&&g&&"object"==typeof e&&"object"==typeof g){const d=e instanceof Date,m=g instanceof Date;if(d&&m)return e.getTime()==g.getTime();if(d!=m)return!1;const C=e instanceof RegExp,x=g instanceof RegExp;if(C&&x)return e.toString()==g.toString();if(C!=x)return!1;const y=Object.keys(e);for(s=0;s<y.length;s++)if(!Object.prototype.hasOwnProperty.call(g,y[s]))return!1;for(s=0;s<y.length;s++)if(!w(g[y[s]],e[y[s]]))return!1;return!0}return!(!e||!g||"function"!=typeof e||"function"!=typeof g)&&e.toString()===g.toString()}class L{constructor(e){for(Object.assign(this,e);this.value.slice(0,this.startChangePos)!==this.oldValue.slice(0,this.startChangePos);)--this.oldSelection.start}get startChangePos(){return Math.min(this.cursorPos,this.oldSelection.start)}get insertedCount(){return this.cursorPos-this.startChangePos}get inserted(){return this.value.substr(this.startChangePos,this.insertedCount)}get removedCount(){return Math.max(this.oldSelection.end-this.startChangePos||this.oldValue.length-this.value.length,0)}get removed(){return this.oldValue.substr(this.startChangePos,this.removedCount)}get head(){return this.value.substring(0,this.startChangePos)}get tail(){return this.value.substring(this.startChangePos+this.insertedCount)}get removeDirection(){return!this.removedCount||this.insertedCount?c_NONE:this.oldSelection.end!==this.cursorPos&&this.oldSelection.start!==this.cursorPos||this.oldSelection.end!==this.oldSelection.start?c_LEFT:c_RIGHT}}var b=_(1413);function v(g,e){return new v.InputMask(g,e)}const Q=["mask"];function et(g){if(null==g)throw new Error("mask property should be defined");return g instanceof RegExp?v.MaskedRegExp:U(g)?v.MaskedPattern:g===Date?v.MaskedDate:g===Number?v.MaskedNumber:Array.isArray(g)||g===Array?v.MaskedDynamic:v.Masked&&g.prototype instanceof v.Masked?g:v.Masked&&g instanceof v.Masked?g.constructor:g instanceof Function?v.MaskedFunction:(console.warn("Mask not found for mask",g),v.Masked)}function ct(g){if(!g)throw new Error("Options in not defined");if(v.Masked){if(g.prototype instanceof v.Masked)return{mask:g};const e=g instanceof v.Masked?{mask:g}:f(g)&&g.mask instanceof v.Masked?g:{},{mask:i}=e,a=(0,D.Z)(e,Q);if(i){const s=i.mask;return(0,b.Z)((0,b.Z)({},k(i,(d,m)=>!m.startsWith("_"))),{},{mask:i.constructor,_mask:s},a)}}return f(g)?(0,b.Z)({},g):{mask:g}}function K(g){if(v.Masked&&g instanceof v.Masked)return g;const e=ct(g),i=et(e.mask);if(!i)throw new Error("Masked class is not found for provided mask, appropriate module needs to be imported manually before creating mask.");return e.mask===i&&delete e.mask,e._mask&&(e.mask=e._mask,delete e._mask),new i(e)}v.createMask=K;class Z{get selectionStart(){let e;try{e=this._unsafeSelectionStart}catch(i){}return null!=e?e:this.value.length}get selectionEnd(){let e;try{e=this._unsafeSelectionEnd}catch(i){}return null!=e?e:this.value.length}select(e,i){if(null!=e&&null!=i&&(e!==this.selectionStart||i!==this.selectionEnd))try{this._unsafeSelect(e,i)}catch(a){}}get isActive(){return!1}}v.MaskElement=Z;class P extends Z{constructor(e){super(),this.input=e,this._handlers={}}get rootElement(){var e,i,a;return null!=(e=null==(i=(a=this.input).getRootNode)?void 0:i.call(a))?e:document}get isActive(){return this.input===this.rootElement.activeElement}bindEvents(e){Object.keys(e).forEach(i=>this._toggleEventHandler(P.EVENTS_MAP[i],e[i]))}unbindEvents(){Object.keys(this._handlers).forEach(e=>this._toggleEventHandler(e))}_toggleEventHandler(e,i){this._handlers[e]&&(this.input.removeEventListener(e,this._handlers[e]),delete this._handlers[e]),i&&(this.input.addEventListener(e,i),this._handlers[e]=i)}}P.EVENTS_MAP={selectionChange:"keydown",input:"input",drop:"drop",click:"click",focus:"focus",commit:"blur"},v.HTMLMaskElement=P;class E extends P{constructor(e){super(e),this.input=e,this._handlers={}}get _unsafeSelectionStart(){return null!=this.input.selectionStart?this.input.selectionStart:this.value.length}get _unsafeSelectionEnd(){return this.input.selectionEnd}_unsafeSelect(e,i){this.input.setSelectionRange(e,i)}get value(){return this.input.value}set value(e){this.input.value=e}}v.HTMLMaskElement=P;class I extends P{get _unsafeSelectionStart(){const e=this.rootElement,i=e.getSelection&&e.getSelection(),a=i&&i.anchorOffset,s=i&&i.focusOffset;return null==s||null==a||a<s?a:s}get _unsafeSelectionEnd(){const e=this.rootElement,i=e.getSelection&&e.getSelection(),a=i&&i.anchorOffset,s=i&&i.focusOffset;return null==s||null==a||a>s?a:s}_unsafeSelect(e,i){if(!this.rootElement.createRange)return;const a=this.rootElement.createRange();a.setStart(this.input.firstChild||this.input,e),a.setEnd(this.input.lastChild||this.input,i);const s=this.rootElement,d=s.getSelection&&s.getSelection();d&&(d.removeAllRanges(),d.addRange(a))}get value(){return this.input.textContent||""}set value(e){this.input.textContent=e}}v.HTMLContenteditableMaskElement=I;const z=["mask"];v.InputMask=class Y{constructor(e,i){this.el=e instanceof Z?e:e.isContentEditable&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName?new I(e):new E(e),this.masked=K(i),this._listeners={},this._value="",this._unmaskedValue="",this._saveSelection=this._saveSelection.bind(this),this._onInput=this._onInput.bind(this),this._onChange=this._onChange.bind(this),this._onDrop=this._onDrop.bind(this),this._onFocus=this._onFocus.bind(this),this._onClick=this._onClick.bind(this),this.alignCursor=this.alignCursor.bind(this),this.alignCursorFriendly=this.alignCursorFriendly.bind(this),this._bindEvents(),this.updateValue(),this._onChange()}maskEquals(e){var i;return null==e||(null==(i=this.masked)?void 0:i.maskEquals(e))}get mask(){return this.masked.mask}set mask(e){if(this.maskEquals(e))return;if(!(e instanceof v.Masked)&&this.masked.constructor===et(e))return void this.masked.updateOptions({mask:e});const i=e instanceof v.Masked?e:K({mask:e});i.unmaskedValue=this.masked.unmaskedValue,this.masked=i}get value(){return this._value}set value(e){this.value!==e&&(this.masked.value=e,this.updateControl(),this.alignCursor())}get unmaskedValue(){return this._unmaskedValue}set unmaskedValue(e){this.unmaskedValue!==e&&(this.masked.unmaskedValue=e,this.updateControl(),this.alignCursor())}get typedValue(){return this.masked.typedValue}set typedValue(e){this.masked.typedValueEquals(e)||(this.masked.typedValue=e,this.updateControl(),this.alignCursor())}get displayValue(){return this.masked.displayValue}_bindEvents(){this.el.bindEvents({selectionChange:this._saveSelection,input:this._onInput,drop:this._onDrop,click:this._onClick,focus:this._onFocus,commit:this._onChange})}_unbindEvents(){this.el&&this.el.unbindEvents()}_fireEvent(e,i){const a=this._listeners[e];a&&a.forEach(s=>s(i))}get selectionStart(){return this._cursorChanging?this._changingCursorPos:this.el.selectionStart}get cursorPos(){return this._cursorChanging?this._changingCursorPos:this.el.selectionEnd}set cursorPos(e){!this.el||!this.el.isActive||(this.el.select(e,e),this._saveSelection())}_saveSelection(){this.displayValue!==this.el.value&&console.warn("Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly."),this._selection={start:this.selectionStart,end:this.cursorPos}}updateValue(){this.masked.value=this.el.value,this._value=this.masked.value}updateControl(){const e=this.masked.unmaskedValue,i=this.masked.value,a=this.displayValue,s=this.unmaskedValue!==e||this.value!==i;this._unmaskedValue=e,this._value=i,this.el.value!==a&&(this.el.value=a),s&&this._fireChangeEvents()}updateOptions(e){const{mask:i}=e,a=(0,D.Z)(e,z),s=!this.maskEquals(i),d=!w(this.masked,a);s&&(this.mask=i),d&&this.masked.updateOptions(a),(s||d)&&this.updateControl()}updateCursor(e){null!=e&&(this.cursorPos=e,this._delayUpdateCursor(e))}_delayUpdateCursor(e){this._abortUpdateCursor(),this._changingCursorPos=e,this._cursorChanging=setTimeout(()=>{this.el&&(this.cursorPos=this._changingCursorPos,this._abortUpdateCursor())},10)}_fireChangeEvents(){this._fireEvent("accept",this._inputEvent),this.masked.isComplete&&this._fireEvent("complete",this._inputEvent)}_abortUpdateCursor(){this._cursorChanging&&(clearTimeout(this._cursorChanging),delete this._cursorChanging)}alignCursor(){this.cursorPos=this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos,c_LEFT))}alignCursorFriendly(){this.selectionStart===this.cursorPos&&this.alignCursor()}on(e,i){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(i),this}off(e,i){if(!this._listeners[e])return this;if(!i)return delete this._listeners[e],this;const a=this._listeners[e].indexOf(i);return a>=0&&this._listeners[e].splice(a,1),this}_onInput(e){if(this._inputEvent=e,this._abortUpdateCursor(),!this._selection)return this.updateValue();const i=new L({value:this.el.value,cursorPos:this.cursorPos,oldValue:this.displayValue,oldSelection:this._selection}),a=this.masked.rawInputValue,s=this.masked.splice(i.startChangePos,i.removed.length,i.inserted,i.removeDirection,{input:!0,raw:!0}).offset,d=a===this.masked.rawInputValue?i.removeDirection:c_NONE;let m=this.masked.nearestInputPos(i.startChangePos+s,d);d!==c_NONE&&(m=this.masked.nearestInputPos(m,c_NONE)),this.updateControl(),this.updateCursor(m),delete this._inputEvent}_onChange(){this.displayValue!==this.el.value&&this.updateValue(),this.masked.doCommit(),this.updateControl(),this._saveSelection()}_onDrop(e){e.preventDefault(),e.stopPropagation()}_onFocus(e){this.alignCursorFriendly()}_onClick(e){this.alignCursorFriendly()}destroy(){this._unbindEvents(),this._listeners.length=0,delete this.el}};class T{static normalize(e){return Array.isArray(e)?e:[e,new T]}constructor(e){Object.assign(this,{inserted:"",rawInserted:"",skip:!1,tailShift:0},e)}aggregate(e){return this.rawInserted+=e.rawInserted,this.skip=this.skip||e.skip,this.inserted+=e.inserted,this.tailShift+=e.tailShift,this}get offset(){return this.tailShift+this.inserted.length}}v.ChangeDetails=T;class st{constructor(e,i,a){void 0===e&&(e=""),void 0===i&&(i=0),this.value=e,this.from=i,this.stop=a}toString(){return this.value}extend(e){this.value+=String(e)}appendTo(e){return e.append(this.toString(),{tail:!0}).aggregate(e._appendPlaceholder())}get state(){return{value:this.value,from:this.from,stop:this.stop}}set state(e){Object.assign(this,e)}unshift(e){if(!this.value.length||null!=e&&this.from>=e)return"";const i=this.value[0];return this.value=this.value.slice(1),i}shift(){if(!this.value.length)return"";const e=this.value[this.value.length-1];return this.value=this.value.slice(0,-1),e}}class G{constructor(e){this._value="",this._update((0,b.Z)((0,b.Z)({},G.DEFAULTS),e)),this._initialized=!0}updateOptions(e){Object.keys(e).length&&this.withValueRefresh(this._update.bind(this,e))}_update(e){Object.assign(this,e)}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue}}set state(e){this._value=e._value}reset(){this._value=""}get value(){return this._value}set value(e){this.resolve(e,{input:!0})}resolve(e,i){void 0===i&&(i={input:!0}),this.reset(),this.append(e,i,""),this.doCommit()}get unmaskedValue(){return this.value}set unmaskedValue(e){this.resolve(e,{})}get typedValue(){return this.parse?this.parse(this.value,this):this.unmaskedValue}set typedValue(e){this.format?this.value=this.format(e,this):this.unmaskedValue=String(e)}get rawInputValue(){return this.extractInput(0,this.value.length,{raw:!0})}set rawInputValue(e){this.resolve(e,{raw:!0})}get displayValue(){return this.value}get isComplete(){return!0}get isFilled(){return this.isComplete}nearestInputPos(e,i){return e}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),Math.min(this.value.length,i-e)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.value.slice(e,i)}extractTail(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),new st(this.extractInput(e,i),e)}appendTail(e){return U(e)&&(e=new st(String(e))),e.appendTo(this)}_appendCharRaw(e,i){return e?(this._value+=e,new T({inserted:e,rawInserted:e})):new T}_appendChar(e,i,a){void 0===i&&(i={});const s=this.state;let d;if([e,d]=this.doPrepareChar(e,i),d=d.aggregate(this._appendCharRaw(e,i)),d.inserted){let m,C=!1!==this.doValidate(i);if(C&&null!=a){const x=this.state;!0===this.overwrite&&(m=a.state,a.unshift(this.value.length-d.tailShift));let y=this.appendTail(a);C=y.rawInserted===a.toString(),!(C&&y.inserted)&&"shift"===this.overwrite&&(this.state=x,m=a.state,a.shift(),y=this.appendTail(a),C=y.rawInserted===a.toString()),C&&y.inserted&&(this.state=x)}C||(d=new T,this.state=s,a&&m&&(a.state=m))}return d}_appendPlaceholder(){return new T}_appendEager(){return new T}append(e,i,a){if(!U(e))throw new Error("value should be string");const s=U(a)?new st(String(a)):a;let d;null!=i&&i.tail&&(i._beforeTailState=this.state),[e,d]=this.doPrepare(e,i);for(let m=0;m<e.length;++m){const C=this._appendChar(e[m],i,s);if(!C.rawInserted&&!this.doSkipInvalid(e[m],i,s))break;d.aggregate(C)}return(!0===this.eager||"append"===this.eager)&&null!=i&&i.input&&e&&d.aggregate(this._appendEager()),null!=s&&(d.tailShift+=this.appendTail(s).tailShift),d}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this._value=this.value.slice(0,e)+this.value.slice(i),new T}withValueRefresh(e){if(this._refreshing||!this._initialized)return e();this._refreshing=!0;const i=this.rawInputValue,a=this.value,s=e();return this.rawInputValue=i,this.value&&this.value!==a&&0===a.indexOf(this.value)&&this.append(a.slice(this.value.length),{},""),delete this._refreshing,s}runIsolated(e){if(this._isolated||!this._initialized)return e(this);this._isolated=!0;const i=this.state,a=e(this);return this.state=i,delete this._isolated,a}doSkipInvalid(e,i,a){return!!this.skipInvalid}doPrepare(e,i){return void 0===i&&(i={}),T.normalize(this.prepare?this.prepare(e,this,i):e)}doPrepareChar(e,i){return void 0===i&&(i={}),T.normalize(this.prepareChar?this.prepareChar(e,this,i):e)}doValidate(e){return(!this.validate||this.validate(this.value,this,e))&&(!this.parent||this.parent.doValidate(e))}doCommit(){this.commit&&this.commit(this.value,this)}splice(e,i,a,s,d){void 0===s&&(s=c_NONE),void 0===d&&(d={input:!0});const m=e+i,C=this.extractTail(m),x=!0===this.eager||"remove"===this.eager;let y;x&&(s=function tt(g){switch(g){case c_LEFT:return c_FORCE_LEFT;case c_RIGHT:return c_FORCE_RIGHT;default:return g}}(s),y=this.extractInput(0,m,{raw:!0}));let F=e;const H=new T;if(s!==c_NONE&&(F=this.nearestInputPos(e,i>1&&0!==e&&!x?c_NONE:s),H.tailShift=F-e),H.aggregate(this.remove(F)),x&&s!==c_NONE&&y===this.rawInputValue)if(s===c_FORCE_LEFT){let dt;for(;y===this.rawInputValue&&(dt=this.value.length);)H.aggregate(new T({tailShift:-1})).aggregate(this.remove(dt-1))}else s===c_FORCE_RIGHT&&C.unshift();return H.aggregate(this.append(a,d,C))}maskEquals(e){return this.mask===e}typedValueEquals(e){const i=this.typedValue;return e===i||G.EMPTY_VALUES.includes(e)&&G.EMPTY_VALUES.includes(i)||!!this.format&&this.format(e,this)===this.format(this.typedValue,this)}}G.DEFAULTS={skipInvalid:!0},G.EMPTY_VALUES=[void 0,null,""],v.Masked=G;const rt=["chunks"];class ut{constructor(e,i){void 0===e&&(e=[]),void 0===i&&(i=0),this.chunks=e,this.from=i}toString(){return this.chunks.map(String).join("")}extend(e){if(!String(e))return;e=U(e)?new st(String(e)):e;const i=this.chunks[this.chunks.length-1],a=i&&(i.stop===e.stop||null==e.stop)&&e.from===i.from+i.toString().length;if(e instanceof st)a?i.extend(e.toString()):this.chunks.push(e);else if(e instanceof ut){if(null==e.stop){let s;for(;e.chunks.length&&null==e.chunks[0].stop;)s=e.chunks.shift(),s.from+=e.from,this.extend(s)}e.toString()&&(e.stop=e.blockIndex,this.chunks.push(e))}}appendTo(e){if(!(e instanceof v.MaskedPattern))return new st(this.toString()).appendTo(e);const i=new T;for(let a=0;a<this.chunks.length&&!i.skip;++a){const s=this.chunks[a],d=e._mapPosToBlock(e.value.length),m=s.stop;let C;if(null!=m&&(!d||d.index<=m)){if(s instanceof ut||e._stops.indexOf(m)>=0){const x=e._appendPlaceholder(m);i.aggregate(x)}C=s instanceof ut&&e._blocks[m]}if(C){const x=C.appendTail(s);x.skip=!1,i.aggregate(x),e._value+=x.inserted;const y=s.toString().slice(x.rawInserted.length);y&&i.aggregate(e.append(y,{tail:!0}))}else i.aggregate(e.append(s.toString(),{tail:!0}))}return i}get state(){return{chunks:this.chunks.map(e=>e.state),from:this.from,stop:this.stop,blockIndex:this.blockIndex}}set state(e){const{chunks:i}=e,a=(0,D.Z)(e,rt);Object.assign(this,a),this.chunks=i.map(s=>{const d="chunks"in s?new ut:new st;return d.state=s,d})}unshift(e){if(!this.chunks.length||null!=e&&this.from>=e)return"";const i=null!=e?e-this.from:e;let a=0;for(;a<this.chunks.length;){const s=this.chunks[a],d=s.unshift(i);if(s.toString()){if(!d)break;++a}else this.chunks.splice(a,1);if(d)return d}return""}shift(){if(!this.chunks.length)return"";let e=this.chunks.length-1;for(;0<=e;){const i=this.chunks[e],a=i.shift();if(i.toString()){if(!a)break;--e}else this.chunks.splice(e,1);if(a)return a}return""}}class p{constructor(e,i){this.masked=e,this._log=[];const{offset:a,index:s}=e._mapPosToBlock(i)||(i<0?{index:0,offset:0}:{index:this.masked._blocks.length,offset:0});this.offset=a,this.index=s,this.ok=!1}get block(){return this.masked._blocks[this.index]}get pos(){return this.masked._blockStartPos(this.index)+this.offset}get state(){return{index:this.index,offset:this.offset,ok:this.ok}}set state(e){Object.assign(this,e)}pushState(){this._log.push(this.state)}popState(){const e=this._log.pop();return e&&(this.state=e),e}bindBlock(){this.block||(this.index<0&&(this.index=0,this.offset=0),this.index>=this.masked._blocks.length&&(this.index=this.masked._blocks.length-1,this.offset=this.block.value.length))}_pushLeft(e){for(this.pushState(),this.bindBlock();0<=this.index;--this.index,this.offset=(null==(i=this.block)?void 0:i.value.length)||0){var i;if(e())return this.ok=!0}return this.ok=!1}_pushRight(e){for(this.pushState(),this.bindBlock();this.index<this.masked._blocks.length;++this.index,this.offset=0)if(e())return this.ok=!0;return this.ok=!1}pushLeftBeforeFilled(){return this._pushLeft(()=>{if(!this.block.isFixed&&this.block.value&&(this.offset=this.block.nearestInputPos(this.offset,c_FORCE_LEFT),0!==this.offset))return!0})}pushLeftBeforeInput(){return this._pushLeft(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,c_LEFT),!0})}pushLeftBeforeRequired(){return this._pushLeft(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,c_LEFT),!0})}pushRightBeforeFilled(){return this._pushRight(()=>{if(!this.block.isFixed&&this.block.value&&(this.offset=this.block.nearestInputPos(this.offset,c_FORCE_RIGHT),this.offset!==this.block.value.length))return!0})}pushRightBeforeInput(){return this._pushRight(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,c_NONE),!0})}pushRightBeforeRequired(){return this._pushRight(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,c_NONE),!0})}}class M{constructor(e){Object.assign(this,e),this._value="",this.isFixed=!0}get value(){return this._value}get unmaskedValue(){return this.isUnmasking?this.value:""}get rawInputValue(){return this._isRawInput?this.value:""}get displayValue(){return this.value}reset(){this._isRawInput=!1,this._value=""}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),this._value=this._value.slice(0,e)+this._value.slice(i),this._value||(this._isRawInput=!1),new T}nearestInputPos(e,i){void 0===i&&(i=c_NONE);const s=this._value.length;switch(i){case c_LEFT:case c_FORCE_LEFT:return 0;default:return s}}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),this._isRawInput?i-e:0}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),void 0===a&&(a={}),a.raw&&this._isRawInput&&this._value.slice(e,i)||""}get isComplete(){return!0}get isFilled(){return!!this._value}_appendChar(e,i){void 0===i&&(i={});const a=new T;if(this.isFilled)return a;const s=!0===this.eager||"append"===this.eager,m=this.char===e&&(this.isUnmasking||i.input||i.raw)&&(!i.raw||!s)&&!i.tail;return m&&(a.rawInserted=this.char),this._value=a.inserted=this.char,this._isRawInput=m&&(i.raw||i.input),a}_appendEager(){return this._appendChar(this.char,{tail:!0})}_appendPlaceholder(){const e=new T;return this.isFilled||(this._value=e.inserted=this.char),e}extractTail(){return new st("")}appendTail(e){return U(e)&&(e=new st(String(e))),e.appendTo(this)}append(e,i,a){const s=this._appendChar(e[0],i);return null!=a&&(s.tailShift+=this.appendTail(a).tailShift),s}doCommit(){}get state(){return{_value:this._value,_rawInputValue:this.rawInputValue}}set state(e){this._value=e._value,this._isRawInput=!!e._rawInputValue}}const S=["parent","isOptional","placeholderChar","displayChar","lazy","eager"];class B{constructor(e){const{parent:i,isOptional:a,placeholderChar:s,displayChar:d,lazy:m,eager:C}=e,x=(0,D.Z)(e,S);this.masked=K(x),Object.assign(this,{parent:i,isOptional:a,placeholderChar:s,displayChar:d,lazy:m,eager:C})}reset(){this.isFilled=!1,this.masked.reset()}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),0===e&&i>=1?(this.isFilled=!1,this.masked.remove(e,i)):new T}get value(){return this.masked.value||(this.isFilled&&!this.isOptional?this.placeholderChar:"")}get unmaskedValue(){return this.masked.unmaskedValue}get rawInputValue(){return this.masked.rawInputValue}get displayValue(){return this.masked.value&&this.displayChar||this.value}get isComplete(){return!!this.masked.value||this.isOptional}_appendChar(e,i){if(void 0===i&&(i={}),this.isFilled)return new T;const a=this.masked.state,s=this.masked._appendChar(e,this.currentMaskFlags(i));return s.inserted&&!1===this.doValidate(i)&&(s.inserted=s.rawInserted="",this.masked.state=a),!s.inserted&&!this.isOptional&&!this.lazy&&!i.input&&(s.inserted=this.placeholderChar),s.skip=!s.inserted&&!this.isOptional,this.isFilled=!!s.inserted,s}append(e,i,a){return this.masked.append(e,this.currentMaskFlags(i),a)}_appendPlaceholder(){const e=new T;return this.isFilled||this.isOptional||(this.isFilled=!0,e.inserted=this.placeholderChar),e}_appendEager(){return new T}extractTail(e,i){return this.masked.extractTail(e,i)}appendTail(e){return this.masked.appendTail(e)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.masked.extractInput(e,i,a)}nearestInputPos(e,i){void 0===i&&(i=c_NONE);const s=this.value.length,d=Math.min(Math.max(e,0),s);switch(i){case c_LEFT:case c_FORCE_LEFT:return this.isComplete?d:0;case c_RIGHT:case c_FORCE_RIGHT:return this.isComplete?d:s;default:return d}}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.value.slice(e,i).length}doValidate(e){return this.masked.doValidate(this.currentMaskFlags(e))&&(!this.parent||this.parent.doValidate(this.currentMaskFlags(e)))}doCommit(){this.masked.doCommit()}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue,masked:this.masked.state,isFilled:this.isFilled}}set state(e){this.masked.state=e.masked,this.isFilled=e.isFilled}currentMaskFlags(e){var i;return(0,b.Z)((0,b.Z)({},e),{},{_beforeTailState:(null==e||null==(i=e._beforeTailState)?void 0:i.masked)||(null==e?void 0:e._beforeTailState)})}}B.DEFAULT_DEFINITIONS={0:/\d/,a:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,"*":/./};v.MaskedRegExp=class it extends G{updateOptions(e){super.updateOptions(e)}_update(e){const i=e.mask;i&&(e.validate=a=>a.search(i)>=0),super._update(e)}};const Pt=["_blocks"];class V extends G{constructor(e){super((0,b.Z)((0,b.Z)((0,b.Z)({},V.DEFAULTS),e),{},{definitions:Object.assign({},B.DEFAULT_DEFINITIONS,null==e?void 0:e.definitions)}))}updateOptions(e){super.updateOptions(e)}_update(e){e.definitions=Object.assign({},this.definitions,e.definitions),super._update(e),this._rebuildMask()}_rebuildMask(){const e=this.definitions;this._blocks=[],this._stops=[],this._maskedBlocks={};const i=this.mask;if(!i||!e)return;let a=!1,s=!1;for(let d=0;d<i.length;++d){if(this.blocks){const y=i.slice(d),F=Object.keys(this.blocks).filter(dt=>0===y.indexOf(dt));F.sort((dt,Dt)=>Dt.length-dt.length);const H=F[0];if(H){const dt=K((0,b.Z)((0,b.Z)({lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar,overwrite:this.overwrite},ct(this.blocks[H])),{},{parent:this}));dt&&(this._blocks.push(dt),this._maskedBlocks[H]||(this._maskedBlocks[H]=[]),this._maskedBlocks[H].push(this._blocks.length-1)),d+=H.length-1;continue}}let m=i[d],C=m in e;if(m===V.STOP_CHAR){this._stops.push(this._blocks.length);continue}if("{"===m||"}"===m){a=!a;continue}if("["===m||"]"===m){s=!s;continue}if(m===V.ESCAPE_CHAR){if(++d,m=i[d],!m)break;C=!1}const x=C?new B((0,b.Z)((0,b.Z)({isOptional:s,lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar},ct(e[m])),{},{parent:this})):new M({char:m,eager:this.eager,isUnmasking:a});this._blocks.push(x)}}get state(){return(0,b.Z)((0,b.Z)({},super.state),{},{_blocks:this._blocks.map(e=>e.state)})}set state(e){const{_blocks:i}=e,a=(0,D.Z)(e,Pt);this._blocks.forEach((s,d)=>s.state=i[d]),super.state=a}reset(){super.reset(),this._blocks.forEach(e=>e.reset())}get isComplete(){return this._blocks.every(e=>e.isComplete)}get isFilled(){return this._blocks.every(e=>e.isFilled)}get isFixed(){return this._blocks.every(e=>e.isFixed)}get isOptional(){return this._blocks.every(e=>e.isOptional)}doCommit(){this._blocks.forEach(e=>e.doCommit()),super.doCommit()}get unmaskedValue(){return this._blocks.reduce((e,i)=>e+i.unmaskedValue,"")}set unmaskedValue(e){super.unmaskedValue=e}get value(){return this._blocks.reduce((e,i)=>e+i.value,"")}set value(e){super.value=e}get displayValue(){return this._blocks.reduce((e,i)=>e+i.displayValue,"")}appendTail(e){return super.appendTail(e).aggregate(this._appendPlaceholder())}_appendEager(){var e;const i=new T;let a=null==(e=this._mapPosToBlock(this.value.length))?void 0:e.index;if(null==a)return i;this._blocks[a].isFilled&&++a;for(let s=a;s<this._blocks.length;++s){const d=this._blocks[s]._appendEager();if(!d.inserted)break;i.aggregate(d)}return i}_appendCharRaw(e,i){void 0===i&&(i={});const a=this._mapPosToBlock(this.value.length),s=new T;if(!a)return s;for(let C=a.index;;++C){var d,m;const x=this._blocks[C];if(!x)break;const y=x._appendChar(e,(0,b.Z)((0,b.Z)({},i),{},{_beforeTailState:null==(d=i._beforeTailState)||null==(m=d._blocks)?void 0:m[C]})),F=y.skip;if(s.aggregate(y),F||y.rawInserted)break}return s}extractTail(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);const a=new ut;return e===i||this._forEachBlocksInRange(e,i,(s,d,m,C)=>{const x=s.extractTail(m,C);x.stop=this._findStopBefore(d),x.from=this._blockStartPos(d),x instanceof ut&&(x.blockIndex=d),a.extend(x)}),a}extractInput(e,i,a){if(void 0===e&&(e=0),void 0===i&&(i=this.value.length),void 0===a&&(a={}),e===i)return"";let s="";return this._forEachBlocksInRange(e,i,(d,m,C,x)=>{s+=d.extractInput(C,x,a)}),s}_findStopBefore(e){let i;for(let a=0;a<this._stops.length;++a){const s=this._stops[a];if(!(s<=e))break;i=s}return i}_appendPlaceholder(e){const i=new T;if(this.lazy&&null==e)return i;const a=this._mapPosToBlock(this.value.length);if(!a)return i;const s=a.index,d=null!=e?e:this._blocks.length;return this._blocks.slice(s,d).forEach(m=>{if(!m.lazy||null!=e){var C;const x=m._appendPlaceholder(null==(C=m._blocks)?void 0:C.length);this._value+=x.inserted,i.aggregate(x)}}),i}_mapPosToBlock(e){let i="";for(let a=0;a<this._blocks.length;++a){const s=this._blocks[a],d=i.length;if(i+=s.value,e<=i.length)return{index:a,offset:e-d}}}_blockStartPos(e){return this._blocks.slice(0,e).reduce((i,a)=>i+a.value.length,0)}_forEachBlocksInRange(e,i,a){void 0===i&&(i=this.value.length);const s=this._mapPosToBlock(e);if(s){const d=this._mapPosToBlock(i),m=d&&s.index===d.index,C=s.offset,x=d&&m?d.offset:this._blocks[s.index].value.length;if(a(this._blocks[s.index],s.index,C,x),d&&!m){for(let y=s.index+1;y<d.index;++y)a(this._blocks[y],y,0,this._blocks[y].value.length);a(this._blocks[d.index],d.index,0,d.offset)}}}remove(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);const a=super.remove(e,i);return this._forEachBlocksInRange(e,i,(s,d,m,C)=>{a.aggregate(s.remove(m,C))}),a}nearestInputPos(e,i){if(void 0===i&&(i=c_NONE),!this._blocks.length)return 0;const a=new p(this,e);if(i===c_NONE)return a.pushRightBeforeInput()||(a.popState(),a.pushLeftBeforeInput())?a.pos:this.value.length;if(i===c_LEFT||i===c_FORCE_LEFT){if(i===c_LEFT){if(a.pushRightBeforeFilled(),a.ok&&a.pos===e)return e;a.popState()}if(a.pushLeftBeforeInput(),a.pushLeftBeforeRequired(),a.pushLeftBeforeFilled(),i===c_LEFT){if(a.pushRightBeforeInput(),a.pushRightBeforeRequired(),a.ok&&a.pos<=e||(a.popState(),a.ok&&a.pos<=e))return a.pos;a.popState()}return a.ok?a.pos:i===c_FORCE_LEFT?0:(a.popState(),a.ok||(a.popState(),a.ok)?a.pos:0)}return i===c_RIGHT||i===c_FORCE_RIGHT?(a.pushRightBeforeInput(),a.pushRightBeforeRequired(),a.pushRightBeforeFilled()?a.pos:i===c_FORCE_RIGHT?this.value.length:(a.popState(),a.ok||(a.popState(),a.ok)?a.pos:this.nearestInputPos(e,c_LEFT))):e}totalInputPositions(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);let a=0;return this._forEachBlocksInRange(e,i,(s,d,m,C)=>{a+=s.totalInputPositions(m,C)}),a}maskedBlock(e){return this.maskedBlocks(e)[0]}maskedBlocks(e){const i=this._maskedBlocks[e];return i?i.map(a=>this._blocks[a]):[]}}V.DEFAULTS={lazy:!0,placeholderChar:"_"},V.STOP_CHAR="`",V.ESCAPE_CHAR="\\",V.InputDefinition=B,V.FixedDefinition=M,v.MaskedPattern=V;const gt=["to","from","maxLength","autofix"];class X extends V{get _matchFrom(){return this.maxLength-String(this.from).length}constructor(e){super(e)}updateOptions(e){super.updateOptions(e)}_update(e){const{to:i=this.to||0,from:a=this.from||0,maxLength:s=this.maxLength||0,autofix:d=this.autofix}=e,m=(0,D.Z)(e,gt);this.to=i,this.from=a,this.maxLength=Math.max(String(i).length,s),this.autofix=d;const C=String(this.from).padStart(this.maxLength,"0"),x=String(this.to).padStart(this.maxLength,"0");let y=0;for(;y<x.length&&x[y]===C[y];)++y;m.mask=x.slice(0,y).replace(/0/g,"\\0")+"0".repeat(this.maxLength-y),super._update(m)}get isComplete(){return super.isComplete&&!!this.value}boundaries(e){let i="",a="";const[,s,d]=e.match(/^(\D*)(\d*)(\D*)/)||[];return d&&(i="0".repeat(s.length)+d,a="9".repeat(s.length)+d),i=i.padEnd(this.maxLength,"0"),a=a.padEnd(this.maxLength,"9"),[i,a]}doPrepareChar(e,i){let a;if(void 0===i&&(i={}),[e,a]=super.doPrepareChar(e.replace(/\D/g,""),i),!this.autofix||!e)return[e,a];const s=String(this.from).padStart(this.maxLength,"0"),d=String(this.to).padStart(this.maxLength,"0"),m=this.value+e;if(m.length>this.maxLength)return["",a];const[C,x]=this.boundaries(m);return Number(x)<this.from?[s[m.length-1],a]:Number(C)>this.to?"pad"===this.autofix&&m.length<this.maxLength?["",a.aggregate(this.append(s[m.length-1]+e,i))]:[d[m.length-1],a]:[e,a]}doValidate(e){const i=this.value;if(-1===i.search(/[^0]/)&&i.length<=this._matchFrom)return!0;const[s,d]=this.boundaries(i);return this.from<=Number(d)&&Number(s)<=this.to&&super.doValidate(e)}}v.MaskedRange=X;const J=["mask","pattern"],bt=["mask","pattern","blocks"];class O extends V{constructor(e){const i=(0,b.Z)((0,b.Z)({},O.DEFAULTS),e),{mask:a,pattern:s}=i,d=(0,D.Z)(i,J);super((0,b.Z)((0,b.Z)({},d),{},{mask:U(a)?a:s}))}updateOptions(e){super.updateOptions(e)}_update(e){const i=(0,b.Z)((0,b.Z)({},O.DEFAULTS),e),{mask:a,pattern:s,blocks:d}=i,m=(0,D.Z)(i,bt),C=Object.assign({},O.GET_DEFAULT_BLOCKS());e.min&&(C.Y.from=e.min.getFullYear()),e.max&&(C.Y.to=e.max.getFullYear()),e.min&&e.max&&C.Y.from===C.Y.to&&(C.m.from=e.min.getMonth()+1,C.m.to=e.max.getMonth()+1,C.m.from===C.m.to&&(C.d.from=e.min.getDate(),C.d.to=e.max.getDate())),Object.assign(C,this.blocks,d),Object.keys(C).forEach(x=>{const y=C[x];!("autofix"in y)&&"autofix"in e&&(y.autofix=e.autofix)}),super._update((0,b.Z)((0,b.Z)({},m),{},{mask:U(a)?a:s,blocks:C}))}doValidate(e){const i=this.date;return super.doValidate(e)&&(!this.isComplete||this.isDateExist(this.value)&&null!=i&&(null==this.min||this.min<=i)&&(null==this.max||i<=this.max))}isDateExist(e){return this.format(this.parse(e,this),this).indexOf(e)>=0}get date(){return this.typedValue}set date(e){this.typedValue=e}get typedValue(){return this.isComplete?super.typedValue:null}set typedValue(e){super.typedValue=e}maskEquals(e){return e===Date||super.maskEquals(e)}}O.GET_DEFAULT_BLOCKS=()=>({d:{mask:X,from:1,to:31,maxLength:2},m:{mask:X,from:1,to:12,maxLength:2},Y:{mask:X,from:1900,to:9999}}),O.DEFAULTS={mask:Date,pattern:"d{.}`m{.}`Y",format:(g,e)=>{if(!g)return"";return[String(g.getDate()).padStart(2,"0"),String(g.getMonth()+1).padStart(2,"0"),g.getFullYear()].join(".")},parse:(g,e)=>{const[i,a,s]=g.split(".").map(Number);return new Date(s,a-1,i)}},v.MaskedDate=O;const at=["compiledMasks","currentMaskRef","currentMask"],lt=["mask"];class N extends G{constructor(e){super((0,b.Z)((0,b.Z)({},N.DEFAULTS),e)),this.currentMask=void 0}updateOptions(e){super.updateOptions(e)}_update(e){super._update(e),"mask"in e&&(this.compiledMasks=Array.isArray(e.mask)?e.mask.map(i=>K((0,b.Z)({overwrite:this._overwrite,eager:this._eager,skipInvalid:this._skipInvalid},ct(i)))):[])}_appendCharRaw(e,i){void 0===i&&(i={});const a=this._applyDispatch(e,i);return this.currentMask&&a.aggregate(this.currentMask._appendChar(e,this.currentMaskFlags(i))),a}_applyDispatch(e,i,a){void 0===e&&(e=""),void 0===i&&(i={}),void 0===a&&(a="");const s=i.tail&&null!=i._beforeTailState?i._beforeTailState._value:this.value,d=this.rawInputValue,m=i.tail&&null!=i._beforeTailState?i._beforeTailState._rawInputValue:d,C=d.slice(m.length),x=this.currentMask,y=new T,F=null==x?void 0:x.state;if(this.currentMask=this.doDispatch(e,(0,b.Z)({},i),a),this.currentMask)if(this.currentMask!==x){if(this.currentMask.reset(),m){const H=this.currentMask.append(m,{raw:!0});y.tailShift=H.inserted.length-s.length}C&&(y.tailShift+=this.currentMask.append(C,{raw:!0,tail:!0}).tailShift)}else F&&(this.currentMask.state=F);return y}_appendPlaceholder(){const e=this._applyDispatch();return this.currentMask&&e.aggregate(this.currentMask._appendPlaceholder()),e}_appendEager(){const e=this._applyDispatch();return this.currentMask&&e.aggregate(this.currentMask._appendEager()),e}appendTail(e){const i=new T;return e&&i.aggregate(this._applyDispatch("",{},e)),i.aggregate(this.currentMask?this.currentMask.appendTail(e):super.appendTail(e))}currentMaskFlags(e){var i,a;return(0,b.Z)((0,b.Z)({},e),{},{_beforeTailState:(null==(i=e._beforeTailState)?void 0:i.currentMaskRef)===this.currentMask&&(null==(a=e._beforeTailState)?void 0:a.currentMask)||e._beforeTailState})}doDispatch(e,i,a){return void 0===i&&(i={}),void 0===a&&(a=""),this.dispatch(e,this,i,a)}doValidate(e){return super.doValidate(e)&&(!this.currentMask||this.currentMask.doValidate(this.currentMaskFlags(e)))}doPrepare(e,i){void 0===i&&(i={});let[a,s]=super.doPrepare(e,i);if(this.currentMask){let d;[a,d]=super.doPrepare(a,this.currentMaskFlags(i)),s=s.aggregate(d)}return[a,s]}doPrepareChar(e,i){void 0===i&&(i={});let[a,s]=super.doPrepareChar(e,i);if(this.currentMask){let d;[a,d]=super.doPrepareChar(a,this.currentMaskFlags(i)),s=s.aggregate(d)}return[a,s]}reset(){var e;null==(e=this.currentMask)||e.reset(),this.compiledMasks.forEach(i=>i.reset())}get value(){return this.currentMask?this.currentMask.value:""}set value(e){super.value=e}get unmaskedValue(){return this.currentMask?this.currentMask.unmaskedValue:""}set unmaskedValue(e){super.unmaskedValue=e}get typedValue(){return this.currentMask?this.currentMask.typedValue:""}set typedValue(e){let i=String(e);this.currentMask&&(this.currentMask.typedValue=e,i=this.currentMask.unmaskedValue),this.unmaskedValue=i}get displayValue(){return this.currentMask?this.currentMask.displayValue:""}get isComplete(){var e;return!(null==(e=this.currentMask)||!e.isComplete)}get isFilled(){var e;return!(null==(e=this.currentMask)||!e.isFilled)}remove(e,i){const a=new T;return this.currentMask&&a.aggregate(this.currentMask.remove(e,i)).aggregate(this._applyDispatch()),a}get state(){var e;return(0,b.Z)((0,b.Z)({},super.state),{},{_rawInputValue:this.rawInputValue,compiledMasks:this.compiledMasks.map(i=>i.state),currentMaskRef:this.currentMask,currentMask:null==(e=this.currentMask)?void 0:e.state})}set state(e){const{compiledMasks:i,currentMaskRef:a,currentMask:s}=e,d=(0,D.Z)(e,at);i&&this.compiledMasks.forEach((m,C)=>m.state=i[C]),null!=a&&(this.currentMask=a,this.currentMask.state=s),super.state=d}extractInput(e,i,a){return this.currentMask?this.currentMask.extractInput(e,i,a):""}extractTail(e,i){return this.currentMask?this.currentMask.extractTail(e,i):super.extractTail(e,i)}doCommit(){this.currentMask&&this.currentMask.doCommit(),super.doCommit()}nearestInputPos(e,i){return this.currentMask?this.currentMask.nearestInputPos(e,i):super.nearestInputPos(e,i)}get overwrite(){return this.currentMask?this.currentMask.overwrite:this._overwrite}set overwrite(e){this._overwrite=e}get eager(){return this.currentMask?this.currentMask.eager:this._eager}set eager(e){this._eager=e}get skipInvalid(){return this.currentMask?this.currentMask.skipInvalid:this._skipInvalid}set skipInvalid(e){this._skipInvalid=e}maskEquals(e){return Array.isArray(e)?this.compiledMasks.every((i,a)=>{if(!e[a])return;const s=e[a],{mask:d}=s;return w(i,(0,D.Z)(s,lt))&&i.maskEquals(d)}):super.maskEquals(e)}typedValueEquals(e){var i;return!(null==(i=this.currentMask)||!i.typedValueEquals(e))}}N.DEFAULTS=void 0,N.DEFAULTS={dispatch:(g,e,i,a)=>{if(!e.compiledMasks.length)return;const s=e.rawInputValue,d=e.compiledMasks.map((m,C)=>{const x=e.currentMask===m,y=x?m.value.length:m.nearestInputPos(m.value.length,c_FORCE_LEFT);return m.rawInputValue!==s?(m.reset(),m.append(s,{raw:!0})):x||m.remove(y),m.append(g,e.currentMaskFlags(i)),m.appendTail(a),{index:C,weight:m.rawInputValue.length,totalInputPositions:m.totalInputPositions(0,Math.max(y,m.nearestInputPos(m.value.length,c_FORCE_LEFT)))}});return d.sort((m,C)=>C.weight-m.weight||C.totalInputPositions-m.totalInputPositions),e.compiledMasks[d[0].index]}},v.MaskedDynamic=N;const ht=["enum"];v.MaskedEnum=class A extends V{updateOptions(e){super.updateOptions(e)}_update(e){const{enum:i}=e,a=(0,D.Z)(e,ht);i&&(a.mask="*".repeat(i[0].length),this.enum=i),super._update(a)}doValidate(e){return this.enum.some(i=>i.indexOf(this.unmaskedValue)>=0)&&super.doValidate(e)}};v.MaskedFunction=class nt extends G{updateOptions(e){super.updateOptions(e)}_update(e){super._update((0,b.Z)((0,b.Z)({},e),{},{validate:e.mask}))}};class j extends G{constructor(e){super((0,b.Z)((0,b.Z)({},j.DEFAULTS),e))}updateOptions(e){super.updateOptions(e)}_update(e){super._update(e),this._updateRegExps()}_updateRegExps(){const e="^"+(this.allowNegative?"[+|\\-]?":""),a=(this.scale?"("+R(this.radix)+"\\d{0,"+this.scale+"})?":"")+"$";this._numberRegExp=new RegExp(e+"\\d*"+a),this._mapToRadixRegExp=new RegExp("["+this.mapToRadix.map(R).join("")+"]","g"),this._thousandsSeparatorRegExp=new RegExp(R(this.thousandsSeparator),"g")}_removeThousandsSeparators(e){return e.replace(this._thousandsSeparatorRegExp,"")}_insertThousandsSeparators(e){const i=e.split(this.radix);return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandsSeparator),i.join(this.radix)}doPrepareChar(e,i){void 0===i&&(i={}),e=this._removeThousandsSeparators(this.scale&&this.mapToRadix.length&&(i.input&&i.raw||!i.input&&!i.raw)?e.replace(this._mapToRadixRegExp,this.radix):e);const[a,s]=super.doPrepareChar(e,i);return e&&!a&&(s.skip=!0),a&&!this.allowPositive&&!this.value&&"-"!==a&&s.aggregate(this._appendChar("-")),[a,s]}_separatorsCount(e,i){void 0===i&&(i=!1);let a=0;for(let s=0;s<e;++s)this._value.indexOf(this.thousandsSeparator,s)===s&&(++a,i&&(e+=this.thousandsSeparator.length));return a}_separatorsCountFromSlice(e){return void 0===e&&(e=this._value),this._separatorsCount(this._removeThousandsSeparators(e).length,!0)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),[e,i]=this._adjustRangeWithSeparators(e,i),this._removeThousandsSeparators(super.extractInput(e,i,a))}_appendCharRaw(e,i){if(void 0===i&&(i={}),!this.thousandsSeparator)return super._appendCharRaw(e,i);const a=i.tail&&i._beforeTailState?i._beforeTailState._value:this._value,s=this._separatorsCountFromSlice(a);this._value=this._removeThousandsSeparators(this.value);const d=super._appendCharRaw(e,i);this._value=this._insertThousandsSeparators(this._value);const m=i.tail&&i._beforeTailState?i._beforeTailState._value:this._value,C=this._separatorsCountFromSlice(m);return d.tailShift+=(C-s)*this.thousandsSeparator.length,d.skip=!d.rawInserted&&e===this.thousandsSeparator,d}_findSeparatorAround(e){if(this.thousandsSeparator){const i=e-this.thousandsSeparator.length+1,a=this.value.indexOf(this.thousandsSeparator,i);if(a<=e)return a}return-1}_adjustRangeWithSeparators(e,i){const a=this._findSeparatorAround(e);a>=0&&(e=a);const s=this._findSeparatorAround(i);return s>=0&&(i=s+this.thousandsSeparator.length),[e,i]}remove(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length),[e,i]=this._adjustRangeWithSeparators(e,i);const a=this.value.slice(0,e),s=this.value.slice(i),d=this._separatorsCount(a.length);this._value=this._insertThousandsSeparators(this._removeThousandsSeparators(a+s));const m=this._separatorsCountFromSlice(a);return new T({tailShift:(m-d)*this.thousandsSeparator.length})}nearestInputPos(e,i){if(!this.thousandsSeparator)return e;switch(i){case c_NONE:case c_LEFT:case c_FORCE_LEFT:{const a=this._findSeparatorAround(e-1);if(a>=0){const s=a+this.thousandsSeparator.length;if(e<s||this.value.length<=s||i===c_FORCE_LEFT)return a}break}case c_RIGHT:case c_FORCE_RIGHT:{const a=this._findSeparatorAround(e);if(a>=0)return a+this.thousandsSeparator.length}}return e}doValidate(e){let i=!!this._removeThousandsSeparators(this.value).match(this._numberRegExp);if(i){const a=this.number;i=i&&!isNaN(a)&&(null==this.min||this.min>=0||this.min<=this.number)&&(null==this.max||this.max<=0||this.number<=this.max)}return i&&super.doValidate(e)}doCommit(){if(this.value){const e=this.number;let i=e;null!=this.min&&(i=Math.max(i,this.min)),null!=this.max&&(i=Math.min(i,this.max)),i!==e&&(this.unmaskedValue=this.format(i,this));let a=this.value;this.normalizeZeros&&(a=this._normalizeZeros(a)),this.padFractionalZeros&&this.scale>0&&(a=this._padFractionalZeros(a)),this._value=a}super.doCommit()}_normalizeZeros(e){const i=this._removeThousandsSeparators(e).split(this.radix);return i[0]=i[0].replace(/^(\D*)(0*)(\d*)/,(a,s,d,m)=>s+m),e.length&&!/\d$/.test(i[0])&&(i[0]=i[0]+"0"),i.length>1&&(i[1]=i[1].replace(/0*$/,""),i[1].length||(i.length=1)),this._insertThousandsSeparators(i.join(this.radix))}_padFractionalZeros(e){if(!e)return e;const i=e.split(this.radix);return i.length<2&&i.push(""),i[1]=i[1].padEnd(this.scale,"0"),i.join(this.radix)}doSkipInvalid(e,i,a){void 0===i&&(i={});const s=0===this.scale&&e!==this.thousandsSeparator&&(e===this.radix||e===j.UNMASKED_RADIX||this.mapToRadix.includes(e));return super.doSkipInvalid(e,i,a)&&!s}get unmaskedValue(){return this._removeThousandsSeparators(this._normalizeZeros(this.value)).replace(this.radix,j.UNMASKED_RADIX)}set unmaskedValue(e){super.unmaskedValue=e}get typedValue(){return this.parse(this.unmaskedValue,this)}set typedValue(e){this.rawInputValue=this.format(e,this).replace(j.UNMASKED_RADIX,this.radix)}get number(){return this.typedValue}set number(e){this.typedValue=e}get allowNegative(){return null!=this.min&&this.min<0||null!=this.max&&this.max<0}get allowPositive(){return null!=this.min&&this.min>0||null!=this.max&&this.max>0}typedValueEquals(e){return(super.typedValueEquals(e)||j.EMPTY_VALUES.includes(e)&&j.EMPTY_VALUES.includes(this.typedValue))&&!(0===e&&""===this.value)}}j.UNMASKED_RADIX=".",j.EMPTY_VALUES=[...G.EMPTY_VALUES,0],j.DEFAULTS={mask:Number,radix:",",thousandsSeparator:"",mapToRadix:[j.UNMASKED_RADIX],min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,scale:2,normalizeZeros:!0,padFractionalZeros:!1,parse:Number,format:g=>g.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:20})},v.MaskedNumber=j;const mt={MASKED:"value",UNMASKED:"unmaskedValue",TYPED:"typedValue"};function Tt(g,e,i){void 0===e&&(e=mt.MASKED),void 0===i&&(i=mt.MASKED);const a=K(g);return s=>a.runIsolated(d=>(d[e]=s,d[i]))}v.PIPE_TYPE=mt,v.createPipe=Tt,v.pipe=function Ft(g,e,i,a){return Tt(e,i,a)(g)};try{globalThis.IMask=v}catch(g){}var kt=_(16676),W=_(52374),pt=_(69862),It=_(96814),St=_(85893),ot=_(89515);const yt=function(g){return{flipped:g}};class ft{constructor(e){this.http=e,this.creditCardTypeDetected=new t.vpe,this.flipped=!1,this.year=(kt().year()+1).toString().slice(2),this.ccImage="",this.color="grey",this.name="Mario Rossi",this.number="0123 4567 8910 1112",this.expiration="01/"+this.year,this.securityCode="985"}ngOnInit(){this.http.get("/assets/images/booking/credit-card/american-express.svg",{responseType:"text"}).subscribe({next:e=>{this.americanExpress=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/visa.svg",{responseType:"text"}).subscribe({next:e=>{this.visa=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/diners.svg",{responseType:"text"}).subscribe({next:e=>{this.diners=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/discover.svg",{responseType:"text"}).subscribe({next:e=>{this.discover=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/jcb.svg",{responseType:"text"}).subscribe({next:e=>{this.jcb=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/maestro.svg",{responseType:"text"}).subscribe({next:e=>{this.maestro=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/mastercard.svg",{responseType:"text"}).subscribe({next:e=>{this.mastercard=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/unionpay.svg",{responseType:"text"}).subscribe({next:e=>{this.unionpay=e},error:()=>{}})}ngAfterViewInit(){let e=v(this.cardNumberInput,{mask:[{mask:"0000 000000 00000",regex:"^3[47]\\d{0,13}",cardtype:"american express"},{mask:"0000 0000 0000 0000",regex:"^(?:6011|65\\d{0,2}|64[4-9]\\d?)\\d{0,12}",cardtype:"discover"},{mask:"0000 000000 0000",regex:"^3(?:0([0-5]|9)|[689]\\d?)\\d{0,11}",cardtype:"diners"},{mask:"0000 0000 0000 0000",regex:"^(5[1-5]\\d{0,2}|22[2-9]\\d{0,1}|2[3-7]\\d{0,2})\\d{0,12}",cardtype:"mastercard"},{mask:"0000 000000 00000",regex:"^(?:2131|1800)\\d{0,11}",cardtype:"jcb15"},{mask:"0000 0000 0000 0000",regex:"^(?:35\\d{0,2})\\d{0,12}",cardtype:"jcb"},{mask:"0000 0000 0000 0000",regex:"^(?:5[0678]\\d{0,2}|6304|67\\d{0,2})\\d{0,12}",cardtype:"maestro"},{mask:"0000 0000 0000 0000",regex:"^4\\d{0,15}",cardtype:"visa"},{mask:"0000 0000 0000 0000",regex:"^62\\d{0,14}",cardtype:"unionpay"},{mask:"0000 0000 0000 0000",cardtype:"Unknown"}],dispatch:(s,d,m)=>{let C=(d.value+s).replace(/\D/g,"");for(let x of d.compiledMasks){let y=new RegExp(x.regex);if(null!=C.match(y))return x}}}),i=v(this.expirationDateInput,{mask:"MM{/}YY",blocks:{YY:{mask:v.MaskedRange,placeholderChar:"YY",from:0,to:99,maxLength:2},MM:{mask:v.MaskedRange,placeholderChar:"MM",from:1,to:12,maxLength:2}}}),a=v(this.securityCodeInput,{mask:"0000"});e.on("accept",()=>{switch(e.masked.currentMask.cardtype){case"american express":this.ccImage=this.americanExpress,this.color="green",this.creditCardTypeDetected.emit(W.Cf.AmericanExpress);break;case"visa":this.ccImage=this.visa,this.color="lime",this.creditCardTypeDetected.emit(W.Cf.Visa);break;case"diners":this.ccImage=this.diners,this.color="orange",this.creditCardTypeDetected.emit(W.Cf.DinersClub);break;case"discover":this.ccImage=this.discover,this.color="purple",this.creditCardTypeDetected.emit(W.Cf.DiscoveryCard);break;case"jcb":case"jcb15":this.ccImage=this.jcb,this.color="red",this.creditCardTypeDetected.emit(W.Cf.JCB);break;case"maestro":this.ccImage=this.maestro,this.color="yellow",this.creditCardTypeDetected.emit(W.Cf.Maestro);break;case"mastercard":this.ccImage=this.mastercard,this.color="lightblue",this.creditCardTypeDetected.emit(W.Cf.MasterCard);break;case"unionpay":this.ccImage=this.unionpay,this.color="cyan",this.creditCardTypeDetected.emit(W.Cf.ChinaUnionPay);break;default:this.ccImage="",this.color="grey",this.creditCardTypeDetected.emit(null)}}),this.nameInput.addEventListener("input",()=>{this.nameInput.value?this.name=this.nameInput.value:this.name="Mario Rossi"}),e.on("accept",()=>{e.value?this.number=e.value:this.number="0123 4567 8910 1112"}),i.on("accept",()=>{i.value?this.expiration=i.value:this.expiration="01/"+this.year}),a.on("accept",()=>{a.value?this.securityCode=a.value:this.securityCode="985"}),this.nameInput.addEventListener("focus",()=>{this.flipped=!1}),this.cardNumberInput.addEventListener("focus",()=>{this.flipped=!1}),this.expirationDateInput.addEventListener("focus",()=>{this.flipped=!1}),this.securityCodeInput.addEventListener("focus",()=>{this.flipped=!0})}}ft.\u0275fac=function(e){return new(e||ft)(t.Y36(pt.eN))},ft.\u0275cmp=t.Xpm({type:ft,selectors:[["app-credit-card"]],inputs:{nameInput:"nameInput",cardNumberInput:"cardNumberInput",expirationDateInput:"expirationDateInput",securityCodeInput:"securityCodeInput"},outputs:{creditCardTypeDetected:"creditCardTypeDetected"},decls:76,vars:31,consts:[[1,"creditcard",3,"ngClass","click"],[1,"front"],["front",""],["id","ccsingle",3,"innerHtml"],["version","1.1","id","cardfront","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","viewBox","0 0 750 471",0,"xml","space","preserve",2,"enable-background","new 0 0 750 471"],["id","Front"],["id","CardBackground"],["id","Page-1_1_"],["id","amex_1_"],["id","Rectangle-1_1_","d","M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40\n                    C0,17.9,17.9,0,40,0z"],["d","M750,431V193.2c-217.6-57.5-556.4-13.5-750,24.9V431c0,22.1,17.9,40,40,40h670C732.1,471,750,453.1,750,431z"],["transform","matrix(1 0 0 1 60.106 295.0121)",1,"st2","st3","st4"],["transform","matrix(1 0 0 1 54.1064 428.1723)",1,"st2","st5","st6"],["transform","matrix(1 0 0 1 54.1074 389.8793)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 479.7754 388.8793)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 65.1054 241.5)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 574.4219 433.8095)",1,"st2","st5","st9"],["transform","matrix(1 0 0 1 479.3848 417.0097)",1,"st2","st10","st11"],["transform","matrix(1 0 0 1 479.3848 435.6762)",1,"st2","st10","st11"],["points","554.5,421 540.4,414.2 540.4,427.9",1,"st2"],["id","cchip"],["d","M168.1,143.6H82.9c-10.2,0-18.5-8.3-18.5-18.5V74.9c0-10.2,8.3-18.5,18.5-18.5h85.3\n                c10.2,0,18.5,8.3,18.5,18.5v50.2C186.6,135.3,178.3,143.6,168.1,143.6z",1,"st2"],["x","82","y","70","width","1.5","height","60",1,"st12"],["x","167.4","y","70","width","1.5","height","60",1,"st12"],["d","M125.5,130.8c-10.2,0-18.5-8.3-18.5-18.5c0-4.6,1.7-8.9,4.7-12.3c-3-3.4-4.7-7.7-4.7-12.3\n                    c0-10.2,8.3-18.5,18.5-18.5s18.5,8.3,18.5,18.5c0,4.6-1.7,8.9-4.7,12.3c3,3.4,4.7,7.7,4.7,12.3\n                    C143.9,122.5,135.7,130.8,125.5,130.8z M125.5,70.8c-9.3,0-16.9,7.6-16.9,16.9c0,4.4,1.7,8.6,4.8,11.8l0.5,0.5l-0.5,0.5\n                    c-3.1,3.2-4.8,7.4-4.8,11.8c0,9.3,7.6,16.9,16.9,16.9s16.9-7.6,16.9-16.9c0-4.4-1.7-8.6-4.8-11.8l-0.5-0.5l0.5-0.5\n                    c3.1-3.2,4.8-7.4,4.8-11.8C142.4,78.4,134.8,70.8,125.5,70.8z",1,"st12"],["x","82.8","y","82.1","width","25.8","height","1.5",1,"st12"],["x","82.8","y","117.9","width","26.1","height","1.5",1,"st12"],["x","142.4","y","82.1","width","25.8","height","1.5",1,"st12"],["x","142","y","117.9","width","26.2","height","1.5",1,"st12"],["id","Back"],[1,"back"],["version","1.1","id","cardback","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","viewBox","0 0 750 471",0,"xml","space","preserve",2,"enable-background","new 0 0 750 471"],["x1","35.3","y1","10.4","x2","36.7","y2","11",1,"st0"],["id","Page-1_2_"],["id","amex_2_"],["id","Rectangle-1_2_","d","M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40\n                C0,17.9,17.9,0,40,0z"],["y","61.6","width","750","height","78",1,"st2"],["d","M701.1,249.1H48.9c-3.3,0-6-2.7-6-6v-52.5c0-3.3,2.7-6,6-6h652.1c3.3,0,6,2.7,6,6v52.5\n            C707.1,246.4,704.4,249.1,701.1,249.1z",1,"st3"],["x","42.9","y","198.6","width","664.1","height","10.5",1,"st4"],["x","42.9","y","224.5","width","664.1","height","10.5",1,"st4"],["d","M701.1,184.6H618h-8h-10v64.5h10h8h83.1c3.3,0,6-2.7,6-6v-52.5C707.1,187.3,704.4,184.6,701.1,184.6z",1,"st5"],["transform","matrix(1 0 0 1 621.999 227.2734)",1,"st6","st7"],[1,"st8"],["transform","matrix(1 0 0 1 518.083 280.0879)",1,"st9","st6","st10"],["x","58.1","y","378.6","width","375.5","height","13.5",1,"st11"],["x","58.1","y","405.6","width","421.7","height","13.5",1,"st11"],["transform","matrix(1 0 0 1 59.5073 228.6099)",1,"st12","st13"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0),t.NdJ("click",function(){return i.flipped=!i.flipped}),t.TgZ(1,"div",1,2),t._UZ(3,"div",3),t.ALo(4,"safeHtml"),t.O4$(),t.TgZ(5,"svg",4)(6,"g",5)(7,"g",6)(8,"g",7)(9,"g",8),t._UZ(10,"path",9),t.qZA()(),t._UZ(11,"path",10),t.qZA(),t.TgZ(12,"text",11),t._uU(13),t.qZA(),t.TgZ(14,"text",12),t._uU(15),t.qZA(),t.TgZ(16,"text",13),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"text",14),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"text",15),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"g")(26,"text",16),t._uU(27),t.qZA(),t.TgZ(28,"text",17),t._uU(29,"VALID"),t.qZA(),t.TgZ(30,"text",18),t._uU(31,"THRU"),t.qZA(),t._UZ(32,"polygon",19),t.qZA(),t.TgZ(33,"g",20)(34,"g"),t._UZ(35,"path",21),t.qZA(),t.TgZ(36,"g")(37,"g"),t._UZ(38,"rect",22),t.qZA(),t.TgZ(39,"g"),t._UZ(40,"rect",23),t.qZA(),t.TgZ(41,"g"),t._UZ(42,"path",24),t.qZA(),t.TgZ(43,"g"),t._UZ(44,"rect",25),t.qZA(),t.TgZ(45,"g"),t._UZ(46,"rect",26),t.qZA(),t.TgZ(47,"g"),t._UZ(48,"rect",27),t.qZA(),t.TgZ(49,"g"),t._UZ(50,"rect",28),t.qZA()()()(),t._UZ(51,"g",29),t.qZA()(),t.kcU(),t.TgZ(52,"div",30),t.O4$(),t.TgZ(53,"svg",31)(54,"g",5),t._UZ(55,"line",32),t.qZA(),t.TgZ(56,"g",29)(57,"g",33)(58,"g",34),t._UZ(59,"path",35),t.qZA()(),t._UZ(60,"rect",36),t.TgZ(61,"g"),t._UZ(62,"path",37)(63,"rect",38)(64,"rect",39)(65,"path",40),t.qZA(),t.TgZ(66,"text",41),t._uU(67),t.qZA(),t.TgZ(68,"g",42)(69,"text",43),t._uU(70),t.ALo(71,"translate"),t.qZA()(),t._UZ(72,"rect",44)(73,"rect",45),t.TgZ(74,"text",46),t._uU(75),t.qZA()()()()()),2&e){const a=t.MAs(2);t.Udp("height",a.offsetHeight,"px"),t.Q6J("ngClass",t.VKq(29,yt,i.flipped)),t.xp6(3),t.Q6J("innerHtml",t.lcZ(4,19,i.ccImage),t.oJD),t.xp6(7),t.Tol("lightcolor "+i.color),t.xp6(1),t.Tol("darkcolor "+i.color+"dark"),t.xp6(2),t.Oqu(i.number),t.xp6(2),t.Oqu(i.name),t.xp6(2),t.Oqu(t.lcZ(18,21,"interfaces.pagamento-form.titolare")),t.xp6(3),t.Oqu(t.lcZ(21,23,"interfaces.pagamento-form.scadenza")),t.xp6(3),t.Oqu(t.lcZ(24,25,"interfaces.pagamento-form.numero")),t.xp6(4),t.Oqu(i.expiration),t.xp6(32),t.Tol("darkcolor "+i.color+"dark"),t.xp6(8),t.Oqu(i.securityCode),t.xp6(3),t.Oqu(t.lcZ(71,27,"interfaces.pagamento-form.codiceSicurezza")),t.xp6(5),t.Oqu(i.name)}},dependencies:[It.mk,St.z,ot.X$],styles:["#ccsingle[_ngcontent-%COMP%]{position:absolute;right:15px;top:20px}  #ccsingle svg{width:100px;max-height:60px}.creditcard[_ngcontent-%COMP%]   svg#cardfront[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   svg#cardback[_ngcontent-%COMP%]{width:100%;box-shadow:0 3px 3px -2px #0003,0 3px 4px #00000024,0 1px 8px #0000001f;border-radius:22px}.creditcard[_ngcontent-%COMP%]   .lightcolor[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   .darkcolor[_ngcontent-%COMP%]{transition:fill .5s}.creditcard[_ngcontent-%COMP%]   .lightblue[_ngcontent-%COMP%]{fill:#03a9f4}.creditcard[_ngcontent-%COMP%]   .lightbluedark[_ngcontent-%COMP%]{fill:#0288d1}.creditcard[_ngcontent-%COMP%]   .red[_ngcontent-%COMP%]{fill:#ef5350}.creditcard[_ngcontent-%COMP%]   .reddark[_ngcontent-%COMP%]{fill:#d32f2f}.creditcard[_ngcontent-%COMP%]   .purple[_ngcontent-%COMP%]{fill:#ab47bc}.creditcard[_ngcontent-%COMP%]   .purpledark[_ngcontent-%COMP%]{fill:#7b1fa2}.creditcard[_ngcontent-%COMP%]   .cyan[_ngcontent-%COMP%]{fill:#26c6da}.creditcard[_ngcontent-%COMP%]   .cyandark[_ngcontent-%COMP%]{fill:#0097a7}.creditcard[_ngcontent-%COMP%]   .green[_ngcontent-%COMP%]{fill:#66bb6a}.creditcard[_ngcontent-%COMP%]   .greendark[_ngcontent-%COMP%]{fill:#388e3c}.creditcard[_ngcontent-%COMP%]   .lime[_ngcontent-%COMP%]{fill:#d4e157}.creditcard[_ngcontent-%COMP%]   .limedark[_ngcontent-%COMP%]{fill:#afb42b}.creditcard[_ngcontent-%COMP%]   .yellow[_ngcontent-%COMP%]{fill:#ffeb3b}.creditcard[_ngcontent-%COMP%]   .yellowdark[_ngcontent-%COMP%]{fill:#f9a825}.creditcard[_ngcontent-%COMP%]   .orange[_ngcontent-%COMP%]{fill:#ff9800}.creditcard[_ngcontent-%COMP%]   .orangedark[_ngcontent-%COMP%]{fill:#ef6c00}.creditcard[_ngcontent-%COMP%]   .grey[_ngcontent-%COMP%]{fill:#bdbdbd}.creditcard[_ngcontent-%COMP%]   .greydark[_ngcontent-%COMP%]{fill:#616161}#svgname[_ngcontent-%COMP%]{text-transform:uppercase}#cardfront[_ngcontent-%COMP%]   .st2[_ngcontent-%COMP%]{fill:#fff}#cardfront[_ngcontent-%COMP%]   .st3[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:600}#cardfront[_ngcontent-%COMP%]   .st4[_ngcontent-%COMP%]{font-size:54.7817px}#cardfront[_ngcontent-%COMP%]   .st5[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:400}#cardfront[_ngcontent-%COMP%]   .st6[_ngcontent-%COMP%]{font-size:33.1112px}#cardfront[_ngcontent-%COMP%]   .st7[_ngcontent-%COMP%]{opacity:.6;fill:#fff}#cardfront[_ngcontent-%COMP%]   .st8[_ngcontent-%COMP%]{font-size:24px}#cardfront[_ngcontent-%COMP%]   .st9[_ngcontent-%COMP%]{font-size:36.5498px}#cardfront[_ngcontent-%COMP%]   .st10[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:300}#cardfront[_ngcontent-%COMP%]   .st11[_ngcontent-%COMP%]{font-size:16.1716px}#cardfront[_ngcontent-%COMP%]   .st12[_ngcontent-%COMP%]{fill:#4c4c4c}#cardback[_ngcontent-%COMP%]   .st0[_ngcontent-%COMP%]{fill:none;stroke:#0f0f0f;stroke-miterlimit:10}#cardback[_ngcontent-%COMP%]   .st2[_ngcontent-%COMP%]{fill:#111}#cardback[_ngcontent-%COMP%]   .st3[_ngcontent-%COMP%]{fill:#f2f2f2}#cardback[_ngcontent-%COMP%]   .st4[_ngcontent-%COMP%]{fill:#d8d2db}#cardback[_ngcontent-%COMP%]   .st5[_ngcontent-%COMP%]{fill:#c4c4c4}#cardback[_ngcontent-%COMP%]   .st6[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:400}#cardback[_ngcontent-%COMP%]   .st7[_ngcontent-%COMP%]{font-size:27px}#cardback[_ngcontent-%COMP%]   .st8[_ngcontent-%COMP%]{opacity:.6}#cardback[_ngcontent-%COMP%]   .st9[_ngcontent-%COMP%]{fill:#fff}#cardback[_ngcontent-%COMP%]   .st10[_ngcontent-%COMP%]{font-size:24px}#cardback[_ngcontent-%COMP%]   .st11[_ngcontent-%COMP%]{fill:#eaeaea}#cardback[_ngcontent-%COMP%]   .st12[_ngcontent-%COMP%]{font-family:Rock Salt,cursive}#cardback[_ngcontent-%COMP%]   .st13[_ngcontent-%COMP%]{font-size:37.769px}.creditcard[_ngcontent-%COMP%]{width:100%;max-width:400px;transform-style:preserve-3d;transition:transform .6s;cursor:pointer}.creditcard[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{position:absolute;width:100%;max-width:400px;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-font-smoothing:antialiased;color:#47525d}.creditcard[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%], .creditcard.flipped[_ngcontent-%COMP%]{transform:rotateY(180deg)}"]})},32549:(At,$,_)=>{_.d($,{Q:()=>Ct});var t=_(65879),D=_(16676),U=_(14090),f=_(6556),k=_(86107),c=_(52374),tt=_(20553),R=_(2353),w=_(96814),L=_(56223),b=_(22165),v=_(89515);function Q(r,o){if(1&r&&(t.TgZ(0,"h4"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const n=t.oxw(4);t.xp6(1),t.Oqu(t.lcZ(2,1,n.title))}}const et=function(r){return{"mt-3":r}};function ct(r,o){if(1&r&&(t.TgZ(0,"div",4),t._UZ(1,"app-inner-html",5),t.qZA()),2&r){const n=t.oxw(5);t.Q6J("ngClass",t.VKq(2,et,!!n.title)),t.xp6(1),t.Q6J("_text",n.text)}}function K(r,o){if(1&r&&(t.TgZ(0,"div",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const n=t.oxw(5);t.Q6J("ngClass",t.VKq(4,et,!!n.title)),t.xp6(1),t.hij(" ",t.lcZ(2,2,n.text)," ")}}function Z(r,o){if(1&r&&(t.ynx(0),t.YNc(1,ct,2,4,"div",3),t.YNc(2,K,3,6,"div",3),t.BQk()),2&r){const n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.html),t.xp6(1),t.Q6J("ngIf",!n.html)}}function P(r,o){if(1&r&&(t.ynx(0),t.YNc(1,Q,3,3,"h4",0),t.YNc(2,Z,3,2,"ng-container",0),t.BQk()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!!n.title),t.xp6(1),t.Q6J("ngIf",!!n.text)}}const E=function(r){return{"hobex-container-hidden":r}},I=function(r,o){return{visibility:r,"z-index":o}};function z(r,o){if(1&r&&(t.TgZ(0,"div",4),t._UZ(1,"form",6)(2,"iframe",7),t.qZA()),2&r){const n=t.oxw(3);t.Q6J("ngClass",t.VKq(3,E,n.hobexPaymentSubmitted)),t.xp6(1),t.Q6J("action",n.paymentSuccessUrl,t.LSH),t.xp6(1),t.Q6J("ngStyle",t.WLB(5,I,n.hobexPaymentSubmitted?"visible":"hidden",n.hobexPaymentSubmitted?1:-1))}}function Y(r,o){if(1&r&&(t.ynx(0),t.YNc(1,P,3,2,"ng-container",0),t.YNc(2,z,3,8,"div",3),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!n.hobexTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.hobexTransactionId)}}function T(r,o){1&r&&t._UZ(0,"div",8)}function st(r,o){if(1&r&&(t.ynx(0),t.YNc(1,Y,3,2,"ng-container",0),t.YNc(2,T,1,0,"div",2),t.BQk()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",!n.sumupTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.sumupTransactionId)}}function G(r,o){1&r&&t._UZ(0,"div",9)}class rt extends U.H{constructor(o){super(),this.utility=o,this.HOBEX_JS_URL="https://oppwa.com/v1/paymentWidgets.js?checkoutId=",this.HOBEX_JS_URL_TEST="https://test.oppwa.com/v1/paymentWidgets.js?checkoutId=",this.AXEPTA_URL="https://pay.axepta.it",this.AXEPTA_URL_TEST="https://pay-sandbox.axepta.it",this.hobexPaymentSubmitted=!1}ngAfterViewInit(){if(this.sumupTransactionId)SumUpCard.mount({checkoutId:this.sumupTransactionId,locale:"it"==this.lingua?"it-IT":"en-GB",onResponse:(o,n)=>{switch(o){case"sent":this.setIsLoading(!0);break;case"invalid":break;case"auth-screen":this.setIsLoading(!1);break;case"error":this.setIsLoading(!1),this.dialogRef.close();break;case"success":this.dialogRef.close(!0)}}});else if(this.hobexTransactionId){if(void 0!==window.wpwl&&void 0!==window.wpwl.unload&&window.wpwl.unload(),void 0!==window.wpwlOptions)window.wpwlOptions.locale=this.lingua;else{let o=this;window.wpwlOptions={locale:this.lingua,paymentTarget:"hobexIFrame",shopperResultTarget:"hobexIFrame",labels:{cvv:"CVV"},onAfterSubmit:function(){o.hobexPaymentSubmitted=!0}}}this.utility.loadExternalScript((this.isTest?this.HOBEX_JS_URL_TEST:this.HOBEX_JS_URL)+this.hobexTransactionId,null,"hobex-script").then(()=>{this.setIsLoading(!1)})}else this.axeptaTransactionId&&new AxeptaSDKClient(this.isTest?this.AXEPTA_URL_TEST:this.AXEPTA_URL,this.axeptaApiKeySmartCheckout).preparePayment(this.axeptaTransactionId)}}rt.\u0275fac=function(o){return new(o||rt)(t.Y36(R.t))},rt.\u0275cmp=t.Xpm({type:rt,selectors:[["app-pagamento-form-dialog"]],inputs:{html:"html",title:"title",text:"text",sumupTransactionId:"sumupTransactionId",hobexTransactionId:"hobexTransactionId",axeptaTransactionId:"axeptaTransactionId",paymentSuccessUrl:"paymentSuccessUrl",axeptaApiKeySmartCheckout:"axeptaApiKeySmartCheckout",isTest:"isTest",lingua:"lingua",dialogRef:"dialogRef"},features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["id","my-axepta-sdk-pg",4,"ngIf"],["id","sumup-card",4,"ngIf"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],[3,"_text"],["data-brands","VISA MASTER",1,"paymentWidgets",3,"action"],["name","hobexIFrame","width","100%","height","100%","frameborder","0",1,"hobexIFrame",3,"ngStyle"],["id","sumup-card"],["id","my-axepta-sdk-pg"]],template:function(o,n){1&o&&(t.YNc(0,st,3,2,"ng-container",0),t.YNc(1,G,1,0,"div",1)),2&o&&(t.Q6J("ngIf",!n.axeptaTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.axeptaTransactionId))},dependencies:[w.mk,w.O5,w.PC,L._Y,L.JL,L.F,b.W,v.X$],styles:[".wpwl-form{margin:0!important;border-radius:0!important}.hobexIFrame[_ngcontent-%COMP%]{position:absolute;top:0;left:0}  .hobex-container-hidden .wpwl-container{visibility:hidden!important}  #axepta-sdk-main-container{margin:0!important;padding:1rem!important}"]});var ut=_(94505),p=_(27599);class M{constructor(){}onOpenWindowClick(){this.dialogRef.close(window.open(this.paymentUrl))}}M.\u0275fac=function(o){return new(o||M)},M.\u0275cmp=t.Xpm({type:M,selectors:[["app-payment-window-error"]],inputs:{paymentUrl:"paymentUrl",dialogRef:"dialogRef"},decls:10,vars:7,consts:[["mat-icon-button","",1,"modal-close-button",3,"matDialogClose","disableRipple"],[1,"material-icons-round"],[1,"font-weight-bold"],[1,"mt-3","text-center"],["mat-flat-button","",1,"button-blue",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"button",0)(1,"i",1),t._uU(2,"clear"),t.qZA()(),t.TgZ(3,"div",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return n.onOpenWindowClick()}),t._uU(8),t.ALo(9,"translate"),t.qZA()()),2&o&&(t.Q6J("disableRipple",!0),t.xp6(4),t.hij(" ",t.lcZ(5,3,"interfaces.pagamento-form.pagamentoBloccato"),"\n"),t.xp6(4),t.Oqu(t.lcZ(9,5,"interfaces.pagamento-form.apriFinestraPagamento")))},dependencies:[ut.eB,p.aO,v.X$]});var S=_(19209),B=_(93724),it=_(4731),Pt=_(30724),V=_(45754),gt=_(75986),X=_(84187),J=_(42400),bt=_(24678),O=_(48424),at=_(87958),lt=_(17679),N=_(70061),ht=_(1477),A=_(25742);function nt(r,o){if(1&r&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&r){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n.nome," ")}}function j(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"app-inner-html",22),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("_text",n.model.modalitaPagamento.note)}}function mt(r,o){if(1&r&&(t.TgZ(0,"div",21)(1,"span",23),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",24),t._uU(5),t.ALo(6,"eurCurrency"),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"interfaces.pagamento-form.caparra")," "),t.xp6(3),t.hij(" ",t.Dn7(6,4,n.model.modalitaPagamento.caparraTotale,null,n.valuta)," ")}}function Tt(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"holipay-checkout-widget"),t.ALo(2,"replace"),t.ALo(3,"number"),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.uIk("checkin",n.getDate(n.arrivo))("checkout",n.getDate(n.partenza))("price",t.Dn7(2,4,t.xi3(3,8,n.getImportoPagamento(),"1.2-2"),",",""))("locale",n.lingua)}}function Ft(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"scalapay-widget",25),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.uIk("amount",n.getImportoPagamento())("min",0)("max",999999)("locale",n.lingua)}}function kt(r,o){if(1&r&&(t.ynx(0),t.YNc(1,j,2,1,"div",20),t.YNc(2,mt,7,8,"div",20),t.YNc(3,Tt,4,11,"div",20),t.YNc(4,Ft,2,4,"div",20),t.BQk()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.note),t.xp6(1),t.Q6J("ngIf",n.showCaparra&&n.model.modalitaPagamento.caparraTotale>0),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.Holipay),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.ScalaPay)}}function W(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"app-inner-html",22),t.qZA()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("_text",n.model.modalitaPagamento.note)}}function pt(r,o){if(1&r&&(t.TgZ(0,"div",21)(1,"span",23),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",24),t._uU(5),t.ALo(6,"eurCurrency"),t.qZA()()),2&r){const n=t.oxw(3);t.xp6(2),t.hij(" ",t.lcZ(3,2,"interfaces.pagamento-form.caparra")," "),t.xp6(3),t.hij(" ",t.Dn7(6,4,n.model.modalitaPagamento.caparraTotale,null,n.valuta)," ")}}function It(r,o){if(1&r&&t._UZ(0,"img",40),2&r){const n=o.$implicit;t.Q6J("src",n,t.LSH)}}function St(r,o){if(1&r&&(t.TgZ(0,"div",38),t.YNc(1,It,1,1,"img",39),t.qZA()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",n.immaginiCarteCredito)}}function ot(r,o){if(1&r&&(t.ynx(0),t.YNc(1,W,2,1,"div",20),t.YNc(2,pt,7,8,"div",20),t.YNc(3,St,2,1,"div",37),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.note),t.xp6(1),t.Q6J("ngIf",n.showCaparra&&n.model.modalitaPagamento.caparraTotale>0),t.xp6(1),t.Q6J("ngIf",null!=n.immaginiCarteCredito&&n.immaginiCarteCredito.length>0)}}function yt(r,o){if(1&r&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&r){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n.nome," ")}}function ft(r,o){if(1&r&&(t.TgZ(0,"div",41)(1,"div",42),t._uU(2),t.ALo(3,"translate"),t.TgZ(4,"div",43),t._UZ(5,"img",44)(6,"img",45),t.qZA()(),t.TgZ(7,"div",46),t._UZ(8,"app-credit-card",47),t.qZA()()),2&r){t.oxw();const n=t.MAs(28),h=t.MAs(13),l=t.MAs(24),u=t.MAs(19);t.xp6(2),t.hij(" ",t.lcZ(3,5,"interfaces.pagamento-form.crittografiaCarte")," "),t.xp6(6),t.Q6J("nameInput",n)("cardNumberInput",h)("expirationDateInput",l)("securityCodeInput",u)}}const g=function(r,o){return{"col-12 col-md-8":r,"col-12":o}};function e(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"div",26)(2,"div",27),t.YNc(3,ot,4,3,"ng-container",7),t.TgZ(4,"div",26)(5,"div",28)(6,"mat-form-field",29)(7,"mat-select",30),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.tipoCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(8,"translate"),t.YNc(9,yt,2,2,"mat-option",6),t.qZA()()(),t.TgZ(10,"div",28)(11,"mat-form-field",29)(12,"input",31,32),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.numeroCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(14,"translate"),t.qZA()()()(),t.TgZ(15,"div",26)(16,"div",28)(17,"mat-form-field",29)(18,"input",31,33),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.codiceSicurezza=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(20,"translate"),t.qZA()()(),t.TgZ(21,"div",28)(22,"mat-form-field",29)(23,"input",31,34),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.dataScadenza=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return l.splitDataScadenza(),t.KtG(l.verifyValidity())}),t.ALo(25,"translate"),t.qZA()()()(),t.TgZ(26,"mat-form-field",29)(27,"input",31,35),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.titolareCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(29,"translate"),t.qZA()()(),t.YNc(30,ft,9,7,"div",36),t.qZA()()}if(2&r){const n=t.oxw();t.xp6(2),t.Q6J("ngClass",t.WLB(34,g,!n.disabled,n.disabled)),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(4),t.Q6J("panelClass","booking-select-unlimited-height")("ngModel",n.model.tipoCarta)("placeholder",t.lcZ(8,24,"interfaces.pagamento-form.tipoCarta"))("disabled",n.disabled),t.xp6(2),t.Q6J("ngForOf",n.carteCredito),t.xp6(3),t.Q6J("ngModel",n.model.numeroCarta)("placeholder",t.lcZ(14,26,"interfaces.pagamento-form.numero"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(6),t.Q6J("ngModel",n.model.codiceSicurezza)("placeholder",t.lcZ(20,28,"interfaces.pagamento-form.codiceSicurezza"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(5),t.Q6J("ngModel",n.dataScadenza)("placeholder",t.lcZ(25,30,"interfaces.pagamento-form.scadenza"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(4),t.Q6J("ngModel",n.model.titolareCarta)("placeholder",t.lcZ(29,32,"interfaces.pagamento-form.titolare"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(3),t.Q6J("ngIf",!n.disabled)}}function i(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.banca")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.banca)}}function a(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.intestatario")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.intestatarioConto)}}function s(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.iban")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.iban)}}function d(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.swift")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.swift)}}function m(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",56)(1,"a",57),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(3);return l.preventDefault(),t.KtG(u.openCroDialog())}),t._uU(2),t.ALo(3,"translate"),t.qZA()()}2&r&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"interfaces.pagamento-form.cosaSignifica")))}function C(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",26)(1,"div",53)(2,"mat-form-field",29)(3,"input",54),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw(2);return t.KtG(u.model.codiceRiferimentoOperazione=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.verifyValidity())}),t.ALo(4,"translate"),t.qZA()()(),t.YNc(5,m,4,3,"div",55),t.qZA()}if(2&r){const n=t.oxw(2);t.xp6(3),t.Q6J("ngModel",n.model.codiceRiferimentoOperazione)("placeholder",t.lcZ(4,5,"interfaces.pagamento-form.codiceRiferimentoOperazione"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(2),t.Q6J("ngIf",!n.disabled)}}const x=function(r){return{"mb-3":r}};function y(r,o){if(1&r&&(t.TgZ(0,"div")(1,"div",48),t.YNc(2,i,6,4,"div",49),t.YNc(3,a,6,4,"div",49),t.YNc(4,s,6,4,"div",49),t.YNc(5,d,6,4,"div",49),t.qZA(),t.YNc(6,C,6,7,"div",50),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(6,x,!n.isVisualizzaCRO)),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.banca),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.intestatarioConto),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.iban),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.swift),t.xp6(1),t.Q6J("ngIf",!n.disabled&&n.isVisualizzaCRO)}}function F(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"mat-checkbox",58),t.NdJ("change",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.privacy=l)}),t.TgZ(2,"a",59),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw();return l.preventDefault(),t.KtG(u.openPrivacyDialog())}),t._uU(3),t.ALo(4,"translate"),t.qZA()()()}if(2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngModel",n.model.privacy)("disabled",n.disabled),t.xp6(2),t.Oqu(t.lcZ(4,3,"interfaces.pagamento-form.privacy"))}}function H(r,o){1&r&&(t.TgZ(0,"span",63),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.accettoLeCondizioniDiContratto")))}function dt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"a",64),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(3);return l.preventDefault(),t.KtG(u.openCondizioniContrattoDialog())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.accettoLeCondizioniDiContratto")))}function Dt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"mat-checkbox",58),t.NdJ("change",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw(2);return t.KtG(u.contrattoAccettatto=l)}),t.YNc(1,H,3,3,"span",61),t.YNc(2,dt,3,3,"a",62),t.qZA()}if(2&r){const n=t.oxw(2);t.Q6J("ngModel",n.contrattoAccettatto)("disabled",n.disabled),t.xp6(1),t.Q6J("ngIf",!n.condizioniContratto),t.xp6(1),t.Q6J("ngIf",!!n.condizioniContratto)}}function Zt(r,o){if(1&r&&(t.TgZ(0,"div"),t.YNc(1,Dt,3,4,"mat-checkbox",60),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.isAccettaContrattoPrenotazioneStep2)}}function Rt(r,o){1&r&&(t.TgZ(0,"span",63),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.trattamentoDatiPersonali")))}function Mt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"a",67),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(2);return l.preventDefault(),t.KtG(u.openNewsletterDialog())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.trattamentoDatiPersonali")))}function xt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"mat-checkbox",65),t.NdJ("change",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.newsletter=l)}),t.YNc(2,Rt,3,3,"span",61),t.YNc(3,Mt,3,3,"a",66),t.qZA()()}if(2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngModel",n.model.newsletter)("disabled",n.disabled),t.xp6(1),t.Q6J("ngIf",null==n.newsLetterPortale||!n.newsLetterPortale.html&&!n.newsLetterPortale.url),t.xp6(1),t.Q6J("ngIf",!(null==n.newsLetterPortale||!n.newsLetterPortale.html&&!n.newsLetterPortale.url))}}function Lt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",68)(1,"re-captcha",69),t.NdJ("resolved",function(){t.CHM(n);const l=t.oxw();return l.recaptchaResolved=!0,t.KtG(l.verifyValidity())}),t.qZA()()}2&r&&(t.xp6(1),t.Q6J("siteKey","6LcsQ90ZAAAAAD6motJOcWzKpaG4R33OtsR7jVn1"))}const Ot=function(r){return{"w-100":r}};function wt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"button",72),t.NdJ("click",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.pay())}),t.TgZ(1,"span",73),t._uU(2,"check"),t.qZA(),t.TgZ(3,"span",52),t._uU(4),t.ALo(5,"translate"),t.qZA()()}if(2&r){const n=t.oxw(2);t.Q6J("ngClass",t.VKq(5,Ot,n.fullWidthButton))("disabled",!n.paymentFormValid||!n.formValid),t.xp6(4),t.Oqu(n.model.modalitaPagamento.testoBottonePaga?n.model.modalitaPagamento.testoBottonePaga:t.lcZ(5,3,"interfaces.pagamento-form.paga"))}}function Bt(r,o){if(1&r&&(t.TgZ(0,"div",70),t.YNc(1,wt,6,7,"button",71),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.PayPal)}}const _t=function(r){return{"mat-elevation-z5":r}};class Ct extends U.H{set _totale(o){this.totale=o,this.calculateCaparra()}set _isAccettaContrattoPrenotazioneStep2(o){null!=o&&(this.isAccettaContrattoPrenotazioneStep2=o,this.contrattoAccettatto=!o)}set _recaptchaAttiva(o){null!=o&&(this.recaptchaAttiva=o,this.recaptchaResolved=!o)}set linguaPortaleAlbergo(o){if(null!=o&&o.oidAlbergo&&o.lingua){this.oidAlbergo=o.oidAlbergo,this.oidPortale=o.oidPortale,this.lingua=o.lingua;let n=new k.F0x;if(n.oidAlbergo=this.oidAlbergo,n.oidPortale=this.oidPortale,n.lingua=this.lingua,this.apiService.getPagamentoFormView(n).subscribe(h=>{if(this.carteCredito=h.data.tipiCarteCredito,this.immaginiCarteCredito=[],null!=this.carteCredito&&this.carteCredito.length>0){this.model.tipoCarta=this.carteCredito[0];for(let l of this.carteCredito)if(null!=l.tipoCartaCredito){let u=this.immaginiTipiCarteCredito.get(l.tipoCartaCredito);u&&!this.immaginiCarteCredito.includes(u)&&this.immaginiCarteCredito.push(u)}}this.newsLetterPortale=h.data.newsLetterPortale}),null==this.modalitaPagamento||0==this.modalitaPagamento.length){this.gettingModalitaPagamentoDefault=!0;let h=new k.X00;h.oidAlbergo=this.oidAlbergo,h.lingua=this.lingua,this.apiService.getModalitaPagamentoDefault(h).subscribe(l=>{this.modalitaPagamentoSet?this.gettingModalitaPagamentoDefault1||(this.modalitaPagamentoSet=!1):null!=l.data?(this.modalitaPagamento=[l.data],this.model.modalitaPagamento=l.data,this.calculateCaparra()):(this.modalitaPagamento=[],this.model.modalitaPagamento=new k.XL7(-1),this.noPaymentMethod.emit()),this.gettingModalitaPagamentoDefault=!1})}}}set _modalitaPagamento(o){if(null!=o)if(this.modalitaPagamento=o,this.modalitaPagamento.length>0){if((this.gettingModalitaPagamentoDefault||this.gettingModalitaPagamentoDefault1)&&(this.modalitaPagamentoSet=!0),null==this.model.modalitaPagamento||this.model.modalitaPagamento.paymentId<=0)this.model.modalitaPagamento=this.modalitaPagamento[0];else{let n=this.modalitaPagamento.find(h=>h.paymentId==this.model.modalitaPagamento.paymentId);this.model.modalitaPagamento=null==n?this.modalitaPagamento[0]:n}this.calculateCaparra()}else if(this.oidAlbergo>0&&this.lingua){this.gettingModalitaPagamentoDefault1=!0;let n=new k.X00;n.oidAlbergo=this.oidAlbergo,n.lingua=this.lingua,this.apiService.getModalitaPagamentoDefault(n).subscribe(h=>{this.modalitaPagamentoSet?this.gettingModalitaPagamentoDefault||(this.modalitaPagamentoSet=!1):null!=h.data?(this.modalitaPagamento=[h.data],this.model.modalitaPagamento=h.data,this.calculateCaparra()):(this.modalitaPagamento=[],this.model.modalitaPagamento=new k.XL7(-1),this.noPaymentMethod.emit()),this.gettingModalitaPagamentoDefault1=!1})}}set _formValid(o){this.formValid=o,this.checkPaypalButtonEnabled()}set _camere(o){null!=o&&(null==this.camere||JSON.stringify(o)!=JSON.stringify(this.camere))&&(this.camere=o,this.calculateCaparra())}set allModalitaPagamento(o){null!=o&&setTimeout(()=>{let n=o.find(q=>q.tipo==c.sc.PayPal);null!=n&&this.initPaypalConfig(n.paypalClientId);let h=o.find(q=>q.tipo==c.sc.Stripe);null!=h&&null!=document.getElementById("card-number-element")&&this.utilityService.loadExternalScript(this.STRIPE_JS_URL).then(()=>{this.stripe=Stripe(h.stripePublicKey);let q=this.stripe.elements();this.cardNumberElement=q.create("cardNumber",{placeholder:""}),this.cardNumberElement.mount("#card-number-element"),this.cardNumberElement.on("change",Et=>{Et.complete?this.stripeCardNumberValid=!0:Et.error&&(this.stripeCardNumberValid=!1),this.verifyValidity()});let zt=q.create("cardExpiry");zt.mount("#card-expiry-element"),zt.on("change",Et=>{Et.complete?this.stripeExpirationValid=!0:Et.error&&(this.stripeExpirationValid=!1),this.verifyValidity()});let Nt=q.create("cardCvc",{placeholder:""});Nt.mount("#card-cvc-element"),Nt.on("change",Et=>{Et.complete?this.stripeCvcValid=!0:Et.error&&(this.stripeCvcValid=!1),this.verifyValidity()})});let l=o.find(q=>q.tipo==c.sc.Satispay);null!=l&&this.utilityService.loadExternalScript(l.isTest?this.SATISPAY_BUTTON_URL_TEST:this.SATISPAY_BUTTON_URL,[{name:"data-payment-id",value:"test"}]),null!=o.find(q=>q.tipo==c.sc.SumUp)&&this.utilityService.loadExternalScript(this.SUMUP_WIDGET_URL),null!=o.find(q=>q.tipo==c.sc.AddonPayments)&&this.utilityService.loadExternalScript(this.ADDON_PAYMENTS_LIGHTBOX_URL);let Ut=o.find(q=>q.tipo==c.sc.Axepta);null!=Ut&&this.utilityService.loadExternalScript(Ut.isTest?this.AXEPTA_JS_URL_TEST:this.AXEPTA_JS_URL);let Vt=o.find(q=>q.tipo==c.sc.Holipay);null!=Vt&&this.utilityService.loadExternalScript(this.HOLIPAY_WIDGET_URL+Vt.holipayHotelId),null!=o.find(q=>q.tipo==c.sc.ScalaPay)&&(this.utilityService.loadExternalScript(this.SCALAPAY_ESM_WIDGET_URL,[new k.u$m("type","module")]),this.utilityService.loadExternalScript(this.SCALAPAY_WIDGET_URL,[new k.u$m("nomodule")]))},500)}set _caparra(o){this.caparra=o,this.calculateCaparra()}set _isCaparraPercentuale(o){this.isCaparraPercentuale=o,this.calculateCaparra()}set privacy(o){null!=o&&(this.model.privacy=o,this.verifyValidity())}set newsletter(o){null!=o&&(this.model.newsletter=o)}beforeUnloadHandler(o){null!=this.window&&this.window.close()}constructor(o,n,h,l){super(),this.apiService=o,this.containerService=n,this.utilityService=h,this.localStorage=l,this.testEnvironment="localhost",this.enumTipoModalitaPagamento=c.sc,this.model=new k.l_j,this.modalitaPagamento=[],this.gettingModalitaPagamentoDefault=!1,this.gettingModalitaPagamentoDefault1=!1,this.modalitaPagamentoSet=!1,this.immaginiCarteCredito=[],this.pagamentoSuccessUrl="https://booking."+("waf"==tt.N.environmentName?"passstage":"passepartout")+".cloud/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl="https://booking."+("waf"==tt.N.environmentName?"passstage":"passepartout")+".cloud/booking/pagamentoError?oidTransazione=",this.stripeCardNumberValid=!1,this.stripeExpirationValid=!1,this.stripeCvcValid=!1,this.immaginiTipiCarteCredito=new Map([[c.Cf.Visa,"/assets/images/booking/credit-card/visa.svg"],[c.Cf.AmericanExpress,"/assets/images/booking/credit-card/american-express.svg"],[c.Cf.MasterCard,"/assets/images/booking/credit-card/mastercard.svg"],[c.Cf.DiscoveryCard,"/assets/images/booking/credit-card/discover.svg"],[c.Cf.DinersClub,"/assets/images/booking/credit-card/diners.svg"],[c.Cf.JCB,"/assets/images/booking/credit-card/jcb.svg"],[c.Cf.EuroCard,""],[c.Cf.BankCard,""],[c.Cf.CarteBlanche,""],[c.Cf.CarteBleu,""],[c.Cf.UniversalAir,""],[c.Cf.Maestro,"/assets/images/booking/credit-card/maestro.svg"],[c.Cf.EnRoute,""],[c.Cf.AccessCard,""],[c.Cf.BankAmeriCard,""],[c.Cf.ChinaUnionPay,"/assets/images/booking/credit-card/unionpay.svg"],[c.Cf.Dankort,""],[c.Cf.DinersClub_USACanada,""],[c.Cf.InstaPayment,""],[c.Cf.Laser,""],[c.Cf.VisaElectron,""],[c.Cf.Sconosciuto,""]]),this.paymentSuccess=!1,this.descrizione="Prenotazione",this.elevation=!0,this.showCaparra=!0,this.fullWidthButton=!1,this.createOrder=new t.vpe,this.noPaymentMethod=new t.vpe,this.onPaymentError=new t.vpe,this.onCaparraChange=new t.vpe,this.satispayCompleted=!1,this.recaptchaAttiva=!1,this.recaptchaResolved=!0,this.isAccettaContrattoPrenotazioneStep2=!1,this.contrattoAccettatto=!0,this.axeptaPaymentResultReceived=!1,this.popupSuccess=!1,this.ADDONPAYMENTS_API_URL="https://hpp.addonpayments.com/pay",this.ADDONPAYMENTS_API_URL_TEST="https://hpp.sandbox.addonpayments.com/pay",this.ADDON_PAYMENTS_LIGHTBOX_URL="/assets/js/booking/rxp-hpp.js",this.SATISPAY_BUTTON_URL="https://online.satispay.com/web-button.js",this.SATISPAY_BUTTON_URL_TEST="https://staging.online.satispay.com/web-button.js",this.SUMUP_WIDGET_URL="https://gateway.sumup.com/gateway/ecom/card/v2/sdk.js",this.STRIPE_JS_URL="https://js.stripe.com/v3/",this.AXEPTA_JS_URL="https://pay.axepta.it/sdk/axepta-pg-sdk.js",this.AXEPTA_JS_URL_TEST="https://pay-sandbox.axepta.it/sdk/axepta-pg-sdk.js",this.HOLIPAY_WIDGET_URL="https://api.holipay.com/holipay.js?hotel_id=",this.SCALAPAY_WIDGET_URL="https://cdn.scalapay.com/widget/v3/js/scalapay-widget.js",this.SCALAPAY_ESM_WIDGET_URL="https://cdn.scalapay.com/widget/v3/js/scalapay-widget.esm.js"}ngOnInit(){window.addEventListener("message",o=>{"https://staging.online.satispay.com"!=o.origin&&"https://online.satispay.com"!=o.origin||null==o.data||"webButtonEvent"!=o.data.type?("axepta_SUCCESS_message"==o.data||"axepta_FAILURE_message"==o.data||"Axepta3dsClosed"==o.data)&&!this.axeptaPaymentResultReceived&&this.checkAxeptaMessage(o):"close"==o.data.action&&setTimeout(()=>{this.satispayCompleted?this.satispayCompleted=!1:this.satispayPaymentId&&this.cancelSatispayOrder(!1).then(()=>{},()=>{})},500)},!1),this.localStorageSub=this.localStorage.observe("popupCheckSuccess").subscribe(()=>{null!=this.window&&(this.popupSuccess=!0,this.openPaymentWindow(!0))}),this.testEnvironment&&this.isLocalhost&&("localhost"==this.testEnvironment?(this.pagamentoSuccessUrl=window.location.origin+"/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl=window.location.origin+"/booking/pagamentoError?oidTransazione="):"waf"==this.testEnvironment&&(this.pagamentoSuccessUrl="https://booking.passstage.cloud/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl="https://booking.passstage.cloud/booking/pagamentoError?oidTransazione="))}checkAxeptaMessage(o){this.axeptaPaymentResultReceived=!0,"axepta_SUCCESS_message"==o.data?setTimeout(()=>{this.dialog.close(),this.createOrder.emit(this.model)},2e3):"axepta_FAILURE_message"==o.data?setTimeout(()=>{this.dialog.close(),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit("")},2e3):"Axepta3dsClosed"==o.data&&(this.dialog.close(),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""))}initPaypalConfig(o){this.payPalConfig={clientId:o,currency:"EUR",style:{label:"pay",shape:"pill",color:"gold",layout:"horizontal",tagline:!1},createOrderOnServer:n=>this.createPaypalOrder(),authorizeOnServer:(n,h)=>this.capturePaypalOrder().then(l=>{this.createOrder.emit(this.model)},l=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l)}),onApprove:(n,h)=>{},onCancel:(n,h)=>{},onError:n=>{},onClick:(n,h)=>{!this.formValid&&this.errorMessage||!this.paymentFormValid?!this.formValid&&this.errorMessage?this.showError(this.errorMessage):this.recaptchaResolved?this.showError("globals.messages.inserireDati"):this.showError("interfaces.pagamento-form.risolvereReCaptcha"):this.getImportoPagamento()<=0&&this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento")},onInit:(n,h)=>{this.paypalButton=h}}}reset(){this.model.codiceRiferimentoOperazione=null,null!=this.carteCredito&&this.carteCredito.length>0&&(this.model.tipoCarta=this.carteCredito[0]),this.model.numeroCarta=null,this.model.codiceSicurezza=null,this.model.scadenzaCartaMese=null,this.model.scadenzaCartaAnno=null,this.model.titolareCarta=null,this.verifyValidity()}verifyValidity(){this.model.privacy&&this.recaptchaResolved&&this.contrattoAccettatto?this.model.modalitaPagamento.tipo==c.sc.CartaCredito?this.model.titolareCarta&&this.model.numeroCarta&&this.model.codiceSicurezza&&this.model.scadenzaCartaMese&&this.model.scadenzaCartaAnno&&null!=this.model.tipoCarta?this.paymentFormValid=!0:this.paymentFormValid=!1:this.model.modalitaPagamento.tipo==c.sc.Stripe?this.paymentFormValid=this.stripeCardNumberValid&&this.stripeExpirationValid&&this.stripeCvcValid:this.model.modalitaPagamento.tipo==c.sc.BonificoBancario?this.paymentFormValid=!this.isVisualizzaCRO||!!this.model.codiceRiferimentoOperazione:this.paymentFormValid=!0:this.paymentFormValid=!1,this.checkPaypalButtonEnabled()}openPrivacyDialog(){this.setIsLoading(!0);let o=new k.YZY;o.oidPortale=this.oidPortale,o.lingua=this.lingua,this.apiService.getPrivacyPortale(o).subscribe(n=>{this.setIsLoading(!1),this.openPrivacyNewsletterDialog(n.data)})}openNewsletterDialog(){this.openPrivacyNewsletterDialog(this.newsLetterPortale)}openPrivacyNewsletterDialog(o){o.html?this.openDialog(!0,null,o.html):o.url&&this.utilityService.openUrlInNewTab(o.url)}openCondizioniContrattoDialog(){this.openDialog(!0,null,this.condizioniContratto)}openCroDialog(){this.openDialog(!1,"interfaces.pagamento-form.croTitle","interfaces.pagamento-form.croText")}openDialog(o,n,h){let l=new k.Zpt;this.containerService.dimension.width>=992?l.width="50vw":l.width="80vw";let vt=this.showModalDialog(rt,l).componentInstance;vt.html=o,vt.title=n,vt.text=h}pay(){this.getImportoPagamento()>0?this.model.modalitaPagamento.tipo==c.sc.BancaSella?this.createTransaction().then(()=>{this.encryptGestPayOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.XPay?this.arrivo&&this.partenza?this.createTransaction().then(()=>{this.createXPayReservation().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction()})}):this.createTransaction().then(()=>{this.createXPayOrder().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction()})}):this.model.modalitaPagamento.tipo==c.sc.Satispay?this.createSatispayOrder().then(o=>{this.satispayPaymentId=o.transaction_id,SatispayWebButton.configure({paymentId:o.transaction_id,completed:()=>{this.satispayCompleted=!0,this.verifySatispayOrder().then(h=>{"KO"==h.payment_status?(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(h.payment_status),this.setIsLoading(!1)):"OK"==h.payment_status&&this.createOrder.emit(this.model)},h=>{this.cancelSatispayOrder().then(()=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(h)},l=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l)})})}}).open()},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)}):this.model.modalitaPagamento.tipo==c.sc.Stripe?(this.setIsLoading(!0),this.stripe.createPaymentMethod({type:"card",card:this.cardNumberElement}).then(o=>{null!=o.paymentMethod?this.model.modalitaPagamento.isUsePost?this.createTransaction().then(()=>{this.checkPayment(),this.stripePayment(o.paymentMethod.id)}):this.stripePayment(o.paymentMethod.id).then(n=>{null!=n.error?(n.error.message?this.showError(n.error.message):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(n.error),this.setIsLoading(!1)):null!=n.paymentIntent&&this.createOrder.emit(this.model)},()=>{}):null!=o.error&&(o.error.message?this.showError(o.error.message):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error.message),this.setIsLoading(!1))})):this.model.modalitaPagamento.tipo==c.sc.PayWay?this.createTransaction().then(()=>{this.createPayWayOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.Unicredit?this.createTransaction().then(()=>{this.createUnicreditOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.CartaCredito?this.isVerificaCartaCredito?this.verificaCartaCredito().then(()=>{this.createOrder.emit(this.model)},()=>{this.showError("interfaces.pagamento-form.cartaCreditoNonValida")}):this.createOrder.emit(this.model):this.model.modalitaPagamento.tipo==c.sc.AddonPayments?this.openLightBoxAddonPayments():this.model.modalitaPagamento.tipo==c.sc.BeSafePay?this.createTransaction().then(()=>{this.createBeSafePayOrder().then(o=>{this.openWindow(o.redirect_url)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.SumUp?this.createSumUpOrder().then(o=>{this.openIFrameSumUp()},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)}):this.model.modalitaPagamento.tipo==c.sc.Hobex?(this.setIsLoading(!0),this.apiService.payment(k.sK_.getHobexCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.hobexEntityId,this.model.modalitaPagamento.hobexAccessToken,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,"EUR",this.model.modalitaPagamento.tipoContabilizzazione==c.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.transaction_id?this.createTransaction(o.transaction_id).then(()=>{this.checkPayment(),this.openIFrameHobex(o.transaction_id)}):(this.setIsLoading(!1),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error))})):this.model.modalitaPagamento.tipo==c.sc.Axepta?(this.setIsLoading(!0),this.apiService.payment(k.sK_.getAxeptaCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.axeptaApiKey,this.model.modalitaPagamento.axeptaAccessToken,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN","EUR",this.model.modalitaPagamento.tipoContabilizzazione==c.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.transaction_id?(this.setIsLoading(!1),this.openAxeptaModal(o.transaction_id)):(this.setIsLoading(!1),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error))})):this.model.modalitaPagamento.tipo==c.sc.Holipay?this.createTransaction().then(()=>{this.apiService.payment(k.sK_.getHolipayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.holipayHotelId,this.model.modalitaPagamento.holipaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest)).subscribe(o=>{o.success&&o.redirect_url?this.openWindow(o.redirect_url):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error),this.deleteTransaction(),this.setIsLoading(!1))})}):this.model.modalitaPagamento.tipo==c.sc.Siapay?this.createTransaction().then(()=>{this.apiService.payment(k.sK_.getSiapayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.siapayShopId,this.model.modalitaPagamento.siapaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"ITA":"EN",this.model.modalitaPagamento.tipoContabilizzazione==c.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.redirect_url?this.openWindow(o.redirect_url):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error),this.deleteTransaction(),this.setIsLoading(!1))})}):this.model.modalitaPagamento.tipo==c.sc.ScalaPay?this.createTransaction().then(()=>{this.createScalaPayOrder().then(o=>{this.setTransactionId(this.model.modalitaPagamento.scalaPayApiKey+" "+o.token).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.VirtualPay?this.createTransaction().then(()=>{this.createVirtualPayOrder().then(o=>{this.openWindow(o.redirect_url)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==c.sc.MyPOS?this.createTransaction().then(()=>{this.createMyPOSOrder().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo!=c.sc.PayPal&&this.createOrder.emit(this.model):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento")}stripePayment(o){return new Promise((n,h)=>{this.apiService.payment(k.sK_.getStripeCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.stripeSecretKey,this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,this.descrizione,"EUR",this.model.modalitaPagamento.tipoContabilizzazione==c.XI.Differita)).subscribe(l=>{l.success&&l.transaction_id&&l.client_secret?this.stripe.confirmCardPayment(l.client_secret,{payment_method:o}).then(u=>{n(u)}):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l.error),this.deleteTransaction(),this.setIsLoading(!1),h())})})}openLightBoxAddonPayments(){this.getConfigAddonPayments().then(o=>{RealexHpp.setHppUrl(this.model.modalitaPagamento.isTest?this.ADDONPAYMENTS_API_URL_TEST:this.ADDONPAYMENTS_API_URL),RealexHpp.lightbox.init("autoload",this.addonPaymentsCallback.bind(this),o.config)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)})}addonPaymentsCallback(o,n){null!=o&&o.MERCHANT_ID&&o.ORDER_ID&&"00"==o.RESULT?this.createOrder.emit(this.model):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.MESSAGE)),n()}onPopupCheckFail(){this.localStorage.set("popupCheckFailed",!0),this.setIsLoading(!1);let o=new k.Zpt,n=this.showModalDialog(M,o),h=n.componentInstance;h.paymentUrl=this.windowUrl,h.dialogRef=n,n.afterClosed().subscribe(l=>{null!=l?(this.setIsLoading(!0),this.window=l,this.openPaymentWindow(!1)):this.deleteTransaction()})}openWindow(o,n){this.setIsLoading(!0),o?this.windowUrl=o:n&&(this.localStorage.set("paymentForm",n),this.windowUrl=window.location.origin+"/booking/paymentForm"),this.popupSuccess=!1,this.localStorage.set("popupCheckFailed",!1),this.window=window.open(window.location.origin+"/booking/popupCheck","_blank"),null==this.window?this.onPopupCheckFail():setTimeout(()=>{this.popupSuccess||this.onPopupCheckFail()},5e3)}openPaymentWindow(o){o&&(this.window.location.href=this.windowUrl),this.window.focus();let n=setInterval(()=>{null!=this.window?this.window.closed&&(clearInterval(this.interval),clearInterval(n),this.paymentSuccess?this.createOrder.emit(this.model):(this.deleteTransaction(),this.setIsLoading(!1)),this.window=null):clearInterval(n)},1e3);this.checkPayment()}openIFrameSumUp(){let o=new k.Zpt;this.containerService.dimension.width>=992?o.width="80vw":o.width="100vw",o.disableClose=!0,o.panelClass="no-padding-overflow-dialog",o.maxHeight="100vh";let n=this.showModalDialog(rt,o),h=n.componentInstance;h.sumupTransactionId=this.sumupTransactionId,h.lingua=this.lingua,h.dialogRef=n,n.afterClosed().subscribe(l=>{l?this.verifySumUpOrder().then(u=>{"KO"==u.payment_status?(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""),this.setIsLoading(!1)):"OK"==u.payment_status&&this.createOrder.emit(this.model)},u=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(u),this.setIsLoading(!1)}):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""),this.setIsLoading(!1))})}openIFrameHobex(o){let n=new k.Zpt;n.disableClose=!0,n.panelClass="no-padding-overflow-dialog",n.minHeight="0vh",this.dialog=this.showModalDialog(rt,n);let h=this.dialog.componentInstance;h.hobexTransactionId=o,h.paymentSuccessUrl=this.getSuccessUrl(),h.isTest=this.model.modalitaPagamento.isTest,h.lingua=this.lingua,h.dialogRef=this.dialog,this.dialog.afterClosed().subscribe(l=>{this.dialog=null,l?(clearInterval(this.interval),this.createOrder.emit(this.model)):(this.deleteTransaction(),this.setIsLoading(!1))})}openAxeptaModal(o){let n=new k.Zpt;n.disableClose=!0,n.panelClass="no-padding-overflow-dialog",n.minHeight="0vh",this.dialog=this.showModalDialog(rt,n);let h=this.dialog.componentInstance;h.axeptaTransactionId=o,h.axeptaApiKeySmartCheckout=this.model.modalitaPagamento.axeptaApiKeySmartCheckout,h.isTest=this.model.modalitaPagamento.isTest,this.axeptaPaymentResultReceived=!1,this.dialog.afterClosed().subscribe(()=>this.dialog=null)}createPaypalOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getPaypalCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.paypalClientId,this.model.modalitaPagamento.paypalSecretKey,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,this.descrizione,"it"==this.lingua?"it-IT":"en-US");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?(this.paypalTransactionId=u.transaction_id,this.paypalToken=u.token,n(u.transaction_id)):h(u.error),this.setIsLoading(!1)})})}capturePaypalOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getPaypalCaptureRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.paypalClientId,this.model.modalitaPagamento.paypalSecretKey,this.paypalTransactionId,this.paypalToken,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}encryptGestPayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getGestpayEncryptRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.gestpayShopId,this.model.modalitaPagamento.gestpayApiKey,this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}createXPayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getXPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.xPayAlias,this.model.modalitaPagamento.xPaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}createXPayReservation(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getXPayCreateReservationRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.xPayAlias,this.model.modalitaPagamento.xPaySecretKey,this.utilityService.getEnumKeyOriginal(c.$w,this.model.modalitaPagamento.xPayTipoPrenotazione),this.model.modalitaPagamento.xPayCodiceStruttura,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}getConfigAddonPayments(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getAddonPaymentsConfigurationRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.addonPaymentsMerchantId,this.model.modalitaPagamento.addonPaymentsSecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}createSatispayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getSatispayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.getImportoPagamento(),this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}verifySatispayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getSatispayVerifyRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.satispayPaymentId,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error)})})}cancelSatispayOrder(o=!0){return new Promise((h,l)=>{o&&this.setIsLoading(!0);let u=k.sK_.getSatispayCancelRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.satispayPaymentId,this.model.modalitaPagamento.isTest);this.apiService.payment(u).subscribe(vt=>{vt.success?h(vt):l(vt.error),o&&this.setIsLoading(!1)})})}createPayWayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getPayWayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.payWayTerminalId,this.model.modalitaPagamento.payWaySecretKey,this.getSuccessUrl(),this.getErrorUrl(),this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?n(u):h(u.error)})})}createUnicreditOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getUnicreditCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.unicreditTerminalId,this.model.modalitaPagamento.unicreditSecretKey,this.getSuccessUrl(),this.getErrorUrl(),this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?n(u):h(u.error)})})}createBeSafePayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getBeSafePayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.beSafePayApiKey,this.getImportoPagamento(),this.descrizione,this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione);this.apiService.payment(l).subscribe(u=>{u.success&&u.redirect_url?n(u):h(u.error)})})}createSumUpOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getSumUpCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.sumUpMerchantId,this.model.modalitaPagamento.sumUpClientId,this.model.modalitaPagamento.sumUpSecretKey,this.getImportoPagamento(),this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?(this.sumupTransactionId=u.transaction_id,this.sumupToken=u.token,n(u.transaction_id)):h(u.error),this.setIsLoading(!1)})})}verifySumUpOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getSumUpVerifyRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.sumupToken,this.sumupTransactionId,this.model.modalitaPagamento.sumUpClientId,this.model.modalitaPagamento.sumUpSecretKey,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):h(u.error),this.setIsLoading(!1)})})}createScalaPayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getScalaPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.scalaPayApiKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.token&&u.redirect_url?n(u):h(u.error)})})}createVirtualPayOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getVirtualPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.virtualPayMerchantId,this.model.modalitaPagamento.virtualPayABI,this.model.modalitaPagamento.virtualPaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione);this.apiService.payment(l).subscribe(u=>{u.success&&u.redirect_url?n(u):h(u.error)})})}createMyPOSOrder(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=k.sK_.getMyPOSCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.myPOSWalletNumber,this.model.modalitaPagamento.myPOSSID,this.model.modalitaPagamento.myPOSKeyIndex,this.getImportoPagamento(),this.lingua,this.descrizione,this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.form?n(u):h(u.error)})})}verificaCartaCredito(){return new Promise((n,h)=>{this.setIsLoading(!0);let l=new k.vMP;l.oidAlbergo=this.oidAlbergo,l.oidPortaleXAlbergo=this.oidPortale,l.intestatarioCC=this.model.titolareCarta,l.numeroCC=this.model.numeroCarta,l.tipoCartaCC=null!=this.model.tipoCarta?this.model.tipoCarta.nome:"",l.annoCC=this.model.scadenzaCartaAnno,l.meseCC=this.model.scadenzaCartaMese,l.codiceSicurezzaCC=this.model.codiceSicurezza,this.apiService.verificaCartaCredito(l).subscribe(u=>{null!=u.data&&null!=u.data.tipoEsito&&0==u.data.tipoEsito?n():h(),this.setIsLoading(!1)})})}onModalitaPagamentoChange(){this.calculateCaparra(),this.reset()}calculateCaparra(){if(null!=this.model.modalitaPagamento)if(this.showCaparra){if(this.caparra>0)this.isCaparraPercentuale?this.model.modalitaPagamento.caparraTotale=this.totale*this.caparra/100:this.model.modalitaPagamento.caparraTotale=this.caparra;else if(this.model.modalitaPagamento.numeroNottiCaparra>0&&null!=this.camere){let n=Math.min(this.model.modalitaPagamento.numeroNottiCaparra,2);this.model.modalitaPagamento.caparraTotale=0;for(let h of this.camere){var o;let l=null===(o=h.tariffa)||void 0===o?void 0:o.giorni;if(null!=l&&l.length>0)for(let u=0;u<Math.min(n,l.length);u++){let vt=null!=l[u].prezzoScontato&&l[u].prezzoScontato>0?l[u].prezzoScontato:l[u].prezzo;this.model.modalitaPagamento.caparraTotale+=vt}}}else this.model.modalitaPagamento.caparra>0?this.model.modalitaPagamento.isCaparraPercentuale?this.model.modalitaPagamento.caparraTotale=Math.max(this.totale*this.model.modalitaPagamento.caparra/100,this.model.modalitaPagamento.importoMinimoCaparra):this.model.modalitaPagamento.isCaparraPerCamera&&null!=this.camere?this.model.modalitaPagamento.caparraTotale=this.model.modalitaPagamento.caparra*this.camere.length:this.model.modalitaPagamento.caparraTotale=this.model.modalitaPagamento.caparra:this.model.modalitaPagamento.caparraTotale=0;this.model.modalitaPagamento.caparraTotale=Math.min(this.model.modalitaPagamento.caparraTotale,this.totale)}else this.model.modalitaPagamento.caparraTotale=0;this.checkPaypalButtonEnabled(),this.onCaparraChange.emit(this.model.modalitaPagamento.caparraTotale),this.refreshHolipayWidget()}splitDataScadenza(){if(this.dataScadenza){let o=this.dataScadenza.split("/");if(2==o.length)try{this.model.scadenzaCartaMese=parseInt(o[0],10),this.model.scadenzaCartaAnno=parseInt(o[1],10),isNaN(this.model.scadenzaCartaMese)&&(this.model.scadenzaCartaMese=null),isNaN(this.model.scadenzaCartaAnno)&&(this.model.scadenzaCartaAnno=null)}catch(n){}}}createTransaction(o){return new Promise(n=>{this.setIsLoading(!0);let h=new f.LHu;h.data=this.getDate(D(),"YYYY-MM-DD HH:mm:ss"),h.statoEsecuzione=c.g_.NonEseguito,h.albergo=new f.Z$(this.oidAlbergo),h.importo=this.getImportoPagamento(),h.idTransazione=o,this.apiService.updateTransazione(h).subscribe(l=>{this.model.oidTransazione=l.data.obj.oid,n()})})}setTransactionId(o){return new Promise(n=>{if(this.model.oidTransazione>0){let h=new f.LHu(this.model.oidTransazione);h.idTransazione=o,this.apiService.updateTransazione(h).subscribe(()=>{n()})}else n()})}deleteTransaction(){this.model.oidTransazione>0&&(this.model.oidTransazione=null)}checkPayment(){this.paymentSuccess=!1,this.model.isPrenotazioneCreata=!1,this.interval=setInterval(()=>{this.model.oidTransazione>0?this.apiService.getTransazione(this.model.oidTransazione,!1).subscribe(o=>{if(null!=o.data)if(o.data.statoEsecuzione==c.g_.Eseguito){var n;this.model.isPrenotazioneCreata=o.data.isPrenotazioneCreata,this.model.codicePrenotazione=null===(n=o.data.prenotazione)||void 0===n?void 0:n.codiceOTA,null!=this.window?(this.paymentSuccess=!0,this.window.close()):null!=this.dialog?this.dialog.close(!0):(clearInterval(this.interval),this.createOrder.emit(this.model))}else o.data.statoEsecuzione==c.g_.Errore?(null!=this.window?(this.paymentSuccess=!1,this.window.close()):null!=this.dialog?this.dialog.close():(this.deleteTransaction(),this.setIsLoading(!1)),this.showError(o.data.descrizioneEsito?o.data.descrizioneEsito:"interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.data.descrizioneEsito)):o.data.statoEsecuzione==c.g_.Annullato&&(null!=this.window?(this.paymentSuccess=!1,this.window.close()):null!=this.dialog?this.dialog.close():(this.deleteTransaction(),this.setIsLoading(!1)))}):clearInterval(this.interval)},5e3)}getSuccessUrl(){return this.pagamentoSuccessUrl+this.model.oidTransazione+"&oidModalitaPagamento="+this.model.modalitaPagamento.paymentId+"&oidPortale="+this.oidPortale}getErrorUrl(){return this.pagamentoErrorUrl+this.model.oidTransazione+"&oidModalitaPagamento="+this.model.modalitaPagamento.paymentId+"&oidPortale="+this.oidPortale}getImportoPagamento(){return this.model.modalitaPagamento.caparraTotale>0?this.model.modalitaPagamento.caparraTotale:this.totale}checkPaypalButtonEnabled(){null!=this.paypalButton&&(this.formValid&&this.paymentFormValid&&this.getImportoPagamento()>0?this.paypalButton.enable():this.paypalButton.disable())}refreshHolipayWidget(){this.model.modalitaPagamento.tipo==c.sc.Holipay&&setTimeout(()=>{holipay.updateWidgets()},200)}ngOnDestroy(){this.localStorageSub.unsubscribe()}}Ct.\u0275fac=function(o){return new(o||Ct)(t.Y36(S.s),t.Y36(B.J),t.Y36(R.t),t.Y36(it.n))},Ct.\u0275cmp=t.Xpm({type:Ct,selectors:[["app-pagamento-form"]],hostBindings:function(o,n){1&o&&t.NdJ("beforeunload",function(l){return n.beforeUnloadHandler(l)},!1,t.Jf7)},inputs:{_totale:"_totale",_isAccettaContrattoPrenotazioneStep2:"_isAccettaContrattoPrenotazioneStep2",isVerificaCartaCredito:"isVerificaCartaCredito",isVisualizzaCRO:"isVisualizzaCRO",condizioniContratto:"condizioniContratto",descrizione:"descrizione",disabled:"disabled",elevation:"elevation",_recaptchaAttiva:"_recaptchaAttiva",linguaPortaleAlbergo:"linguaPortaleAlbergo",_modalitaPagamento:"_modalitaPagamento",cliente:"cliente",errorMessage:"errorMessage",_formValid:"_formValid",arrivo:"arrivo",partenza:"partenza",_camere:"_camere",extras:"extras",allModalitaPagamento:"allModalitaPagamento",showCaparra:"showCaparra",_caparra:"_caparra",_isCaparraPercentuale:"_isCaparraPercentuale",fullWidthButton:"fullWidthButton",note:"note",oidCodicePromozione:"oidCodicePromozione",oidMotivoViaggio:"oidMotivoViaggio",valuta:"valuta",bookingSolutionUid:"bookingSolutionUid",privacy:"privacy",newsletter:"newsletter"},outputs:{createOrder:"createOrder",noPaymentMethod:"noPaymentMethod",onPaymentError:"onPaymentError",onCaparraChange:"onCaparraChange"},features:[t.qOj],decls:35,vars:34,consts:[[3,"hidden"],[1,"pagamento-container","border","p-3",3,"ngClass"],[1,"w-100","text-center",3,"ngClass"],[1,"color-light-blue","mr-4","align-middle","font-weight-bold"],[1,"align-middle","pagamento-form-modalita-select"],["required","",1,"pagamento-form-select",3,"panelClass","ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"pt-2","pb-4",3,"hidden"],[1,"stripe-label"],["id","card-number-element",1,"border","rounded","mt-1","p-1"],[1,"row","mt-2"],[1,"col-6"],["id","card-expiry-element",1,"border","rounded","mt-1","p-1"],["id","card-cvc-element",1,"border","rounded","mt-1","p-1"],["class","mt-4 d-table mx-auto",4,"ngIf"],["class","w-100 text-center mt-4",4,"ngIf"],[1,"text-center",3,"hidden"],[3,"config"],[3,"value"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[3,"_text"],[1,"d-inline-block","align-middle","mr-1"],[1,"font-weight-bold","d-inline-block","align-middle"],["type","checkout"],[1,"row"],[3,"ngClass"],[1,"col-12","col-sm-6"],[1,"w-100"],["required","",1,"pagamento-form-select",3,"panelClass","ngModel","placeholder","disabled","ngModelChange"],["autocompleteOff","","matInput","","required","",3,"ngModel","placeholder","readOnly","disabled","ngModelChange"],["cardNumberInput",""],["securityCodeInput",""],["expirationDateInput",""],["nameInput",""],["class","col-4 d-none d-md-block",4,"ngIf"],["class","mt-3 mb-3",4,"ngIf"],[1,"mt-3","mb-3"],["class","carta-credito-image mr-1 ml-1",3,"src",4,"ngFor","ngForOf"],[1,"carta-credito-image","mr-1","ml-1",3,"src"],[1,"col-4","d-none","d-md-block"],[1,"border","rounded-lg","p-3"],[1,"mt-3"],["src","/assets/images/booking/norton.svg",1,"norton-image"],["src","/assets/images/booking/pci.svg",1,"pci-image","float-right"],[1,"mb-4","mt-3"],[3,"nameInput","cardNumberInput","expirationDateInput","securityCodeInput"],[1,"row",3,"ngClass"],["class","col-12 col-sm-6",4,"ngIf"],["class","row",4,"ngIf"],[1,"align-middle","font-weight-bold"],[1,"align-middle"],[1,"col-12","col-sm-8"],["autocompleteOff","","matInput","",3,"ngModel","placeholder","readOnly","disabled","ngModelChange"],["class","col-4 d-none d-sm-block",4,"ngIf"],[1,"col-4","d-none","d-sm-block"],["href","#",1,"d-inline-block","mt-3",3,"click"],["required","",1,"pagamento-form-checkbox",3,"ngModel","disabled","change","ngModelChange"],["href","#",1,"checkbox","privacyLink",3,"click"],["class","pagamento-form-checkbox","required","",3,"ngModel","disabled","change","ngModelChange",4,"ngIf"],["class","checkbox",4,"ngIf"],["class","checkbox condizioniContrattoLink","href","#",3,"click",4,"ngIf"],[1,"checkbox"],["href","#",1,"checkbox","condizioniContrattoLink",3,"click"],[1,"pagamento-form-checkbox",3,"ngModel","disabled","change","ngModelChange"],["class","checkbox newsletterLink","href","#",3,"click",4,"ngIf"],["href","#",1,"checkbox","newsletterLink",3,"click"],[1,"mt-4","d-table","mx-auto"],[3,"siteKey","resolved"],[1,"w-100","text-center","mt-4"],["mat-flat-button","","class","button-blue paga-button",3,"ngClass","disabled","click",4,"ngIf"],["mat-flat-button","",1,"button-blue","paga-button",3,"ngClass","disabled","click"],[1,"material-icons","align-middle","mr-1","icon-small"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"mat-form-field",4)(7,"mat-select",5),t.NdJ("ngModelChange",function(l){return n.model.modalitaPagamento=l})("ngModelChange",function(){return n.onModalitaPagamentoChange()}),t.YNc(8,nt,2,2,"mat-option",6),t.qZA()()(),t.YNc(9,kt,5,4,"ng-container",7),t.YNc(10,e,31,37,"div",7),t.YNc(11,y,7,8,"div",7),t.TgZ(12,"div",8)(13,"div",9),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"div",10),t.TgZ(17,"div",11)(18,"div",12)(19,"div",9),t._uU(20),t.ALo(21,"translate"),t.qZA(),t._UZ(22,"div",13),t.qZA(),t.TgZ(23,"div",12)(24,"div",9),t._uU(25),t.ALo(26,"translate"),t.qZA(),t._UZ(27,"div",14),t.qZA()()(),t.YNc(28,F,5,5,"div",7),t.YNc(29,Zt,2,1,"div",7),t.YNc(30,xt,4,4,"div",7),t.qZA(),t.YNc(31,Lt,2,1,"div",15),t.YNc(32,Bt,2,1,"div",16),t.TgZ(33,"div",17),t._UZ(34,"ngx-paypal",18),t.qZA()()),2&o&&(t.Q6J("hidden",n.model.modalitaPagamento.paymentId<=0),t.xp6(1),t.Q6J("ngClass",t.VKq(30,_t,n.elevation)),t.xp6(1),t.Q6J("ngClass",t.VKq(32,x,!n.disabled||n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.CartaCredito||n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.BonificoBancario)),t.xp6(2),t.hij(" ",t.lcZ(5,22,"interfaces.pagamento-form.metodoPagamento")," "),t.xp6(3),t.Q6J("panelClass","booking-select")("ngModel",n.model.modalitaPagamento)("disabled",n.disabled),t.xp6(1),t.Q6J("ngForOf",n.modalitaPagamento),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.CartaCredito&&!n.disabled),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.CartaCredito),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.BonificoBancario),t.xp6(1),t.Q6J("hidden",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.Stripe||n.disabled),t.xp6(2),t.hij(" ",t.lcZ(15,24,"interfaces.pagamento-form.numero")," "),t.xp6(6),t.hij(" ",t.lcZ(21,26,"interfaces.pagamento-form.scadenza")," "),t.xp6(5),t.hij(" ",t.lcZ(26,28,"interfaces.pagamento-form.codiceSicurezza")," "),t.xp6(3),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",n.recaptchaAttiva&&!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("hidden",n.disabled||n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.PayPal),t.xp6(1),t.Q6J("config",n.payPalConfig))},dependencies:[Pt.X,w.mk,w.sg,w.O5,L.Fj,L.JJ,L.Q7,L.On,V.FC,gt.e_,ut.eB,X.v_,J.k0,bt.CK,O.x8,at.nu,lt.wT,b.W,N.G,ht.f,A.A,w.JJ,v.X$],styles:[".checkbox[_ngcontent-%COMP%]{white-space:normal!important}  .buttons-container{display:none!important}  .pagamento-form-select.mat-select-disabled .mat-select-value{color:#000000de!important}.pagamento-container[_ngcontent-%COMP%]{border-radius:5px;background-color:#fff}  .pagamento-form-checkbox .mat-checkbox-inner-container{margin-top:5px!important;margin-right:15px!important}  .pagamento-form-modalita-select .mat-form-field-infix{border-top:0!important}  .pagamento-form-modalita-select .mat-form-field-flex{border:1px solid #dddddd!important;border-radius:7px!important;padding-left:.25rem!important;padding-right:.25rem!important}  .pagamento-form-modalita-select .mat-form-field-underline{visibility:hidden!important}  .pagamento-form-modalita-select .mat-form-field-wrapper{padding-bottom:0!important}.paga-button[_ngcontent-%COMP%]{min-width:200px;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.privacyLink[_ngcontent-%COMP%], .privacyLink[_ngcontent-%COMP%]:hover, .newsletterLink[_ngcontent-%COMP%], .newsletterLink[_ngcontent-%COMP%]:hover, .condizioniContrattoLink[_ngcontent-%COMP%], .condizioniContrattoLink[_ngcontent-%COMP%]:hover{color:#004987!important}.info-icon[_ngcontent-%COMP%]{top:7px;right:0;font-size:18px;line-height:18px;color:#004987}.icon-small[_ngcontent-%COMP%]{font-size:20px}.norton-image[_ngcontent-%COMP%]{width:60px}.pci-image[_ngcontent-%COMP%]{width:40px}.carta-credito-image[_ngcontent-%COMP%]{width:60px}.addonPaymentsButton[_ngcontent-%COMP%]{visibility:hidden!important;width:0!important;height:0!important}.stripe-label[_ngcontent-%COMP%]{font-size:13px}"]})},25742:(At,$,_)=>{_.d($,{A:()=>D});var t=_(65879);class D{transform(f,k,c){return f.replace(new RegExp(k,"g"),c)}}D.\u0275fac=function(f){return new(f||D)},D.\u0275pipe=t.Yjl({name:"replace",type:D,pure:!0})},34186:(At,$)=>{var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],D=["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","tfoot","thead","tr","ul","video"],U=["audio","math","svg","video"],f=10,k=33,c=34,tt=38,R=39,w=47,L=59,b=60,v=61,Q=62,et=/[<&\n\ud800-\udbff]/,ct=/[<&\ud800-\udbff]/,K=/\s+/g;function I(p,M){for(var S=p.length,B=M;B<S;B++)if(T(p.charCodeAt(B)))return B;return S}function z(p){return p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122}function Y(p,M){var S=p.charCodeAt(M);if(S===f)return!0;if(S===b){var B="("+D.join("|")+"|br)";return new RegExp("^<"+B+"[\t\n\f\r ]*/?>","i").test(p.slice(M))}return!1}function T(p){return 9===p||10===p||12===p||13===p||32===p}function st(p){for(var M=p.length-1;M>=0;M--){var S=p[M];if("li"===S||"td"===S)return!1;if("ol"===S||"table"===S||"ul"===S)return!0}return!1}function G(p){return p.trim().replace(K," ")}function rt(p,M){var S=p.charCodeAt(M);if(55296==(64512&S)){var B=p.charCodeAt(M+1);if(56320==(64512&B))return String.fromCharCode(S,B)}return String.fromCharCode(S)}$.Z=function Z(p,M,S){return void 0===S&&(S={}),p?(p=p.toString(),S.html?function P(p,M,S){for(var B=S.imageWeight,it=void 0===B?2:B,Pt=S.indicator,V=void 0===Pt?"\u2026":Pt,gt=S.maxLines,X=void 0===gt?1/0:gt,J=S.stripTags,bt=void 0!==J&&J,O=V.length,at=1,lt="boolean"==typeof bt?function(){return bt}:function(_t){return bt.includes(_t)},N=[],ht=function(_t){for(var Ct;void 0!==(Ct=N.pop());)lt(Ct)||(_t+="</"+Ct+">");return _t},A=0,nt=-1,j=p.length;A<j;A++){var mt=A?p.slice(A):p,Tt=st(N),Ft=nt>-1||Tt?ct:et,kt=mt.search(Ft),W=kt>-1?kt:mt.length;if(-1===nt)if(Tt){var pt=G(W===mt.length?mt:mt.slice(0,kt));if(lt(N[N.length-1])){var It=A>0&&!T(p.charCodeAt(A-1)),St=!T(p.charCodeAt(A+W));pt.length>0?pt=(It?" ":"")+pt+(St?" ":""):It&&St&&(pt=" "),p=p.slice(0,A)+pt+p.slice(A+W),W=pt.length}if((O+=pt.length)>M)break}else if((O+=W)>M){A=Math.max(A+W-O+M,0);break}if(A+=W,-1===kt)break;if((ot=p.charCodeAt(A))===b){var ft=(yt=p.charCodeAt(A+1))===k;if(ft&&"--"===p.substr(A+2,2))A=p.indexOf("--\x3e",A+4)+3-1;else if(ft&&"[CDATA["===p.substr(A+2,7)){A=p.indexOf("]]>",A+9)+3-1}else{var i=yt===w;if(O===M&&!i){O++;break}for(var a=0,s=A,d=!1;;){if(++s>=j)throw new Error("Invalid HTML: "+p);var m=p.charCodeAt(s);if(d)a?m===a&&(d=!1):T(m)?d=!1:m===Q&&(d=!1,s--);else if(m===v){for(;T(p.charCodeAt(s+1));)s++;d=!0;var C=p.charCodeAt(s+1);C===c||C===R?(a=C,s++):a=0}else if(m===Q){var x=A+(i?2:1),y=Math.min(I(p,x),s);(F=p.slice(x,y).toLowerCase()).charCodeAt(F.length-1)===w&&(F=F.slice(0,F.length-1));var H=lt(F);if(i){if(N.pop()!==F)throw new Error("Invalid HTML: "+p);if(U.includes(F)&&!U.some(function(_t){return N.includes(_t)}))if(H)A=nt,nt=-1;else if(nt=-1,(O+=it)>M)break;if(D.includes(F)&&-1===nt&&!H&&++at>X){N.push(F);break}}else if(t.includes(F)||p.charCodeAt(s-1)===w){if(!H)if("br"===F){if(++at>X)break}else if("img"===F&&(O+=it)>M)break}else U.some(function(_t){return N.includes(_t)})||U.includes(F)&&(nt=A),N.push(F);H&&-1===nt?(p=p.slice(0,A)+p.slice(s+1),A--):A=s;break}}if(O>M||at>X)break}}else if(ot===tt){s=A+1;for(var Zt=!0;;){var Rt=p.charCodeAt(s);if(!z(Rt)){if(Rt===L)break;Zt=!1;break}s++}if(-1===nt&&++O>M)break;Zt&&(A=s)}else if(ot===f){if(++O>M||++at>X)break}else{if(-1===nt&&++O>M)break;var yt;if(55296==(64512&ot))56320==(64512&(yt=p.charCodeAt(A+1)))&&A++}}if(O>M){var Mt=function ut(p,M){var S=rt(p,M);if("&"===S)for(;;){M++;var B=p.charCodeAt(M);if(!z(B)){if(B===L){S+=String.fromCharCode(B);break}break}S+=String.fromCharCode(B)}return S}(p,A);if(V){for(var xt=A+Mt.length;p.charCodeAt(xt)===b&&p.charCodeAt(xt+1)===w;){var Lt=p.indexOf(">",xt+2)+1;if(!Lt)break;xt=Lt}xt&&(xt===p.length||Y(p,xt))&&(A+=Mt.length,Mt=p.charAt(A))}for(;"<"===Mt&&p.charCodeAt(A+1)===w;){var F;if(!(F=N.pop()))break;var Ot=p.indexOf(">",A+2);if(-1===Ot||p.slice(A+2,Ot).trim()!==F)throw new Error("Invalid HTML: "+p);lt(F)?p=p.slice(0,A)+p.slice(Ot+1):A=Ot+1,Mt=p.charAt(A)}if(A<p.length){if(!S.breakWords)for(var wt=A-V.length;wt>=0;wt--){var ot;if((ot=p.charCodeAt(wt))===Q||ot===L)break;if(ot===f||ot===b){A=wt;break}if(T(ot)){A=wt+(V?1:0);break}}var Bt=p.slice(0,A);return Y(p,A)||(Bt+=V),ht(Bt)}}else if(at>X)return ht(p.slice(0,A));return p}(p,M,S):function E(p,M,S){for(var B=S.indicator,it=void 0===B?"\u2026":B,Pt=S.maxLines,V=void 0===Pt?1/0:Pt,gt=it.length,X=1,J=0,bt=p.length;J<bt&&!(++gt>M);J++){if((O=p.charCodeAt(J))===f){if(++X>V)break}else if(55296==(64512&O)){56320==(64512&p.charCodeAt(J+1))&&J++}}if(gt>M){var lt=rt(p,J);if(it){var N=J+lt.length;if(N===p.length)return p;if(p.charCodeAt(N)===f)return p.slice(0,J+lt.length)}if(!S.breakWords)for(var ht=J-it.length;ht>=0;ht--){var O;if((O=p.charCodeAt(ht))===f){J=ht,lt="\n";break}if(T(O)){J=ht+(it?1:0);break}}return p.slice(0,J)+("\n"===lt?"":it)}if(X>V)return p.slice(0,J);return p}(p,M,S)):""}}}]);