"use strict";(self.webpackChunkwelcome_sbm=self.webpackChunkwelcome_sbm||[]).push([[616],{9735:(Ct,$,v)=>{v.d($,{h:()=>M});var t=v(5879),O=v(6485),N=v(724),f=v(6814),p=v(6223),_=v(4187),W=v(2400);const F=function(P){return{border:P}};class M{constructor(){this.valueChange=new t.vpe,this.colorChanged=new t.vpe}ngAfterViewInit(){this.colorPickerDirective&&(this.colorPickerDirective.cpPosition="bottom",this.colorPickerDirective.cpUseRootViewContainer=!0,this.options&&(this.options.width&&(this.colorPickerDirective.cpWidth=this.options.width),this.options.height&&(this.colorPickerDirective.cpHeight=this.options.height),this.options.dialogDisplay&&(this.colorPickerDirective.cpDialogDisplay=this.options.dialogDisplay),this.options.position&&(this.colorPickerDirective.cpPosition=this.options.position),this.options.positionOffset&&(this.colorPickerDirective.cpPositionOffset=this.options.positionOffset),this.options.positionRelativeToArrow&&(this.colorPickerDirective.cpPositionRelativeToArrow=this.options.positionRelativeToArrow),null!=this.options.useRootViewContainer&&(this.colorPickerDirective.cpUseRootViewContainer=this.options.useRootViewContainer)))}}M.\u0275fac=function(L){return new(L||M)},M.\u0275cmp=t.Xpm({type:M,selectors:[["app-color-picker"]],viewQuery:function(L,R){if(1&L&&t.Gf(O.Kk,5),2&L){let B;t.iGM(B=t.CRH())&&(R.colorPickerDirective=B.first)}},inputs:{options:"options",value:"value",placeholder:"placeholder"},outputs:{valueChange:"valueChange",colorChanged:"colorChanged"},decls:2,vars:8,consts:[[1,"w-100"],["autocompleteOff","","matInput","","readonly","",3,"colorPicker","ngModel","ngClass","placeholder","colorPickerChange","cpSliderDragEnd","ngModelChange"]],template:function(L,R){1&L&&(t.TgZ(0,"mat-form-field",0)(1,"input",1),t.NdJ("colorPickerChange",function(j){return R.value=j})("colorPickerChange",function(){return R.valueChange.emit(R.value)})("cpSliderDragEnd",function(){return R.colorChanged.emit()})("ngModelChange",function(j){return R.value=j}),t.qZA()()),2&L&&(t.xp6(1),t.Udp("background",R.value),t.Q6J("colorPicker",R.value)("ngModel",R.value)("ngClass",t.VKq(6,F,!!R.value))("placeholder",R.placeholder))},dependencies:[N.X,f.mk,p.Fj,p.JJ,p.On,_.v_,W.k0,O.Kk],styles:["input[_ngcontent-%COMP%]{box-sizing:border-box!important;border-radius:10px!important;color:transparent!important;-webkit-user-select:none!important;user-select:none!important;cursor:pointer!important}input[_ngcontent-%COMP%]::selection{background:transparent!important}input[_ngcontent-%COMP%]::-moz-selection{background:transparent!important}"]})},2836:(Ct,$,v)=>{v.d($,{P:()=>_});var t=v(5879),O=v(4090),N=v(2353),f=v(6223),p=v(420);class _ extends O.H{set text(F){if(this._text=F,this._text){let M=this.utility.extractTagsFromHtml(this._text,["style","link"]);M.length>0&&(this._text=this.utility.removeTagsFromHtml(this._text,["style","link"]),setTimeout(()=>{this.textChange.emit(this._text),this.onHeadRemove.emit(M.join())},200))}}getEditorConfig(){let F=this.height;return this.showToolbar&&!this.disabled&&!this.editorFocused&&(F+=42),{editable:!this.disabled,spellcheck:!0,height:F+"px",minHeight:F+"px",maxHeight:F+"px",width:"100%",minWidth:"100%",translate:"yes",enableToolbar:this.showToolbar&&!this.disabled&&this.editorFocused,showToolbar:this.showToolbar&&!this.disabled&&this.editorFocused,placeholder:"",defaultParagraphSeparator:"",defaultFontName:"",defaultFontSize:"",fonts:[{class:"arial",name:"Arial"},{class:"times-new-roman",name:"Times New Roman"},{class:"calibri",name:"Calibri"},{class:"comic-sans-ms",name:"Comic Sans MS"}],customClasses:null,uploadUrl:"",uploadWithCredentials:!1,sanitize:!1,outline:!1,toolbarPosition:"top",toolbarHiddenButtons:[["undo","redo"],["insertImage","insertVideo","removeFormat","customClasses"]]}}constructor(F){super(),this.utility=F,this.height=200,this.showToolbar=!0,this.disabled=!1,this.onBlur=new t.vpe,this.textChange=new t.vpe,this.onHeadRemove=new t.vpe,this.editorFocused=!1}}_.\u0275fac=function(F){return new(F||_)(t.Y36(N.t))},_.\u0275cmp=t.Xpm({type:_,selectors:[["app-editor"]],inputs:{text:"text",id:"id",height:"height",showToolbar:"showToolbar",disabled:"disabled"},outputs:{onBlur:"onBlur",textChange:"textChange",onHeadRemove:"onHeadRemove"},features:[t.qOj],decls:1,vars:3,consts:[[3,"id","config","ngModel","ngModelChange","focus","blur"]],template:function(F,M){1&F&&(t.TgZ(0,"angular-editor",0),t.NdJ("ngModelChange",function(L){return M._text=L})("ngModelChange",function(){return M.textChange.emit(M._text)})("focus",function(){return M.editorFocused=!0})("blur",function(){return M.editorFocused=!1,M.onBlur.emit()}),t.qZA()),2&F&&t.Q6J("id",M.id)("config",M.getEditorConfig())("ngModel",M._text)},dependencies:[f.JJ,f.On,p.s6]})},6427:(Ct,$,v)=>{v.d($,{t:()=>st});var t=v(706),N=v(4090),f=v(5879),p=v(724),_=v(6814),W=v(4505),F=v(5477),M=v(9515);function P(S,y){if(1&S&&(f.TgZ(0,"div",12),f._uU(1),f.ALo(2,"translate"),f.qZA()),2&S){const C=f.oxw();f.xp6(1),f.hij(" ",f.lcZ(2,1,C.title),"\n")}}function L(S,y){if(1&S&&f._UZ(0,"img",13),2&S){const C=f.oxw();f.Q6J("src",C.url?C.url:C.base64,f.LSH)}}function R(S,y){1&S&&f._UZ(0,"img",14)}function B(S,y){if(1&S&&(f.TgZ(0,"div",7),f._uU(1),f.qZA()),2&S){const C=f.oxw();f.xp6(1),f.hij(" ",C.url,"\n")}}function j(S,y){if(1&S){const C=f.EpF();f.TgZ(0,"button",15),f.NdJ("click",function(){f.CHM(C);const I=f.oxw();return f.KtG(I.delete())}),f._uU(1),f.ALo(2,"translate"),f.qZA()}2&S&&(f.xp6(1),f.Oqu(f.lcZ(2,1,"globals.elimina")))}const tt=function(S){return{"button-blue":S}};class st extends N.H{set _url(y){this.url=y,this.url?this.deleteButtonEnabled=!0:this.deleteButtonEnabled=!1}constructor(){super(),this.maximumFileSize=0,this.deleteButtonEnabled=!0}fileSelected(y){let C=null==y.files||0==y.files.length?null:y.files[0];if(null!=C&&C.type&&C.type.startsWith("image/"))if(this.maximumFileSize<=0||C.size<=this.maximumFileSize){const A=new FileReader;A.readAsDataURL(C),A.onload=()=>{let I=A.result.toString();I?t.fromBuffer(Uint8Array.from(atob(I.slice(I.indexOf(",")+1)),U=>U.charCodeAt(0)),(U,et)=>{!U&&null!=et&&et.mime&&et.mime.startsWith("image/")?(this.url=null,this.base64=I):(y.value="",this.showError("globals.messages.fileNonValido"))}):(y.value="",this.showError("globals.messages.fileNonValido"))}}else y.value="",this.showError("globals.messages.fileTroppoGrande",{size:Math.floor(this.maximumFileSize/1e3)});else y.value="",this.showError("globals.messages.fileNonValido")}delete(){this.showDialogConfirm("globals.eliminareImmagine").then(y=>{this.dialogRef.close("")},y=>{})}}st.\u0275fac=function(y){return new(y||st)},st.\u0275cmp=f.Xpm({type:st,selectors:[["app-image-edit"]],inputs:{_url:"_url",maximumFileSize:"maximumFileSize",title:"title",dialogRef:"dialogRef",blue:"blue"},features:[f.qOj],decls:16,vars:13,consts:[["mat-icon-button","",1,"modal-close-button",3,"matDialogClose","disableRipple"],[1,"material-icons-round"],["class","mb-2 text-center font-weight-bold",4,"ngIf"],[1,"imageRow","text-center"],["class","rounded",3,"src",4,"ngIf"],["class","rounded","src","assets/images/sbm/no-image.png",4,"ngIf"],["class","mt-3 text-center",4,"ngIf"],[1,"mt-3","text-center"],["autocompleteOff","","type","file","accept","image/png, image/jpeg",3,"change"],["fileInput",""],["mat-flat-button","",3,"color","ngClass","click"],["mat-flat-button","","color","blank","class","ml-1",3,"click",4,"ngIf"],[1,"mb-2","text-center","font-weight-bold"],[1,"rounded",3,"src"],["src","assets/images/sbm/no-image.png",1,"rounded"],["mat-flat-button","","color","blank",1,"ml-1",3,"click"]],template:function(y,C){if(1&y){const A=f.EpF();f.TgZ(0,"button",0)(1,"i",1),f._uU(2,"clear"),f.qZA()(),f.YNc(3,P,3,3,"div",2),f.TgZ(4,"div",3),f.YNc(5,L,1,1,"img",4),f.YNc(6,R,1,0,"img",5),f.qZA(),f.YNc(7,B,2,1,"div",6),f.TgZ(8,"div",7)(9,"input",8,9),f.NdJ("change",function(){f.CHM(A);const U=f.MAs(10);return f.KtG(C.fileSelected(U))}),f.qZA()(),f.TgZ(11,"div",7)(12,"button",10),f.NdJ("click",function(){return C.dialogRef.close(C.base64?C.base64.substring(C.base64.indexOf(",")+1):C.base64)}),f._uU(13),f.ALo(14,"translate"),f.qZA(),f.YNc(15,j,3,3,"button",11),f.qZA()}2&y&&(f.Q6J("disableRipple",!0),f.xp6(3),f.Q6J("ngIf",!!C.title),f.xp6(2),f.Q6J("ngIf",!!C.url||!!C.base64),f.xp6(1),f.Q6J("ngIf",!C.url&&!C.base64),f.xp6(1),f.Q6J("ngIf",!!C.url),f.xp6(5),f.Q6J("color",C.blue?null:"primary")("ngClass",f.VKq(11,tt,C.blue)),f.xp6(1),f.Oqu(f.lcZ(14,9,"globals.salva")),f.xp6(2),f.Q6J("ngIf",C.deleteButtonEnabled))},dependencies:[p.X,_.mk,_.O5,W.eB,F.aO,M.X$],styles:[".imageRow[_ngcontent-%COMP%]{height:180px!important;max-height:180px!important}img[_ngcontent-%COMP%]{max-height:180px!important;max-width:100%!important}"]})},1534:(Ct,$,v)=>{v.d($,{c:()=>S});var t=v(5879),O=v(6814),N=v(4505),f=v(9025),p=v(9515);function _(y,C){if(1&y&&(t.TgZ(0,"mat-card-title",6),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&y){const A=t.oxw(2);t.xp6(1),t.hij(" ",t.lcZ(2,1,A.title)," ")}}function W(y,C){1&y&&t.GkF(0)}function F(y,C){if(1&y&&(t.TgZ(0,"mat-card",3),t.YNc(1,_,3,3,"mat-card-title",4),t.YNc(2,W,1,0,"ng-container",5),t.qZA()),2&y){const A=t.oxw(),I=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!!A.title),t.xp6(1),t.Q6J("ngTemplateOutlet",I)}}function M(y,C){if(1&y&&(t.TgZ(0,"div",8),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&y){const A=t.oxw(2);t.xp6(1),t.Oqu(t.lcZ(2,1,A.title))}}function P(y,C){1&y&&t.GkF(0)}function L(y,C){if(1&y&&(t.ynx(0),t.YNc(1,M,3,3,"div",7),t.YNc(2,P,1,0,"ng-container",5),t.BQk()),2&y){const A=t.oxw(),I=t.MAs(3);t.xp6(1),t.Q6J("ngIf",!!A.title),t.xp6(1),t.Q6J("ngTemplateOutlet",I)}}function R(y,C){if(1&y){const A=t.EpF();t.TgZ(0,"img",14),t.NdJ("click",function(){t.CHM(A);const U=t.oxw(2);return t.KtG(U.edit.emit())}),t.qZA()}if(2&y){const A=t.oxw(2);t.Q6J("src",A.url,t.LSH)}}function B(y,C){if(1&y){const A=t.EpF();t.TgZ(0,"img",15),t.NdJ("click",function(){t.CHM(A);const U=t.oxw(2);return t.KtG(U.edit.emit())}),t.qZA()}}const j=function(y){return{"button-blue":y}};function tt(y,C){if(1&y){const A=t.EpF();t.TgZ(0,"button",16),t.NdJ("click",function(){t.CHM(A);const U=t.oxw(2);return t.KtG(U.delete.emit())}),t.TgZ(1,"i",17),t._uU(2,"delete"),t.qZA()()}if(2&y){const A=t.oxw(2);t.Q6J("color",A.blue?null:"primary")("ngClass",t.VKq(2,j,A.blue))}}function st(y,C){if(1&y&&(t.TgZ(0,"div",9)(1,"div",10),t.YNc(2,R,1,1,"img",11),t.YNc(3,B,1,0,"img",12),t.qZA(),t.YNc(4,tt,3,4,"button",13),t.qZA()),2&y){const A=t.oxw();t.xp6(2),t.Q6J("ngIf",!!A.url),t.xp6(1),t.Q6J("ngIf",!A.url),t.xp6(1),t.Q6J("ngIf",A.deleteAlwaysVisible||!!A.url)}}class S{constructor(){this.container=!0,this.deleteAlwaysVisible=!1,this.blue=!1,this.edit=new t.vpe,this.delete=new t.vpe}}S.\u0275fac=function(C){return new(C||S)},S.\u0275cmp=t.Xpm({type:S,selectors:[["app-image"]],inputs:{title:"title",url:"url",container:"container",deleteAlwaysVisible:"deleteAlwaysVisible",blue:"blue"},outputs:{edit:"edit",delete:"delete"},decls:4,vars:2,consts:[["class","border mat-elevation-z0",4,"ngIf"],[4,"ngIf"],["image",""],[1,"border","mat-elevation-z0"],["class","text-center",4,"ngIf"],[4,"ngTemplateOutlet"],[1,"text-center"],["class","text-center font-weight-bold mb-3",4,"ngIf"],[1,"text-center","font-weight-bold","mb-3"],[1,"imageRow"],[1,"imageHeight"],["class","rounded",3,"src","click",4,"ngIf"],["class","rounded","src","assets/images/sbm/no-image.png",3,"click",4,"ngIf"],["mat-icon-button","","class","delete-button",3,"color","ngClass","click",4,"ngIf"],[1,"rounded",3,"src","click"],["src","assets/images/sbm/no-image.png",1,"rounded",3,"click"],["mat-icon-button","",1,"delete-button",3,"color","ngClass","click"],[1,"material-icons","delete-icon"]],template:function(C,A){1&C&&(t.YNc(0,F,3,2,"mat-card",0),t.YNc(1,L,3,2,"ng-container",1),t.YNc(2,st,5,3,"ng-template",null,2,t.W1O)),2&C&&(t.Q6J("ngIf",A.container),t.xp6(1),t.Q6J("ngIf",!A.container))},dependencies:[O.mk,O.O5,O.tP,N.eB,f.S$,f.mi,p.X$],styles:[".imageHeight[_ngcontent-%COMP%]{max-height:200px!important;text-align:center;width:100%}.imageRow[_ngcontent-%COMP%]{height:200px!important;display:flex;align-items:center;position:relative}img[_ngcontent-%COMP%]{max-height:200px!important;max-width:100%!important}.delete-icon[_ngcontent-%COMP%]{height:30px!important;width:30px!important;font-size:30px!important;line-height:30px!important}.delete-button[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:20px;height:30px!important;width:30px!important;line-height:30px!important}mat-card[_ngcontent-%COMP%]{border:1px solid lightgrey}mat-card-title[_ngcontent-%COMP%]{font-weight:400;font-size:18px}"]})},61:(Ct,$,v)=>{v.d($,{G:()=>E});var t=v(5879);function O(m){return"string"==typeof m||m instanceof String}function N(m){var e;return"object"==typeof m&&null!=m&&"Object"===(null==m||null==(e=m.constructor)?void 0:e.name)}function f(m,e){return Array.isArray(e)?f(m,(i,a)=>e.includes(a)):Object.entries(m).reduce((i,a)=>{let[s,d]=a;return e(d,s)&&(i[s]=d),i},{})}const p_NONE="NONE",p_LEFT="LEFT",p_FORCE_LEFT="FORCE_LEFT",p_RIGHT="RIGHT",p_FORCE_RIGHT="FORCE_RIGHT";function W(m){return m.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function F(m,e){if(e===m)return!0;const i=Array.isArray(e),a=Array.isArray(m);let s;if(i&&a){if(e.length!=m.length)return!1;for(s=0;s<e.length;s++)if(!F(e[s],m[s]))return!1;return!0}if(i!=a)return!1;if(e&&m&&"object"==typeof e&&"object"==typeof m){const d=e instanceof Date,h=m instanceof Date;if(d&&h)return e.getTime()==m.getTime();if(d!=h)return!1;const b=e instanceof RegExp,x=m instanceof RegExp;if(b&&x)return e.toString()==m.toString();if(b!=x)return!1;const k=Object.keys(e);for(s=0;s<k.length;s++)if(!Object.prototype.hasOwnProperty.call(m,k[s]))return!1;for(s=0;s<k.length;s++)if(!F(m[k[s]],e[k[s]]))return!1;return!0}return!(!e||!m||"function"!=typeof e||"function"!=typeof m)&&e.toString()===m.toString()}class M{constructor(e){for(Object.assign(this,e);this.value.slice(0,this.startChangePos)!==this.oldValue.slice(0,this.startChangePos);)--this.oldSelection.start}get startChangePos(){return Math.min(this.cursorPos,this.oldSelection.start)}get insertedCount(){return this.cursorPos-this.startChangePos}get inserted(){return this.value.substr(this.startChangePos,this.insertedCount)}get removedCount(){return Math.max(this.oldSelection.end-this.startChangePos||this.oldValue.length-this.value.length,0)}get removed(){return this.oldValue.substr(this.startChangePos,this.removedCount)}get head(){return this.value.substring(0,this.startChangePos)}get tail(){return this.value.substring(this.startChangePos+this.insertedCount)}get removeDirection(){return!this.removedCount||this.insertedCount?p_NONE:this.oldSelection.end!==this.cursorPos&&this.oldSelection.start!==this.cursorPos||this.oldSelection.end!==this.oldSelection.start?p_LEFT:p_RIGHT}}function P(m,e){return new P.InputMask(m,e)}function L(m){if(null==m)throw new Error("mask property should be defined");return m instanceof RegExp?P.MaskedRegExp:O(m)?P.MaskedPattern:m===Date?P.MaskedDate:m===Number?P.MaskedNumber:Array.isArray(m)||m===Array?P.MaskedDynamic:P.Masked&&m.prototype instanceof P.Masked?m:P.Masked&&m instanceof P.Masked?m.constructor:m instanceof Function?P.MaskedFunction:(console.warn("Mask not found for mask",m),P.Masked)}function R(m){if(!m)throw new Error("Options in not defined");if(P.Masked){if(m.prototype instanceof P.Masked)return{mask:m};const{mask:e,...i}=m instanceof P.Masked?{mask:m}:N(m)&&m.mask instanceof P.Masked?m:{};if(e){const a=e.mask;return{...f(e,(s,d)=>!d.startsWith("_")),mask:e.constructor,_mask:a,...i}}}return N(m)?{...m}:{mask:m}}function B(m){if(P.Masked&&m instanceof P.Masked)return m;const e=R(m),i=L(e.mask);if(!i)throw new Error("Masked class is not found for provided mask, appropriate module needs to be imported manually before creating mask.");return e.mask===i&&delete e.mask,e._mask&&(e.mask=e._mask,delete e._mask),new i(e)}P.createMask=B;class j{get selectionStart(){let e;try{e=this._unsafeSelectionStart}catch{}return e??this.value.length}get selectionEnd(){let e;try{e=this._unsafeSelectionEnd}catch{}return e??this.value.length}select(e,i){if(null!=e&&null!=i&&(e!==this.selectionStart||i!==this.selectionEnd))try{this._unsafeSelect(e,i)}catch{}}get isActive(){return!1}}P.MaskElement=j;class tt extends j{constructor(e){super(),this.input=e,this._handlers={}}get rootElement(){var e,i,a;return null!=(e=null==(i=(a=this.input).getRootNode)?void 0:i.call(a))?e:document}get isActive(){return this.input===this.rootElement.activeElement}bindEvents(e){Object.keys(e).forEach(i=>this._toggleEventHandler(tt.EVENTS_MAP[i],e[i]))}unbindEvents(){Object.keys(this._handlers).forEach(e=>this._toggleEventHandler(e))}_toggleEventHandler(e,i){this._handlers[e]&&(this.input.removeEventListener(e,this._handlers[e]),delete this._handlers[e]),i&&(this.input.addEventListener(e,i),this._handlers[e]=i)}}tt.EVENTS_MAP={selectionChange:"keydown",input:"input",drop:"drop",click:"click",focus:"focus",commit:"blur"},P.HTMLMaskElement=tt;class st extends tt{constructor(e){super(e),this.input=e,this._handlers={}}get _unsafeSelectionStart(){return null!=this.input.selectionStart?this.input.selectionStart:this.value.length}get _unsafeSelectionEnd(){return this.input.selectionEnd}_unsafeSelect(e,i){this.input.setSelectionRange(e,i)}get value(){return this.input.value}set value(e){this.input.value=e}}P.HTMLMaskElement=tt;class S extends tt{get _unsafeSelectionStart(){const e=this.rootElement,i=e.getSelection&&e.getSelection(),a=i&&i.anchorOffset,s=i&&i.focusOffset;return null==s||null==a||a<s?a:s}get _unsafeSelectionEnd(){const e=this.rootElement,i=e.getSelection&&e.getSelection(),a=i&&i.anchorOffset,s=i&&i.focusOffset;return null==s||null==a||a>s?a:s}_unsafeSelect(e,i){if(!this.rootElement.createRange)return;const a=this.rootElement.createRange();a.setStart(this.input.firstChild||this.input,e),a.setEnd(this.input.lastChild||this.input,i);const s=this.rootElement,d=s.getSelection&&s.getSelection();d&&(d.removeAllRanges(),d.addRange(a))}get value(){return this.input.textContent||""}set value(e){this.input.textContent=e}}P.HTMLContenteditableMaskElement=S;P.InputMask=class y{constructor(e,i){this.el=e instanceof j?e:e.isContentEditable&&"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName?new S(e):new st(e),this.masked=B(i),this._listeners={},this._value="",this._unmaskedValue="",this._saveSelection=this._saveSelection.bind(this),this._onInput=this._onInput.bind(this),this._onChange=this._onChange.bind(this),this._onDrop=this._onDrop.bind(this),this._onFocus=this._onFocus.bind(this),this._onClick=this._onClick.bind(this),this.alignCursor=this.alignCursor.bind(this),this.alignCursorFriendly=this.alignCursorFriendly.bind(this),this._bindEvents(),this.updateValue(),this._onChange()}maskEquals(e){var i;return null==e||(null==(i=this.masked)?void 0:i.maskEquals(e))}get mask(){return this.masked.mask}set mask(e){if(this.maskEquals(e))return;if(!(e instanceof P.Masked)&&this.masked.constructor===L(e))return void this.masked.updateOptions({mask:e});const i=e instanceof P.Masked?e:B({mask:e});i.unmaskedValue=this.masked.unmaskedValue,this.masked=i}get value(){return this._value}set value(e){this.value!==e&&(this.masked.value=e,this.updateControl(),this.alignCursor())}get unmaskedValue(){return this._unmaskedValue}set unmaskedValue(e){this.unmaskedValue!==e&&(this.masked.unmaskedValue=e,this.updateControl(),this.alignCursor())}get typedValue(){return this.masked.typedValue}set typedValue(e){this.masked.typedValueEquals(e)||(this.masked.typedValue=e,this.updateControl(),this.alignCursor())}get displayValue(){return this.masked.displayValue}_bindEvents(){this.el.bindEvents({selectionChange:this._saveSelection,input:this._onInput,drop:this._onDrop,click:this._onClick,focus:this._onFocus,commit:this._onChange})}_unbindEvents(){this.el&&this.el.unbindEvents()}_fireEvent(e,i){const a=this._listeners[e];a&&a.forEach(s=>s(i))}get selectionStart(){return this._cursorChanging?this._changingCursorPos:this.el.selectionStart}get cursorPos(){return this._cursorChanging?this._changingCursorPos:this.el.selectionEnd}set cursorPos(e){!this.el||!this.el.isActive||(this.el.select(e,e),this._saveSelection())}_saveSelection(){this.displayValue!==this.el.value&&console.warn("Element value was changed outside of mask. Syncronize mask using `mask.updateValue()` to work properly."),this._selection={start:this.selectionStart,end:this.cursorPos}}updateValue(){this.masked.value=this.el.value,this._value=this.masked.value}updateControl(){const e=this.masked.unmaskedValue,i=this.masked.value,a=this.displayValue,s=this.unmaskedValue!==e||this.value!==i;this._unmaskedValue=e,this._value=i,this.el.value!==a&&(this.el.value=a),s&&this._fireChangeEvents()}updateOptions(e){const{mask:i,...a}=e,s=!this.maskEquals(i),d=!F(this.masked,a);s&&(this.mask=i),d&&this.masked.updateOptions(a),(s||d)&&this.updateControl()}updateCursor(e){null!=e&&(this.cursorPos=e,this._delayUpdateCursor(e))}_delayUpdateCursor(e){this._abortUpdateCursor(),this._changingCursorPos=e,this._cursorChanging=setTimeout(()=>{this.el&&(this.cursorPos=this._changingCursorPos,this._abortUpdateCursor())},10)}_fireChangeEvents(){this._fireEvent("accept",this._inputEvent),this.masked.isComplete&&this._fireEvent("complete",this._inputEvent)}_abortUpdateCursor(){this._cursorChanging&&(clearTimeout(this._cursorChanging),delete this._cursorChanging)}alignCursor(){this.cursorPos=this.masked.nearestInputPos(this.masked.nearestInputPos(this.cursorPos,p_LEFT))}alignCursorFriendly(){this.selectionStart===this.cursorPos&&this.alignCursor()}on(e,i){return this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(i),this}off(e,i){if(!this._listeners[e])return this;if(!i)return delete this._listeners[e],this;const a=this._listeners[e].indexOf(i);return a>=0&&this._listeners[e].splice(a,1),this}_onInput(e){if(this._inputEvent=e,this._abortUpdateCursor(),!this._selection)return this.updateValue();const i=new M({value:this.el.value,cursorPos:this.cursorPos,oldValue:this.displayValue,oldSelection:this._selection}),a=this.masked.rawInputValue,s=this.masked.splice(i.startChangePos,i.removed.length,i.inserted,i.removeDirection,{input:!0,raw:!0}).offset,d=a===this.masked.rawInputValue?i.removeDirection:p_NONE;let h=this.masked.nearestInputPos(i.startChangePos+s,d);d!==p_NONE&&(h=this.masked.nearestInputPos(h,p_NONE)),this.updateControl(),this.updateCursor(h),delete this._inputEvent}_onChange(){this.displayValue!==this.el.value&&this.updateValue(),this.masked.doCommit(),this.updateControl(),this._saveSelection()}_onDrop(e){e.preventDefault(),e.stopPropagation()}_onFocus(e){this.alignCursorFriendly()}_onClick(e){this.alignCursorFriendly()}destroy(){this._unbindEvents(),this._listeners.length=0,delete this.el}};class C{static normalize(e){return Array.isArray(e)?e:[e,new C]}constructor(e){Object.assign(this,{inserted:"",rawInserted:"",skip:!1,tailShift:0},e)}aggregate(e){return this.rawInserted+=e.rawInserted,this.skip=this.skip||e.skip,this.inserted+=e.inserted,this.tailShift+=e.tailShift,this}get offset(){return this.tailShift+this.inserted.length}}P.ChangeDetails=C;class A{constructor(e,i,a){void 0===e&&(e=""),void 0===i&&(i=0),this.value=e,this.from=i,this.stop=a}toString(){return this.value}extend(e){this.value+=String(e)}appendTo(e){return e.append(this.toString(),{tail:!0}).aggregate(e._appendPlaceholder())}get state(){return{value:this.value,from:this.from,stop:this.stop}}set state(e){Object.assign(this,e)}unshift(e){if(!this.value.length||null!=e&&this.from>=e)return"";const i=this.value[0];return this.value=this.value.slice(1),i}shift(){if(!this.value.length)return"";const e=this.value[this.value.length-1];return this.value=this.value.slice(0,-1),e}}class I{constructor(e){this._value="",this._update({...I.DEFAULTS,...e}),this._initialized=!0}updateOptions(e){Object.keys(e).length&&this.withValueRefresh(this._update.bind(this,e))}_update(e){Object.assign(this,e)}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue}}set state(e){this._value=e._value}reset(){this._value=""}get value(){return this._value}set value(e){this.resolve(e,{input:!0})}resolve(e,i){void 0===i&&(i={input:!0}),this.reset(),this.append(e,i,""),this.doCommit()}get unmaskedValue(){return this.value}set unmaskedValue(e){this.resolve(e,{})}get typedValue(){return this.parse?this.parse(this.value,this):this.unmaskedValue}set typedValue(e){this.format?this.value=this.format(e,this):this.unmaskedValue=String(e)}get rawInputValue(){return this.extractInput(0,this.value.length,{raw:!0})}set rawInputValue(e){this.resolve(e,{raw:!0})}get displayValue(){return this.value}get isComplete(){return!0}get isFilled(){return this.isComplete}nearestInputPos(e,i){return e}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),Math.min(this.value.length,i-e)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.value.slice(e,i)}extractTail(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),new A(this.extractInput(e,i),e)}appendTail(e){return O(e)&&(e=new A(String(e))),e.appendTo(this)}_appendCharRaw(e,i){return e?(this._value+=e,new C({inserted:e,rawInserted:e})):new C}_appendChar(e,i,a){void 0===i&&(i={});const s=this.state;let d;if([e,d]=this.doPrepareChar(e,i),d=d.aggregate(this._appendCharRaw(e,i)),d.inserted){let h,b=!1!==this.doValidate(i);if(b&&null!=a){const x=this.state;!0===this.overwrite&&(h=a.state,a.unshift(this.value.length-d.tailShift));let k=this.appendTail(a);b=k.rawInserted===a.toString(),!(b&&k.inserted)&&"shift"===this.overwrite&&(this.state=x,h=a.state,a.shift(),k=this.appendTail(a),b=k.rawInserted===a.toString()),b&&k.inserted&&(this.state=x)}b||(d=new C,this.state=s,a&&h&&(a.state=h))}return d}_appendPlaceholder(){return new C}_appendEager(){return new C}append(e,i,a){if(!O(e))throw new Error("value should be string");const s=O(a)?new A(String(a)):a;let d;null!=i&&i.tail&&(i._beforeTailState=this.state),[e,d]=this.doPrepare(e,i);for(let h=0;h<e.length;++h){const b=this._appendChar(e[h],i,s);if(!b.rawInserted&&!this.doSkipInvalid(e[h],i,s))break;d.aggregate(b)}return(!0===this.eager||"append"===this.eager)&&null!=i&&i.input&&e&&d.aggregate(this._appendEager()),null!=s&&(d.tailShift+=this.appendTail(s).tailShift),d}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this._value=this.value.slice(0,e)+this.value.slice(i),new C}withValueRefresh(e){if(this._refreshing||!this._initialized)return e();this._refreshing=!0;const i=this.rawInputValue,a=this.value,s=e();return this.rawInputValue=i,this.value&&this.value!==a&&0===a.indexOf(this.value)&&this.append(a.slice(this.value.length),{},""),delete this._refreshing,s}runIsolated(e){if(this._isolated||!this._initialized)return e(this);this._isolated=!0;const i=this.state,a=e(this);return this.state=i,delete this._isolated,a}doSkipInvalid(e,i,a){return!!this.skipInvalid}doPrepare(e,i){return void 0===i&&(i={}),C.normalize(this.prepare?this.prepare(e,this,i):e)}doPrepareChar(e,i){return void 0===i&&(i={}),C.normalize(this.prepareChar?this.prepareChar(e,this,i):e)}doValidate(e){return(!this.validate||this.validate(this.value,this,e))&&(!this.parent||this.parent.doValidate(e))}doCommit(){this.commit&&this.commit(this.value,this)}splice(e,i,a,s,d){void 0===s&&(s=p_NONE),void 0===d&&(d={input:!0});const h=e+i,b=this.extractTail(h),x=!0===this.eager||"remove"===this.eager;let k;x&&(s=function _(m){switch(m){case p_LEFT:return p_FORCE_LEFT;case p_RIGHT:return p_FORCE_RIGHT;default:return m}}(s),k=this.extractInput(0,h,{raw:!0}));let V=e;const K=new C;if(s!==p_NONE&&(V=this.nearestInputPos(e,i>1&&0!==e&&!x?p_NONE:s),K.tailShift=V-e),K.aggregate(this.remove(V)),x&&s!==p_NONE&&k===this.rawInputValue)if(s===p_FORCE_LEFT){let ot;for(;k===this.rawInputValue&&(ot=this.value.length);)K.aggregate(new C({tailShift:-1})).aggregate(this.remove(ot-1))}else s===p_FORCE_RIGHT&&b.unshift();return K.aggregate(this.append(a,d,b))}maskEquals(e){return this.mask===e}typedValueEquals(e){const i=this.typedValue;return e===i||I.EMPTY_VALUES.includes(e)&&I.EMPTY_VALUES.includes(i)||!!this.format&&this.format(e,this)===this.format(this.typedValue,this)}}I.DEFAULTS={skipInvalid:!0},I.EMPTY_VALUES=[void 0,null,""],P.Masked=I;class U{constructor(e,i){void 0===e&&(e=[]),void 0===i&&(i=0),this.chunks=e,this.from=i}toString(){return this.chunks.map(String).join("")}extend(e){if(!String(e))return;e=O(e)?new A(String(e)):e;const i=this.chunks[this.chunks.length-1],a=i&&(i.stop===e.stop||null==e.stop)&&e.from===i.from+i.toString().length;if(e instanceof A)a?i.extend(e.toString()):this.chunks.push(e);else if(e instanceof U){if(null==e.stop){let s;for(;e.chunks.length&&null==e.chunks[0].stop;)s=e.chunks.shift(),s.from+=e.from,this.extend(s)}e.toString()&&(e.stop=e.blockIndex,this.chunks.push(e))}}appendTo(e){if(!(e instanceof P.MaskedPattern))return new A(this.toString()).appendTo(e);const i=new C;for(let a=0;a<this.chunks.length&&!i.skip;++a){const s=this.chunks[a],d=e._mapPosToBlock(e.value.length),h=s.stop;let b;if(null!=h&&(!d||d.index<=h)){if(s instanceof U||e._stops.indexOf(h)>=0){const x=e._appendPlaceholder(h);i.aggregate(x)}b=s instanceof U&&e._blocks[h]}if(b){const x=b.appendTail(s);x.skip=!1,i.aggregate(x),e._value+=x.inserted;const k=s.toString().slice(x.rawInserted.length);k&&i.aggregate(e.append(k,{tail:!0}))}else i.aggregate(e.append(s.toString(),{tail:!0}))}return i}get state(){return{chunks:this.chunks.map(e=>e.state),from:this.from,stop:this.stop,blockIndex:this.blockIndex}}set state(e){const{chunks:i,...a}=e;Object.assign(this,a),this.chunks=i.map(s=>{const d="chunks"in s?new U:new A;return d.state=s,d})}unshift(e){if(!this.chunks.length||null!=e&&this.from>=e)return"";const i=null!=e?e-this.from:e;let a=0;for(;a<this.chunks.length;){const s=this.chunks[a],d=s.unshift(i);if(s.toString()){if(!d)break;++a}else this.chunks.splice(a,1);if(d)return d}return""}shift(){if(!this.chunks.length)return"";let e=this.chunks.length-1;for(;0<=e;){const i=this.chunks[e],a=i.shift();if(i.toString()){if(!a)break;--e}else this.chunks.splice(e,1);if(a)return a}return""}}class et{constructor(e,i){this.masked=e,this._log=[];const{offset:a,index:s}=e._mapPosToBlock(i)||(i<0?{index:0,offset:0}:{index:this.masked._blocks.length,offset:0});this.offset=a,this.index=s,this.ok=!1}get block(){return this.masked._blocks[this.index]}get pos(){return this.masked._blockStartPos(this.index)+this.offset}get state(){return{index:this.index,offset:this.offset,ok:this.ok}}set state(e){Object.assign(this,e)}pushState(){this._log.push(this.state)}popState(){const e=this._log.pop();return e&&(this.state=e),e}bindBlock(){this.block||(this.index<0&&(this.index=0,this.offset=0),this.index>=this.masked._blocks.length&&(this.index=this.masked._blocks.length-1,this.offset=this.block.value.length))}_pushLeft(e){for(this.pushState(),this.bindBlock();0<=this.index;--this.index,this.offset=(null==(i=this.block)?void 0:i.value.length)||0){var i;if(e())return this.ok=!0}return this.ok=!1}_pushRight(e){for(this.pushState(),this.bindBlock();this.index<this.masked._blocks.length;++this.index,this.offset=0)if(e())return this.ok=!0;return this.ok=!1}pushLeftBeforeFilled(){return this._pushLeft(()=>{if(!this.block.isFixed&&this.block.value&&(this.offset=this.block.nearestInputPos(this.offset,p_FORCE_LEFT),0!==this.offset))return!0})}pushLeftBeforeInput(){return this._pushLeft(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,p_LEFT),!0})}pushLeftBeforeRequired(){return this._pushLeft(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,p_LEFT),!0})}pushRightBeforeFilled(){return this._pushRight(()=>{if(!this.block.isFixed&&this.block.value&&(this.offset=this.block.nearestInputPos(this.offset,p_FORCE_RIGHT),this.offset!==this.block.value.length))return!0})}pushRightBeforeInput(){return this._pushRight(()=>{if(!this.block.isFixed)return this.offset=this.block.nearestInputPos(this.offset,p_NONE),!0})}pushRightBeforeRequired(){return this._pushRight(()=>{if(!(this.block.isFixed||this.block.isOptional&&!this.block.value))return this.offset=this.block.nearestInputPos(this.offset,p_NONE),!0})}}class yt{constructor(e){Object.assign(this,e),this._value="",this.isFixed=!0}get value(){return this._value}get unmaskedValue(){return this.isUnmasking?this.value:""}get rawInputValue(){return this._isRawInput?this.value:""}get displayValue(){return this.value}reset(){this._isRawInput=!1,this._value=""}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),this._value=this._value.slice(0,e)+this._value.slice(i),this._value||(this._isRawInput=!1),new C}nearestInputPos(e,i){void 0===i&&(i=p_NONE);const s=this._value.length;switch(i){case p_LEFT:case p_FORCE_LEFT:return 0;default:return s}}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),this._isRawInput?i-e:0}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this._value.length),void 0===a&&(a={}),a.raw&&this._isRawInput&&this._value.slice(e,i)||""}get isComplete(){return!0}get isFilled(){return!!this._value}_appendChar(e,i){void 0===i&&(i={});const a=new C;if(this.isFilled)return a;const s=!0===this.eager||"append"===this.eager,h=this.char===e&&(this.isUnmasking||i.input||i.raw)&&(!i.raw||!s)&&!i.tail;return h&&(a.rawInserted=this.char),this._value=a.inserted=this.char,this._isRawInput=h&&(i.raw||i.input),a}_appendEager(){return this._appendChar(this.char,{tail:!0})}_appendPlaceholder(){const e=new C;return this.isFilled||(this._value=e.inserted=this.char),e}extractTail(){return new A("")}appendTail(e){return O(e)&&(e=new A(String(e))),e.appendTo(this)}append(e,i,a){const s=this._appendChar(e[0],i);return null!=a&&(s.tailShift+=this.appendTail(a).tailShift),s}doCommit(){}get state(){return{_value:this._value,_rawInputValue:this.rawInputValue}}set state(e){this._value=e._value,this._isRawInput=!!e._rawInputValue}}class gt{constructor(e){const{parent:i,isOptional:a,placeholderChar:s,displayChar:d,lazy:h,eager:b,...x}=e;this.masked=B(x),Object.assign(this,{parent:i,isOptional:a,placeholderChar:s,displayChar:d,lazy:h,eager:b})}reset(){this.isFilled=!1,this.masked.reset()}remove(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),0===e&&i>=1?(this.isFilled=!1,this.masked.remove(e,i)):new C}get value(){return this.masked.value||(this.isFilled&&!this.isOptional?this.placeholderChar:"")}get unmaskedValue(){return this.masked.unmaskedValue}get rawInputValue(){return this.masked.rawInputValue}get displayValue(){return this.masked.value&&this.displayChar||this.value}get isComplete(){return!!this.masked.value||this.isOptional}_appendChar(e,i){if(void 0===i&&(i={}),this.isFilled)return new C;const a=this.masked.state,s=this.masked._appendChar(e,this.currentMaskFlags(i));return s.inserted&&!1===this.doValidate(i)&&(s.inserted=s.rawInserted="",this.masked.state=a),!s.inserted&&!this.isOptional&&!this.lazy&&!i.input&&(s.inserted=this.placeholderChar),s.skip=!s.inserted&&!this.isOptional,this.isFilled=!!s.inserted,s}append(e,i,a){return this.masked.append(e,this.currentMaskFlags(i),a)}_appendPlaceholder(){const e=new C;return this.isFilled||this.isOptional||(this.isFilled=!0,e.inserted=this.placeholderChar),e}_appendEager(){return new C}extractTail(e,i){return this.masked.extractTail(e,i)}appendTail(e){return this.masked.appendTail(e)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.masked.extractInput(e,i,a)}nearestInputPos(e,i){void 0===i&&(i=p_NONE);const s=this.value.length,d=Math.min(Math.max(e,0),s);switch(i){case p_LEFT:case p_FORCE_LEFT:return this.isComplete?d:0;case p_RIGHT:case p_FORCE_RIGHT:return this.isComplete?d:s;default:return d}}totalInputPositions(e,i){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),this.value.slice(e,i).length}doValidate(e){return this.masked.doValidate(this.currentMaskFlags(e))&&(!this.parent||this.parent.doValidate(this.currentMaskFlags(e)))}doCommit(){this.masked.doCommit()}get state(){return{_value:this.value,_rawInputValue:this.rawInputValue,masked:this.masked.state,isFilled:this.isFilled}}set state(e){this.masked.state=e.masked,this.isFilled=e.isFilled}currentMaskFlags(e){var i;return{...e,_beforeTailState:(null==e||null==(i=e._beforeTailState)?void 0:i.masked)||e?._beforeTailState}}}gt.DEFAULT_DEFINITIONS={0:/\d/,a:/[\u0041-\u005A\u0061-\u007A\u00AA\u00B5\u00BA\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0\u08A2-\u08AC\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097F\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C33\u0C35-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191C\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA697\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA793\uA7A0-\uA7AA\uA7F8-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA80-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,"*":/./};P.MaskedRegExp=class rt extends I{updateOptions(e){super.updateOptions(e)}_update(e){const i=e.mask;i&&(e.validate=a=>a.search(i)>=0),super._update(e)}};class Q extends I{constructor(e){super({...Q.DEFAULTS,...e,definitions:Object.assign({},gt.DEFAULT_DEFINITIONS,e?.definitions)})}updateOptions(e){super.updateOptions(e)}_update(e){e.definitions=Object.assign({},this.definitions,e.definitions),super._update(e),this._rebuildMask()}_rebuildMask(){const e=this.definitions;this._blocks=[],this._stops=[],this._maskedBlocks={};const i=this.mask;if(!i||!e)return;let a=!1,s=!1;for(let d=0;d<i.length;++d){if(this.blocks){const k=i.slice(d),V=Object.keys(this.blocks).filter(ot=>0===k.indexOf(ot));V.sort((ot,Tt)=>Tt.length-ot.length);const K=V[0];if(K){const ot=B({lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar,overwrite:this.overwrite,...R(this.blocks[K]),parent:this});ot&&(this._blocks.push(ot),this._maskedBlocks[K]||(this._maskedBlocks[K]=[]),this._maskedBlocks[K].push(this._blocks.length-1)),d+=K.length-1;continue}}let h=i[d],b=h in e;if(h===Q.STOP_CHAR){this._stops.push(this._blocks.length);continue}if("{"===h||"}"===h){a=!a;continue}if("["===h||"]"===h){s=!s;continue}if(h===Q.ESCAPE_CHAR){if(++d,h=i[d],!h)break;b=!1}const x=b?new gt({isOptional:s,lazy:this.lazy,eager:this.eager,placeholderChar:this.placeholderChar,displayChar:this.displayChar,...R(e[h]),parent:this}):new yt({char:h,eager:this.eager,isUnmasking:a});this._blocks.push(x)}}get state(){return{...super.state,_blocks:this._blocks.map(e=>e.state)}}set state(e){const{_blocks:i,...a}=e;this._blocks.forEach((s,d)=>s.state=i[d]),super.state=a}reset(){super.reset(),this._blocks.forEach(e=>e.reset())}get isComplete(){return this._blocks.every(e=>e.isComplete)}get isFilled(){return this._blocks.every(e=>e.isFilled)}get isFixed(){return this._blocks.every(e=>e.isFixed)}get isOptional(){return this._blocks.every(e=>e.isOptional)}doCommit(){this._blocks.forEach(e=>e.doCommit()),super.doCommit()}get unmaskedValue(){return this._blocks.reduce((e,i)=>e+i.unmaskedValue,"")}set unmaskedValue(e){super.unmaskedValue=e}get value(){return this._blocks.reduce((e,i)=>e+i.value,"")}set value(e){super.value=e}get displayValue(){return this._blocks.reduce((e,i)=>e+i.displayValue,"")}appendTail(e){return super.appendTail(e).aggregate(this._appendPlaceholder())}_appendEager(){var e;const i=new C;let a=null==(e=this._mapPosToBlock(this.value.length))?void 0:e.index;if(null==a)return i;this._blocks[a].isFilled&&++a;for(let s=a;s<this._blocks.length;++s){const d=this._blocks[s]._appendEager();if(!d.inserted)break;i.aggregate(d)}return i}_appendCharRaw(e,i){void 0===i&&(i={});const a=this._mapPosToBlock(this.value.length),s=new C;if(!a)return s;for(let b=a.index;;++b){var d,h;const x=this._blocks[b];if(!x)break;const k=x._appendChar(e,{...i,_beforeTailState:null==(d=i._beforeTailState)||null==(h=d._blocks)?void 0:h[b]}),V=k.skip;if(s.aggregate(k),V||k.rawInserted)break}return s}extractTail(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);const a=new U;return e===i||this._forEachBlocksInRange(e,i,(s,d,h,b)=>{const x=s.extractTail(h,b);x.stop=this._findStopBefore(d),x.from=this._blockStartPos(d),x instanceof U&&(x.blockIndex=d),a.extend(x)}),a}extractInput(e,i,a){if(void 0===e&&(e=0),void 0===i&&(i=this.value.length),void 0===a&&(a={}),e===i)return"";let s="";return this._forEachBlocksInRange(e,i,(d,h,b,x)=>{s+=d.extractInput(b,x,a)}),s}_findStopBefore(e){let i;for(let a=0;a<this._stops.length;++a){const s=this._stops[a];if(!(s<=e))break;i=s}return i}_appendPlaceholder(e){const i=new C;if(this.lazy&&null==e)return i;const a=this._mapPosToBlock(this.value.length);if(!a)return i;const s=a.index,d=e??this._blocks.length;return this._blocks.slice(s,d).forEach(h=>{if(!h.lazy||null!=e){var b;const x=h._appendPlaceholder(null==(b=h._blocks)?void 0:b.length);this._value+=x.inserted,i.aggregate(x)}}),i}_mapPosToBlock(e){let i="";for(let a=0;a<this._blocks.length;++a){const s=this._blocks[a],d=i.length;if(i+=s.value,e<=i.length)return{index:a,offset:e-d}}}_blockStartPos(e){return this._blocks.slice(0,e).reduce((i,a)=>i+a.value.length,0)}_forEachBlocksInRange(e,i,a){void 0===i&&(i=this.value.length);const s=this._mapPosToBlock(e);if(s){const d=this._mapPosToBlock(i),h=d&&s.index===d.index,b=s.offset,x=d&&h?d.offset:this._blocks[s.index].value.length;if(a(this._blocks[s.index],s.index,b,x),d&&!h){for(let k=s.index+1;k<d.index;++k)a(this._blocks[k],k,0,this._blocks[k].value.length);a(this._blocks[d.index],d.index,0,d.offset)}}}remove(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);const a=super.remove(e,i);return this._forEachBlocksInRange(e,i,(s,d,h,b)=>{a.aggregate(s.remove(h,b))}),a}nearestInputPos(e,i){if(void 0===i&&(i=p_NONE),!this._blocks.length)return 0;const a=new et(this,e);if(i===p_NONE)return a.pushRightBeforeInput()||(a.popState(),a.pushLeftBeforeInput())?a.pos:this.value.length;if(i===p_LEFT||i===p_FORCE_LEFT){if(i===p_LEFT){if(a.pushRightBeforeFilled(),a.ok&&a.pos===e)return e;a.popState()}if(a.pushLeftBeforeInput(),a.pushLeftBeforeRequired(),a.pushLeftBeforeFilled(),i===p_LEFT){if(a.pushRightBeforeInput(),a.pushRightBeforeRequired(),a.ok&&a.pos<=e||(a.popState(),a.ok&&a.pos<=e))return a.pos;a.popState()}return a.ok?a.pos:i===p_FORCE_LEFT?0:(a.popState(),a.ok||(a.popState(),a.ok)?a.pos:0)}return i===p_RIGHT||i===p_FORCE_RIGHT?(a.pushRightBeforeInput(),a.pushRightBeforeRequired(),a.pushRightBeforeFilled()?a.pos:i===p_FORCE_RIGHT?this.value.length:(a.popState(),a.ok||(a.popState(),a.ok)?a.pos:this.nearestInputPos(e,p_LEFT))):e}totalInputPositions(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length);let a=0;return this._forEachBlocksInRange(e,i,(s,d,h,b)=>{a+=s.totalInputPositions(h,b)}),a}maskedBlock(e){return this.maskedBlocks(e)[0]}maskedBlocks(e){const i=this._maskedBlocks[e];return i?i.map(a=>this._blocks[a]):[]}}Q.DEFAULTS={lazy:!0,placeholderChar:"_"},Q.STOP_CHAR="`",Q.ESCAPE_CHAR="\\",Q.InputDefinition=gt,Q.FixedDefinition=yt,P.MaskedPattern=Q;class g extends Q{get _matchFrom(){return this.maxLength-String(this.from).length}constructor(e){super(e)}updateOptions(e){super.updateOptions(e)}_update(e){const{to:i=this.to||0,from:a=this.from||0,maxLength:s=this.maxLength||0,autofix:d=this.autofix,...h}=e;this.to=i,this.from=a,this.maxLength=Math.max(String(i).length,s),this.autofix=d;const b=String(this.from).padStart(this.maxLength,"0"),x=String(this.to).padStart(this.maxLength,"0");let k=0;for(;k<x.length&&x[k]===b[k];)++k;h.mask=x.slice(0,k).replace(/0/g,"\\0")+"0".repeat(this.maxLength-k),super._update(h)}get isComplete(){return super.isComplete&&!!this.value}boundaries(e){let i="",a="";const[,s,d]=e.match(/^(\D*)(\d*)(\D*)/)||[];return d&&(i="0".repeat(s.length)+d,a="9".repeat(s.length)+d),i=i.padEnd(this.maxLength,"0"),a=a.padEnd(this.maxLength,"9"),[i,a]}doPrepareChar(e,i){let a;if(void 0===i&&(i={}),[e,a]=super.doPrepareChar(e.replace(/\D/g,""),i),!this.autofix||!e)return[e,a];const s=String(this.from).padStart(this.maxLength,"0"),d=String(this.to).padStart(this.maxLength,"0"),h=this.value+e;if(h.length>this.maxLength)return["",a];const[b,x]=this.boundaries(h);return Number(x)<this.from?[s[h.length-1],a]:Number(b)>this.to?"pad"===this.autofix&&h.length<this.maxLength?["",a.aggregate(this.append(s[h.length-1]+e,i))]:[d[h.length-1],a]:[e,a]}doValidate(e){const i=this.value;if(-1===i.search(/[^0]/)&&i.length<=this._matchFrom)return!0;const[s,d]=this.boundaries(i);return this.from<=Number(d)&&Number(s)<=this.to&&super.doValidate(e)}}P.MaskedRange=g;class T extends Q{constructor(e){const{mask:i,pattern:a,...s}={...T.DEFAULTS,...e};super({...s,mask:O(i)?i:a})}updateOptions(e){super.updateOptions(e)}_update(e){const{mask:i,pattern:a,blocks:s,...d}={...T.DEFAULTS,...e},h=Object.assign({},T.GET_DEFAULT_BLOCKS());e.min&&(h.Y.from=e.min.getFullYear()),e.max&&(h.Y.to=e.max.getFullYear()),e.min&&e.max&&h.Y.from===h.Y.to&&(h.m.from=e.min.getMonth()+1,h.m.to=e.max.getMonth()+1,h.m.from===h.m.to&&(h.d.from=e.min.getDate(),h.d.to=e.max.getDate())),Object.assign(h,this.blocks,s),Object.keys(h).forEach(b=>{const x=h[b];!("autofix"in x)&&"autofix"in e&&(x.autofix=e.autofix)}),super._update({...d,mask:O(i)?i:a,blocks:h})}doValidate(e){const i=this.date;return super.doValidate(e)&&(!this.isComplete||this.isDateExist(this.value)&&null!=i&&(null==this.min||this.min<=i)&&(null==this.max||i<=this.max))}isDateExist(e){return this.format(this.parse(e,this),this).indexOf(e)>=0}get date(){return this.typedValue}set date(e){this.typedValue=e}get typedValue(){return this.isComplete?super.typedValue:null}set typedValue(e){super.typedValue=e}maskEquals(e){return e===Date||super.maskEquals(e)}}T.GET_DEFAULT_BLOCKS=()=>({d:{mask:g,from:1,to:31,maxLength:2},m:{mask:g,from:1,to:12,maxLength:2},Y:{mask:g,from:1900,to:9999}}),T.DEFAULTS={mask:Date,pattern:"d{.}`m{.}`Y",format:(m,e)=>{if(!m)return"";return[String(m.getDate()).padStart(2,"0"),String(m.getMonth()+1).padStart(2,"0"),m.getFullYear()].join(".")},parse:(m,e)=>{const[i,a,s]=m.split(".").map(Number);return new Date(s,a-1,i)}},P.MaskedDate=T;class w extends I{constructor(e){super({...w.DEFAULTS,...e}),this.currentMask=void 0}updateOptions(e){super.updateOptions(e)}_update(e){super._update(e),"mask"in e&&(this.compiledMasks=Array.isArray(e.mask)?e.mask.map(i=>B({overwrite:this._overwrite,eager:this._eager,skipInvalid:this._skipInvalid,...R(i)})):[])}_appendCharRaw(e,i){void 0===i&&(i={});const a=this._applyDispatch(e,i);return this.currentMask&&a.aggregate(this.currentMask._appendChar(e,this.currentMaskFlags(i))),a}_applyDispatch(e,i,a){void 0===e&&(e=""),void 0===i&&(i={}),void 0===a&&(a="");const s=i.tail&&null!=i._beforeTailState?i._beforeTailState._value:this.value,d=this.rawInputValue,h=i.tail&&null!=i._beforeTailState?i._beforeTailState._rawInputValue:d,b=d.slice(h.length),x=this.currentMask,k=new C,V=x?.state;if(this.currentMask=this.doDispatch(e,{...i},a),this.currentMask)if(this.currentMask!==x){if(this.currentMask.reset(),h){const K=this.currentMask.append(h,{raw:!0});k.tailShift=K.inserted.length-s.length}b&&(k.tailShift+=this.currentMask.append(b,{raw:!0,tail:!0}).tailShift)}else V&&(this.currentMask.state=V);return k}_appendPlaceholder(){const e=this._applyDispatch();return this.currentMask&&e.aggregate(this.currentMask._appendPlaceholder()),e}_appendEager(){const e=this._applyDispatch();return this.currentMask&&e.aggregate(this.currentMask._appendEager()),e}appendTail(e){const i=new C;return e&&i.aggregate(this._applyDispatch("",{},e)),i.aggregate(this.currentMask?this.currentMask.appendTail(e):super.appendTail(e))}currentMaskFlags(e){var i,a;return{...e,_beforeTailState:(null==(i=e._beforeTailState)?void 0:i.currentMaskRef)===this.currentMask&&(null==(a=e._beforeTailState)?void 0:a.currentMask)||e._beforeTailState}}doDispatch(e,i,a){return void 0===i&&(i={}),void 0===a&&(a=""),this.dispatch(e,this,i,a)}doValidate(e){return super.doValidate(e)&&(!this.currentMask||this.currentMask.doValidate(this.currentMaskFlags(e)))}doPrepare(e,i){void 0===i&&(i={});let[a,s]=super.doPrepare(e,i);if(this.currentMask){let d;[a,d]=super.doPrepare(a,this.currentMaskFlags(i)),s=s.aggregate(d)}return[a,s]}doPrepareChar(e,i){void 0===i&&(i={});let[a,s]=super.doPrepareChar(e,i);if(this.currentMask){let d;[a,d]=super.doPrepareChar(a,this.currentMaskFlags(i)),s=s.aggregate(d)}return[a,s]}reset(){var e;null==(e=this.currentMask)||e.reset(),this.compiledMasks.forEach(i=>i.reset())}get value(){return this.currentMask?this.currentMask.value:""}set value(e){super.value=e}get unmaskedValue(){return this.currentMask?this.currentMask.unmaskedValue:""}set unmaskedValue(e){super.unmaskedValue=e}get typedValue(){return this.currentMask?this.currentMask.typedValue:""}set typedValue(e){let i=String(e);this.currentMask&&(this.currentMask.typedValue=e,i=this.currentMask.unmaskedValue),this.unmaskedValue=i}get displayValue(){return this.currentMask?this.currentMask.displayValue:""}get isComplete(){var e;return!(null==(e=this.currentMask)||!e.isComplete)}get isFilled(){var e;return!(null==(e=this.currentMask)||!e.isFilled)}remove(e,i){const a=new C;return this.currentMask&&a.aggregate(this.currentMask.remove(e,i)).aggregate(this._applyDispatch()),a}get state(){var e;return{...super.state,_rawInputValue:this.rawInputValue,compiledMasks:this.compiledMasks.map(i=>i.state),currentMaskRef:this.currentMask,currentMask:null==(e=this.currentMask)?void 0:e.state}}set state(e){const{compiledMasks:i,currentMaskRef:a,currentMask:s,...d}=e;i&&this.compiledMasks.forEach((h,b)=>h.state=i[b]),null!=a&&(this.currentMask=a,this.currentMask.state=s),super.state=d}extractInput(e,i,a){return this.currentMask?this.currentMask.extractInput(e,i,a):""}extractTail(e,i){return this.currentMask?this.currentMask.extractTail(e,i):super.extractTail(e,i)}doCommit(){this.currentMask&&this.currentMask.doCommit(),super.doCommit()}nearestInputPos(e,i){return this.currentMask?this.currentMask.nearestInputPos(e,i):super.nearestInputPos(e,i)}get overwrite(){return this.currentMask?this.currentMask.overwrite:this._overwrite}set overwrite(e){this._overwrite=e}get eager(){return this.currentMask?this.currentMask.eager:this._eager}set eager(e){this._eager=e}get skipInvalid(){return this.currentMask?this.currentMask.skipInvalid:this._skipInvalid}set skipInvalid(e){this._skipInvalid=e}maskEquals(e){return Array.isArray(e)?this.compiledMasks.every((i,a)=>{if(!e[a])return;const{mask:s,...d}=e[a];return F(i,d)&&i.maskEquals(s)}):super.maskEquals(e)}typedValueEquals(e){var i;return!(null==(i=this.currentMask)||!i.typedValueEquals(e))}}w.DEFAULTS=void 0,w.DEFAULTS={dispatch:(m,e,i,a)=>{if(!e.compiledMasks.length)return;const s=e.rawInputValue,d=e.compiledMasks.map((h,b)=>{const x=e.currentMask===h,k=x?h.value.length:h.nearestInputPos(h.value.length,p_FORCE_LEFT);return h.rawInputValue!==s?(h.reset(),h.append(s,{raw:!0})):x||h.remove(k),h.append(m,e.currentMaskFlags(i)),h.appendTail(a),{index:b,weight:h.rawInputValue.length,totalInputPositions:h.totalInputPositions(0,Math.max(k,h.nearestInputPos(h.value.length,p_FORCE_LEFT)))}});return d.sort((h,b)=>b.weight-h.weight||b.totalInputPositions-h.totalInputPositions),e.compiledMasks[d[0].index]}},P.MaskedDynamic=w;P.MaskedEnum=class Z extends Q{updateOptions(e){super.updateOptions(e)}_update(e){const{enum:i,...a}=e;i&&(a.mask="*".repeat(i[0].length),this.enum=i),super._update(a)}doValidate(e){return this.enum.some(i=>i.indexOf(this.unmaskedValue)>=0)&&super.doValidate(e)}};P.MaskedFunction=class it extends I{updateOptions(e){super.updateOptions(e)}_update(e){super._update({...e,validate:e.mask})}};class J extends I{constructor(e){super({...J.DEFAULTS,...e})}updateOptions(e){super.updateOptions(e)}_update(e){super._update(e),this._updateRegExps()}_updateRegExps(){const e="^"+(this.allowNegative?"[+|\\-]?":""),a=(this.scale?"("+W(this.radix)+"\\d{0,"+this.scale+"})?":"")+"$";this._numberRegExp=new RegExp(e+"\\d*"+a),this._mapToRadixRegExp=new RegExp("["+this.mapToRadix.map(W).join("")+"]","g"),this._thousandsSeparatorRegExp=new RegExp(W(this.thousandsSeparator),"g")}_removeThousandsSeparators(e){return e.replace(this._thousandsSeparatorRegExp,"")}_insertThousandsSeparators(e){const i=e.split(this.radix);return i[0]=i[0].replace(/\B(?=(\d{3})+(?!\d))/g,this.thousandsSeparator),i.join(this.radix)}doPrepareChar(e,i){void 0===i&&(i={}),e=this._removeThousandsSeparators(this.scale&&this.mapToRadix.length&&(i.input&&i.raw||!i.input&&!i.raw)?e.replace(this._mapToRadixRegExp,this.radix):e);const[a,s]=super.doPrepareChar(e,i);return e&&!a&&(s.skip=!0),a&&!this.allowPositive&&!this.value&&"-"!==a&&s.aggregate(this._appendChar("-")),[a,s]}_separatorsCount(e,i){void 0===i&&(i=!1);let a=0;for(let s=0;s<e;++s)this._value.indexOf(this.thousandsSeparator,s)===s&&(++a,i&&(e+=this.thousandsSeparator.length));return a}_separatorsCountFromSlice(e){return void 0===e&&(e=this._value),this._separatorsCount(this._removeThousandsSeparators(e).length,!0)}extractInput(e,i,a){return void 0===e&&(e=0),void 0===i&&(i=this.value.length),[e,i]=this._adjustRangeWithSeparators(e,i),this._removeThousandsSeparators(super.extractInput(e,i,a))}_appendCharRaw(e,i){if(void 0===i&&(i={}),!this.thousandsSeparator)return super._appendCharRaw(e,i);const a=i.tail&&i._beforeTailState?i._beforeTailState._value:this._value,s=this._separatorsCountFromSlice(a);this._value=this._removeThousandsSeparators(this.value);const d=super._appendCharRaw(e,i);this._value=this._insertThousandsSeparators(this._value);const h=i.tail&&i._beforeTailState?i._beforeTailState._value:this._value,b=this._separatorsCountFromSlice(h);return d.tailShift+=(b-s)*this.thousandsSeparator.length,d.skip=!d.rawInserted&&e===this.thousandsSeparator,d}_findSeparatorAround(e){if(this.thousandsSeparator){const i=e-this.thousandsSeparator.length+1,a=this.value.indexOf(this.thousandsSeparator,i);if(a<=e)return a}return-1}_adjustRangeWithSeparators(e,i){const a=this._findSeparatorAround(e);a>=0&&(e=a);const s=this._findSeparatorAround(i);return s>=0&&(i=s+this.thousandsSeparator.length),[e,i]}remove(e,i){void 0===e&&(e=0),void 0===i&&(i=this.value.length),[e,i]=this._adjustRangeWithSeparators(e,i);const a=this.value.slice(0,e),s=this.value.slice(i),d=this._separatorsCount(a.length);this._value=this._insertThousandsSeparators(this._removeThousandsSeparators(a+s));const h=this._separatorsCountFromSlice(a);return new C({tailShift:(h-d)*this.thousandsSeparator.length})}nearestInputPos(e,i){if(!this.thousandsSeparator)return e;switch(i){case p_NONE:case p_LEFT:case p_FORCE_LEFT:{const a=this._findSeparatorAround(e-1);if(a>=0){const s=a+this.thousandsSeparator.length;if(e<s||this.value.length<=s||i===p_FORCE_LEFT)return a}break}case p_RIGHT:case p_FORCE_RIGHT:{const a=this._findSeparatorAround(e);if(a>=0)return a+this.thousandsSeparator.length}}return e}doValidate(e){let i=!!this._removeThousandsSeparators(this.value).match(this._numberRegExp);if(i){const a=this.number;i=i&&!isNaN(a)&&(null==this.min||this.min>=0||this.min<=this.number)&&(null==this.max||this.max<=0||this.number<=this.max)}return i&&super.doValidate(e)}doCommit(){if(this.value){const e=this.number;let i=e;null!=this.min&&(i=Math.max(i,this.min)),null!=this.max&&(i=Math.min(i,this.max)),i!==e&&(this.unmaskedValue=this.format(i,this));let a=this.value;this.normalizeZeros&&(a=this._normalizeZeros(a)),this.padFractionalZeros&&this.scale>0&&(a=this._padFractionalZeros(a)),this._value=a}super.doCommit()}_normalizeZeros(e){const i=this._removeThousandsSeparators(e).split(this.radix);return i[0]=i[0].replace(/^(\D*)(0*)(\d*)/,(a,s,d,h)=>s+h),e.length&&!/\d$/.test(i[0])&&(i[0]=i[0]+"0"),i.length>1&&(i[1]=i[1].replace(/0*$/,""),i[1].length||(i.length=1)),this._insertThousandsSeparators(i.join(this.radix))}_padFractionalZeros(e){if(!e)return e;const i=e.split(this.radix);return i.length<2&&i.push(""),i[1]=i[1].padEnd(this.scale,"0"),i.join(this.radix)}doSkipInvalid(e,i,a){void 0===i&&(i={});const s=0===this.scale&&e!==this.thousandsSeparator&&(e===this.radix||e===J.UNMASKED_RADIX||this.mapToRadix.includes(e));return super.doSkipInvalid(e,i,a)&&!s}get unmaskedValue(){return this._removeThousandsSeparators(this._normalizeZeros(this.value)).replace(this.radix,J.UNMASKED_RADIX)}set unmaskedValue(e){super.unmaskedValue=e}get typedValue(){return this.parse(this.unmaskedValue,this)}set typedValue(e){this.rawInputValue=this.format(e,this).replace(J.UNMASKED_RADIX,this.radix)}get number(){return this.typedValue}set number(e){this.typedValue=e}get allowNegative(){return null!=this.min&&this.min<0||null!=this.max&&this.max<0}get allowPositive(){return null!=this.min&&this.min>0||null!=this.max&&this.max>0}typedValueEquals(e){return(super.typedValueEquals(e)||J.EMPTY_VALUES.includes(e)&&J.EMPTY_VALUES.includes(this.typedValue))&&!(0===e&&""===this.value)}}J.UNMASKED_RADIX=".",J.EMPTY_VALUES=[...I.EMPTY_VALUES,0],J.DEFAULTS={mask:Number,radix:",",thousandsSeparator:"",mapToRadix:[J.UNMASKED_RADIX],min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,scale:2,normalizeZeros:!0,padFractionalZeros:!1,parse:Number,format:m=>m.toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:20})},P.MaskedNumber=J;const at={MASKED:"value",UNMASKED:"unmaskedValue",TYPED:"typedValue"};function ht(m,e,i){void 0===e&&(e=at.MASKED),void 0===i&&(i=at.MASKED);const a=B(m);return s=>a.runIsolated(d=>(d[e]=s,d[i]))}P.PIPE_TYPE=at,P.createPipe=ht,P.pipe=function lt(m,e,i,a){return ht(e,i,a)(m)};try{globalThis.IMask=P}catch{}var H=v(6676),X=v(2374),D=v(9862),nt=v(6814),dt=v(5893),G=v(9515);const ct=function(m){return{flipped:m}};class E{constructor(e){this.http=e,this.creditCardTypeDetected=new t.vpe,this.flipped=!1,this.year=(H().year()+1).toString().slice(2),this.ccImage="",this.color="grey",this.name="Mario Rossi",this.number="0123 4567 8910 1112",this.expiration="01/"+this.year,this.securityCode="985"}ngOnInit(){this.http.get("/assets/images/booking/credit-card/american-express.svg",{responseType:"text"}).subscribe({next:e=>{this.americanExpress=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/visa.svg",{responseType:"text"}).subscribe({next:e=>{this.visa=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/diners.svg",{responseType:"text"}).subscribe({next:e=>{this.diners=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/discover.svg",{responseType:"text"}).subscribe({next:e=>{this.discover=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/jcb.svg",{responseType:"text"}).subscribe({next:e=>{this.jcb=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/maestro.svg",{responseType:"text"}).subscribe({next:e=>{this.maestro=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/mastercard.svg",{responseType:"text"}).subscribe({next:e=>{this.mastercard=e},error:()=>{}}),this.http.get("/assets/images/booking/credit-card/unionpay.svg",{responseType:"text"}).subscribe({next:e=>{this.unionpay=e},error:()=>{}})}ngAfterViewInit(){let e=P(this.cardNumberInput,{mask:[{mask:"0000 000000 00000",regex:"^3[47]\\d{0,13}",cardtype:"american express"},{mask:"0000 0000 0000 0000",regex:"^(?:6011|65\\d{0,2}|64[4-9]\\d?)\\d{0,12}",cardtype:"discover"},{mask:"0000 000000 0000",regex:"^3(?:0([0-5]|9)|[689]\\d?)\\d{0,11}",cardtype:"diners"},{mask:"0000 0000 0000 0000",regex:"^(5[1-5]\\d{0,2}|22[2-9]\\d{0,1}|2[3-7]\\d{0,2})\\d{0,12}",cardtype:"mastercard"},{mask:"0000 000000 00000",regex:"^(?:2131|1800)\\d{0,11}",cardtype:"jcb15"},{mask:"0000 0000 0000 0000",regex:"^(?:35\\d{0,2})\\d{0,12}",cardtype:"jcb"},{mask:"0000 0000 0000 0000",regex:"^(?:5[0678]\\d{0,2}|6304|67\\d{0,2})\\d{0,12}",cardtype:"maestro"},{mask:"0000 0000 0000 0000",regex:"^4\\d{0,15}",cardtype:"visa"},{mask:"0000 0000 0000 0000",regex:"^62\\d{0,14}",cardtype:"unionpay"},{mask:"0000 0000 0000 0000",cardtype:"Unknown"}],dispatch:(s,d,h)=>{let b=(d.value+s).replace(/\D/g,"");for(let x of d.compiledMasks){let k=new RegExp(x.regex);if(null!=b.match(k))return x}}}),i=P(this.expirationDateInput,{mask:"MM{/}YY",blocks:{YY:{mask:P.MaskedRange,placeholderChar:"YY",from:0,to:99,maxLength:2},MM:{mask:P.MaskedRange,placeholderChar:"MM",from:1,to:12,maxLength:2}}}),a=P(this.securityCodeInput,{mask:"0000"});e.on("accept",()=>{switch(e.masked.currentMask.cardtype){case"american express":this.ccImage=this.americanExpress,this.color="green",this.creditCardTypeDetected.emit(X.Cf.AmericanExpress);break;case"visa":this.ccImage=this.visa,this.color="lime",this.creditCardTypeDetected.emit(X.Cf.Visa);break;case"diners":this.ccImage=this.diners,this.color="orange",this.creditCardTypeDetected.emit(X.Cf.DinersClub);break;case"discover":this.ccImage=this.discover,this.color="purple",this.creditCardTypeDetected.emit(X.Cf.DiscoveryCard);break;case"jcb":case"jcb15":this.ccImage=this.jcb,this.color="red",this.creditCardTypeDetected.emit(X.Cf.JCB);break;case"maestro":this.ccImage=this.maestro,this.color="yellow",this.creditCardTypeDetected.emit(X.Cf.Maestro);break;case"mastercard":this.ccImage=this.mastercard,this.color="lightblue",this.creditCardTypeDetected.emit(X.Cf.MasterCard);break;case"unionpay":this.ccImage=this.unionpay,this.color="cyan",this.creditCardTypeDetected.emit(X.Cf.ChinaUnionPay);break;default:this.ccImage="",this.color="grey",this.creditCardTypeDetected.emit(null)}}),this.nameInput.addEventListener("input",()=>{this.nameInput.value?this.name=this.nameInput.value:this.name="Mario Rossi"}),e.on("accept",()=>{e.value?this.number=e.value:this.number="0123 4567 8910 1112"}),i.on("accept",()=>{i.value?this.expiration=i.value:this.expiration="01/"+this.year}),a.on("accept",()=>{a.value?this.securityCode=a.value:this.securityCode="985"}),this.nameInput.addEventListener("focus",()=>{this.flipped=!1}),this.cardNumberInput.addEventListener("focus",()=>{this.flipped=!1}),this.expirationDateInput.addEventListener("focus",()=>{this.flipped=!1}),this.securityCodeInput.addEventListener("focus",()=>{this.flipped=!0})}}E.\u0275fac=function(e){return new(e||E)(t.Y36(D.eN))},E.\u0275cmp=t.Xpm({type:E,selectors:[["app-credit-card"]],inputs:{nameInput:"nameInput",cardNumberInput:"cardNumberInput",expirationDateInput:"expirationDateInput",securityCodeInput:"securityCodeInput"},outputs:{creditCardTypeDetected:"creditCardTypeDetected"},decls:76,vars:31,consts:[[1,"creditcard",3,"ngClass","click"],[1,"front"],["front",""],["id","ccsingle",3,"innerHtml"],["version","1.1","id","cardfront","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","viewBox","0 0 750 471",0,"xml","space","preserve",2,"enable-background","new 0 0 750 471"],["id","Front"],["id","CardBackground"],["id","Page-1_1_"],["id","amex_1_"],["id","Rectangle-1_1_","d","M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40\n                    C0,17.9,17.9,0,40,0z"],["d","M750,431V193.2c-217.6-57.5-556.4-13.5-750,24.9V431c0,22.1,17.9,40,40,40h670C732.1,471,750,453.1,750,431z"],["transform","matrix(1 0 0 1 60.106 295.0121)",1,"st2","st3","st4"],["transform","matrix(1 0 0 1 54.1064 428.1723)",1,"st2","st5","st6"],["transform","matrix(1 0 0 1 54.1074 389.8793)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 479.7754 388.8793)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 65.1054 241.5)",1,"st7","st5","st8"],["transform","matrix(1 0 0 1 574.4219 433.8095)",1,"st2","st5","st9"],["transform","matrix(1 0 0 1 479.3848 417.0097)",1,"st2","st10","st11"],["transform","matrix(1 0 0 1 479.3848 435.6762)",1,"st2","st10","st11"],["points","554.5,421 540.4,414.2 540.4,427.9",1,"st2"],["id","cchip"],["d","M168.1,143.6H82.9c-10.2,0-18.5-8.3-18.5-18.5V74.9c0-10.2,8.3-18.5,18.5-18.5h85.3\n                c10.2,0,18.5,8.3,18.5,18.5v50.2C186.6,135.3,178.3,143.6,168.1,143.6z",1,"st2"],["x","82","y","70","width","1.5","height","60",1,"st12"],["x","167.4","y","70","width","1.5","height","60",1,"st12"],["d","M125.5,130.8c-10.2,0-18.5-8.3-18.5-18.5c0-4.6,1.7-8.9,4.7-12.3c-3-3.4-4.7-7.7-4.7-12.3\n                    c0-10.2,8.3-18.5,18.5-18.5s18.5,8.3,18.5,18.5c0,4.6-1.7,8.9-4.7,12.3c3,3.4,4.7,7.7,4.7,12.3\n                    C143.9,122.5,135.7,130.8,125.5,130.8z M125.5,70.8c-9.3,0-16.9,7.6-16.9,16.9c0,4.4,1.7,8.6,4.8,11.8l0.5,0.5l-0.5,0.5\n                    c-3.1,3.2-4.8,7.4-4.8,11.8c0,9.3,7.6,16.9,16.9,16.9s16.9-7.6,16.9-16.9c0-4.4-1.7-8.6-4.8-11.8l-0.5-0.5l0.5-0.5\n                    c3.1-3.2,4.8-7.4,4.8-11.8C142.4,78.4,134.8,70.8,125.5,70.8z",1,"st12"],["x","82.8","y","82.1","width","25.8","height","1.5",1,"st12"],["x","82.8","y","117.9","width","26.1","height","1.5",1,"st12"],["x","142.4","y","82.1","width","25.8","height","1.5",1,"st12"],["x","142","y","117.9","width","26.2","height","1.5",1,"st12"],["id","Back"],[1,"back"],["version","1.1","id","cardback","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","x","0px","y","0px","viewBox","0 0 750 471",0,"xml","space","preserve",2,"enable-background","new 0 0 750 471"],["x1","35.3","y1","10.4","x2","36.7","y2","11",1,"st0"],["id","Page-1_2_"],["id","amex_2_"],["id","Rectangle-1_2_","d","M40,0h670c22.1,0,40,17.9,40,40v391c0,22.1-17.9,40-40,40H40c-22.1,0-40-17.9-40-40V40\n                C0,17.9,17.9,0,40,0z"],["y","61.6","width","750","height","78",1,"st2"],["d","M701.1,249.1H48.9c-3.3,0-6-2.7-6-6v-52.5c0-3.3,2.7-6,6-6h652.1c3.3,0,6,2.7,6,6v52.5\n            C707.1,246.4,704.4,249.1,701.1,249.1z",1,"st3"],["x","42.9","y","198.6","width","664.1","height","10.5",1,"st4"],["x","42.9","y","224.5","width","664.1","height","10.5",1,"st4"],["d","M701.1,184.6H618h-8h-10v64.5h10h8h83.1c3.3,0,6-2.7,6-6v-52.5C707.1,187.3,704.4,184.6,701.1,184.6z",1,"st5"],["transform","matrix(1 0 0 1 621.999 227.2734)",1,"st6","st7"],[1,"st8"],["transform","matrix(1 0 0 1 518.083 280.0879)",1,"st9","st6","st10"],["x","58.1","y","378.6","width","375.5","height","13.5",1,"st11"],["x","58.1","y","405.6","width","421.7","height","13.5",1,"st11"],["transform","matrix(1 0 0 1 59.5073 228.6099)",1,"st12","st13"]],template:function(e,i){if(1&e&&(t.TgZ(0,"div",0),t.NdJ("click",function(){return i.flipped=!i.flipped}),t.TgZ(1,"div",1,2),t._UZ(3,"div",3),t.ALo(4,"safeHtml"),t.O4$(),t.TgZ(5,"svg",4)(6,"g",5)(7,"g",6)(8,"g",7)(9,"g",8),t._UZ(10,"path",9),t.qZA()(),t._UZ(11,"path",10),t.qZA(),t.TgZ(12,"text",11),t._uU(13),t.qZA(),t.TgZ(14,"text",12),t._uU(15),t.qZA(),t.TgZ(16,"text",13),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"text",14),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"text",15),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"g")(26,"text",16),t._uU(27),t.qZA(),t.TgZ(28,"text",17),t._uU(29,"VALID"),t.qZA(),t.TgZ(30,"text",18),t._uU(31,"THRU"),t.qZA(),t._UZ(32,"polygon",19),t.qZA(),t.TgZ(33,"g",20)(34,"g"),t._UZ(35,"path",21),t.qZA(),t.TgZ(36,"g")(37,"g"),t._UZ(38,"rect",22),t.qZA(),t.TgZ(39,"g"),t._UZ(40,"rect",23),t.qZA(),t.TgZ(41,"g"),t._UZ(42,"path",24),t.qZA(),t.TgZ(43,"g"),t._UZ(44,"rect",25),t.qZA(),t.TgZ(45,"g"),t._UZ(46,"rect",26),t.qZA(),t.TgZ(47,"g"),t._UZ(48,"rect",27),t.qZA(),t.TgZ(49,"g"),t._UZ(50,"rect",28),t.qZA()()()(),t._UZ(51,"g",29),t.qZA()(),t.kcU(),t.TgZ(52,"div",30),t.O4$(),t.TgZ(53,"svg",31)(54,"g",5),t._UZ(55,"line",32),t.qZA(),t.TgZ(56,"g",29)(57,"g",33)(58,"g",34),t._UZ(59,"path",35),t.qZA()(),t._UZ(60,"rect",36),t.TgZ(61,"g"),t._UZ(62,"path",37)(63,"rect",38)(64,"rect",39)(65,"path",40),t.qZA(),t.TgZ(66,"text",41),t._uU(67),t.qZA(),t.TgZ(68,"g",42)(69,"text",43),t._uU(70),t.ALo(71,"translate"),t.qZA()(),t._UZ(72,"rect",44)(73,"rect",45),t.TgZ(74,"text",46),t._uU(75),t.qZA()()()()()),2&e){const a=t.MAs(2);t.Udp("height",a.offsetHeight,"px"),t.Q6J("ngClass",t.VKq(29,ct,i.flipped)),t.xp6(3),t.Q6J("innerHtml",t.lcZ(4,19,i.ccImage),t.oJD),t.xp6(7),t.Tol("lightcolor "+i.color),t.xp6(1),t.Tol("darkcolor "+i.color+"dark"),t.xp6(2),t.Oqu(i.number),t.xp6(2),t.Oqu(i.name),t.xp6(2),t.Oqu(t.lcZ(18,21,"interfaces.pagamento-form.titolare")),t.xp6(3),t.Oqu(t.lcZ(21,23,"interfaces.pagamento-form.scadenza")),t.xp6(3),t.Oqu(t.lcZ(24,25,"interfaces.pagamento-form.numero")),t.xp6(4),t.Oqu(i.expiration),t.xp6(32),t.Tol("darkcolor "+i.color+"dark"),t.xp6(8),t.Oqu(i.securityCode),t.xp6(3),t.Oqu(t.lcZ(71,27,"interfaces.pagamento-form.codiceSicurezza")),t.xp6(5),t.Oqu(i.name)}},dependencies:[nt.mk,dt.z,G.X$],styles:["#ccsingle[_ngcontent-%COMP%]{position:absolute;right:15px;top:20px}  #ccsingle svg{width:100px;max-height:60px}.creditcard[_ngcontent-%COMP%]   svg#cardfront[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   svg#cardback[_ngcontent-%COMP%]{width:100%;box-shadow:0 3px 3px -2px #0003,0 3px 4px #00000024,0 1px 8px #0000001f;border-radius:22px}.creditcard[_ngcontent-%COMP%]   .lightcolor[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   .darkcolor[_ngcontent-%COMP%]{transition:fill .5s}.creditcard[_ngcontent-%COMP%]   .lightblue[_ngcontent-%COMP%]{fill:#03a9f4}.creditcard[_ngcontent-%COMP%]   .lightbluedark[_ngcontent-%COMP%]{fill:#0288d1}.creditcard[_ngcontent-%COMP%]   .red[_ngcontent-%COMP%]{fill:#ef5350}.creditcard[_ngcontent-%COMP%]   .reddark[_ngcontent-%COMP%]{fill:#d32f2f}.creditcard[_ngcontent-%COMP%]   .purple[_ngcontent-%COMP%]{fill:#ab47bc}.creditcard[_ngcontent-%COMP%]   .purpledark[_ngcontent-%COMP%]{fill:#7b1fa2}.creditcard[_ngcontent-%COMP%]   .cyan[_ngcontent-%COMP%]{fill:#26c6da}.creditcard[_ngcontent-%COMP%]   .cyandark[_ngcontent-%COMP%]{fill:#0097a7}.creditcard[_ngcontent-%COMP%]   .green[_ngcontent-%COMP%]{fill:#66bb6a}.creditcard[_ngcontent-%COMP%]   .greendark[_ngcontent-%COMP%]{fill:#388e3c}.creditcard[_ngcontent-%COMP%]   .lime[_ngcontent-%COMP%]{fill:#d4e157}.creditcard[_ngcontent-%COMP%]   .limedark[_ngcontent-%COMP%]{fill:#afb42b}.creditcard[_ngcontent-%COMP%]   .yellow[_ngcontent-%COMP%]{fill:#ffeb3b}.creditcard[_ngcontent-%COMP%]   .yellowdark[_ngcontent-%COMP%]{fill:#f9a825}.creditcard[_ngcontent-%COMP%]   .orange[_ngcontent-%COMP%]{fill:#ff9800}.creditcard[_ngcontent-%COMP%]   .orangedark[_ngcontent-%COMP%]{fill:#ef6c00}.creditcard[_ngcontent-%COMP%]   .grey[_ngcontent-%COMP%]{fill:#bdbdbd}.creditcard[_ngcontent-%COMP%]   .greydark[_ngcontent-%COMP%]{fill:#616161}#svgname[_ngcontent-%COMP%]{text-transform:uppercase}#cardfront[_ngcontent-%COMP%]   .st2[_ngcontent-%COMP%]{fill:#fff}#cardfront[_ngcontent-%COMP%]   .st3[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:600}#cardfront[_ngcontent-%COMP%]   .st4[_ngcontent-%COMP%]{font-size:54.7817px}#cardfront[_ngcontent-%COMP%]   .st5[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:400}#cardfront[_ngcontent-%COMP%]   .st6[_ngcontent-%COMP%]{font-size:33.1112px}#cardfront[_ngcontent-%COMP%]   .st7[_ngcontent-%COMP%]{opacity:.6;fill:#fff}#cardfront[_ngcontent-%COMP%]   .st8[_ngcontent-%COMP%]{font-size:24px}#cardfront[_ngcontent-%COMP%]   .st9[_ngcontent-%COMP%]{font-size:36.5498px}#cardfront[_ngcontent-%COMP%]   .st10[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:300}#cardfront[_ngcontent-%COMP%]   .st11[_ngcontent-%COMP%]{font-size:16.1716px}#cardfront[_ngcontent-%COMP%]   .st12[_ngcontent-%COMP%]{fill:#4c4c4c}#cardback[_ngcontent-%COMP%]   .st0[_ngcontent-%COMP%]{fill:none;stroke:#0f0f0f;stroke-miterlimit:10}#cardback[_ngcontent-%COMP%]   .st2[_ngcontent-%COMP%]{fill:#111}#cardback[_ngcontent-%COMP%]   .st3[_ngcontent-%COMP%]{fill:#f2f2f2}#cardback[_ngcontent-%COMP%]   .st4[_ngcontent-%COMP%]{fill:#d8d2db}#cardback[_ngcontent-%COMP%]   .st5[_ngcontent-%COMP%]{fill:#c4c4c4}#cardback[_ngcontent-%COMP%]   .st6[_ngcontent-%COMP%]{font-family:Source Code Pro,monospace;font-weight:400}#cardback[_ngcontent-%COMP%]   .st7[_ngcontent-%COMP%]{font-size:27px}#cardback[_ngcontent-%COMP%]   .st8[_ngcontent-%COMP%]{opacity:.6}#cardback[_ngcontent-%COMP%]   .st9[_ngcontent-%COMP%]{fill:#fff}#cardback[_ngcontent-%COMP%]   .st10[_ngcontent-%COMP%]{font-size:24px}#cardback[_ngcontent-%COMP%]   .st11[_ngcontent-%COMP%]{fill:#eaeaea}#cardback[_ngcontent-%COMP%]   .st12[_ngcontent-%COMP%]{font-family:Rock Salt,cursive}#cardback[_ngcontent-%COMP%]   .st13[_ngcontent-%COMP%]{font-size:37.769px}.creditcard[_ngcontent-%COMP%]{width:100%;max-width:400px;transform-style:preserve-3d;transition:transform .6s;cursor:pointer}.creditcard[_ngcontent-%COMP%]   .front[_ngcontent-%COMP%], .creditcard[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{position:absolute;width:100%;max-width:400px;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-font-smoothing:antialiased;color:#47525d}.creditcard[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%], .creditcard.flipped[_ngcontent-%COMP%]{transform:rotateY(180deg)}"]})},2549:(Ct,$,v)=>{v.d($,{Q:()=>mt});var t=v(5879),O=v(6676),N=v(4090),f=v(6556),p=v(6107),_=v(2374),W=v(553),F=v(2353),M=v(6814),P=v(6223),L=v(2165),R=v(9515);function B(r,o){if(1&r&&(t.TgZ(0,"h4"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const n=t.oxw(4);t.xp6(1),t.Oqu(t.lcZ(2,1,n.title))}}const j=function(r){return{"mt-3":r}};function tt(r,o){if(1&r&&(t.TgZ(0,"div",4),t._UZ(1,"app-inner-html",5),t.qZA()),2&r){const n=t.oxw(5);t.Q6J("ngClass",t.VKq(2,j,!!n.title)),t.xp6(1),t.Q6J("_text",n.text)}}function st(r,o){if(1&r&&(t.TgZ(0,"div",4),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const n=t.oxw(5);t.Q6J("ngClass",t.VKq(4,j,!!n.title)),t.xp6(1),t.hij(" ",t.lcZ(2,2,n.text)," ")}}function S(r,o){if(1&r&&(t.ynx(0),t.YNc(1,tt,2,4,"div",3),t.YNc(2,st,3,6,"div",3),t.BQk()),2&r){const n=t.oxw(4);t.xp6(1),t.Q6J("ngIf",n.html),t.xp6(1),t.Q6J("ngIf",!n.html)}}function y(r,o){if(1&r&&(t.ynx(0),t.YNc(1,B,3,3,"h4",0),t.YNc(2,S,3,2,"ng-container",0),t.BQk()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("ngIf",!!n.title),t.xp6(1),t.Q6J("ngIf",!!n.text)}}const C=function(r){return{"hobex-container-hidden":r}},A=function(r,o){return{visibility:r,"z-index":o}};function I(r,o){if(1&r&&(t.TgZ(0,"div",4),t._UZ(1,"form",6)(2,"iframe",7),t.qZA()),2&r){const n=t.oxw(3);t.Q6J("ngClass",t.VKq(3,C,n.hobexPaymentSubmitted)),t.xp6(1),t.Q6J("action",n.paymentSuccessUrl,t.LSH),t.xp6(1),t.Q6J("ngStyle",t.WLB(5,A,n.hobexPaymentSubmitted?"visible":"hidden",n.hobexPaymentSubmitted?1:-1))}}function U(r,o){if(1&r&&(t.ynx(0),t.YNc(1,y,3,2,"ng-container",0),t.YNc(2,I,3,8,"div",3),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!n.hobexTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.hobexTransactionId)}}function et(r,o){1&r&&t._UZ(0,"div",8)}function yt(r,o){if(1&r&&(t.ynx(0),t.YNc(1,U,3,2,"ng-container",0),t.YNc(2,et,1,0,"div",2),t.BQk()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",!n.sumupTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.sumupTransactionId)}}function gt(r,o){1&r&&t._UZ(0,"div",9)}class rt extends N.H{constructor(o){super(),this.utility=o,this.HOBEX_JS_URL="https://oppwa.com/v1/paymentWidgets.js?checkoutId=",this.HOBEX_JS_URL_TEST="https://test.oppwa.com/v1/paymentWidgets.js?checkoutId=",this.AXEPTA_URL="https://pay.axepta.it",this.AXEPTA_URL_TEST="https://pay-sandbox.axepta.it",this.hobexPaymentSubmitted=!1}ngAfterViewInit(){if(this.sumupTransactionId)SumUpCard.mount({checkoutId:this.sumupTransactionId,locale:"it"==this.lingua?"it-IT":"en-GB",onResponse:(o,n)=>{switch(o){case"sent":this.setIsLoading(!0);break;case"invalid":break;case"auth-screen":this.setIsLoading(!1);break;case"error":this.setIsLoading(!1),this.dialogRef.close();break;case"success":this.dialogRef.close(!0)}}});else if(this.hobexTransactionId){if(void 0!==window.wpwl&&void 0!==window.wpwl.unload&&window.wpwl.unload(),void 0!==window.wpwlOptions)window.wpwlOptions.locale=this.lingua;else{let o=this;window.wpwlOptions={locale:this.lingua,paymentTarget:"hobexIFrame",shopperResultTarget:"hobexIFrame",labels:{cvv:"CVV"},onAfterSubmit:function(){o.hobexPaymentSubmitted=!0}}}this.utility.loadExternalScript((this.isTest?this.HOBEX_JS_URL_TEST:this.HOBEX_JS_URL)+this.hobexTransactionId,null,"hobex-script").then(()=>{this.setIsLoading(!1)})}else this.axeptaTransactionId&&new AxeptaSDKClient(this.isTest?this.AXEPTA_URL_TEST:this.AXEPTA_URL,this.axeptaApiKeySmartCheckout).preparePayment(this.axeptaTransactionId)}}rt.\u0275fac=function(o){return new(o||rt)(t.Y36(F.t))},rt.\u0275cmp=t.Xpm({type:rt,selectors:[["app-pagamento-form-dialog"]],inputs:{html:"html",title:"title",text:"text",sumupTransactionId:"sumupTransactionId",hobexTransactionId:"hobexTransactionId",axeptaTransactionId:"axeptaTransactionId",paymentSuccessUrl:"paymentSuccessUrl",axeptaApiKeySmartCheckout:"axeptaApiKeySmartCheckout",isTest:"isTest",lingua:"lingua",dialogRef:"dialogRef"},features:[t.qOj],decls:2,vars:2,consts:[[4,"ngIf"],["id","my-axepta-sdk-pg",4,"ngIf"],["id","sumup-card",4,"ngIf"],[3,"ngClass",4,"ngIf"],[3,"ngClass"],[3,"_text"],["data-brands","VISA MASTER",1,"paymentWidgets",3,"action"],["name","hobexIFrame","width","100%","height","100%","frameborder","0",1,"hobexIFrame",3,"ngStyle"],["id","sumup-card"],["id","my-axepta-sdk-pg"]],template:function(o,n){1&o&&(t.YNc(0,yt,3,2,"ng-container",0),t.YNc(1,gt,1,0,"div",1)),2&o&&(t.Q6J("ngIf",!n.axeptaTransactionId),t.xp6(1),t.Q6J("ngIf",!!n.axeptaTransactionId))},dependencies:[M.mk,M.O5,M.PC,P._Y,P.JL,P.F,L.W,R.X$],styles:[".wpwl-form{margin:0!important;border-radius:0!important}.hobexIFrame[_ngcontent-%COMP%]{position:absolute;top:0;left:0}  .hobex-container-hidden .wpwl-container{visibility:hidden!important}  #axepta-sdk-main-container{margin:0!important;padding:1rem!important}"]});var Q=v(4505),g=v(5477);class T{constructor(){}onOpenWindowClick(){this.dialogRef.close(window.open(this.paymentUrl))}}T.\u0275fac=function(o){return new(o||T)},T.\u0275cmp=t.Xpm({type:T,selectors:[["app-payment-window-error"]],inputs:{paymentUrl:"paymentUrl",dialogRef:"dialogRef"},decls:10,vars:7,consts:[["mat-icon-button","",1,"modal-close-button",3,"matDialogClose","disableRipple"],[1,"material-icons-round"],[1,"font-weight-bold"],[1,"mt-3","text-center"],["mat-flat-button","",1,"button-blue",3,"click"]],template:function(o,n){1&o&&(t.TgZ(0,"button",0)(1,"i",1),t._uU(2,"clear"),t.qZA()(),t.TgZ(3,"div",2),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return n.onOpenWindowClick()}),t._uU(8),t.ALo(9,"translate"),t.qZA()()),2&o&&(t.Q6J("disableRipple",!0),t.xp6(4),t.hij(" ",t.lcZ(5,3,"interfaces.pagamento-form.pagamentoBloccato"),"\n"),t.xp6(4),t.Oqu(t.lcZ(9,5,"interfaces.pagamento-form.apriFinestraPagamento")))},dependencies:[Q.eB,g.aO,R.X$]});var w=v(9209),Z=v(3724),it=v(4731),J=v(724),at=v(5754),ht=v(5986),lt=v(4187),H=v(2400),X=v(4678),D=v(8424),nt=v(7958),dt=v(7679),G=v(61),ct=v(1477),E=v(5742);function m(r,o){if(1&r&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&r){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n.nome," ")}}function e(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"app-inner-html",22),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("_text",n.model.modalitaPagamento.note)}}function i(r,o){if(1&r&&(t.TgZ(0,"div",21)(1,"span",23),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",24),t._uU(5),t.ALo(6,"eurCurrency"),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"interfaces.pagamento-form.caparra")," "),t.xp6(3),t.hij(" ",t.Dn7(6,4,n.model.modalitaPagamento.caparraTotale,null,n.valuta)," ")}}function a(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"holipay-checkout-widget"),t.ALo(2,"replace"),t.ALo(3,"number"),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.uIk("checkin",n.getDate(n.arrivo))("checkout",n.getDate(n.partenza))("price",t.Dn7(2,4,t.xi3(3,8,n.getImportoPagamento(),"1.2-2"),",",""))("locale",n.lingua)}}function s(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"scalapay-widget",25),t.qZA()),2&r){const n=t.oxw(2);t.xp6(1),t.uIk("amount",n.getImportoPagamento())("min",0)("max",999999)("locale",n.lingua)}}function d(r,o){if(1&r&&(t.ynx(0),t.YNc(1,e,2,1,"div",20),t.YNc(2,i,7,8,"div",20),t.YNc(3,a,4,11,"div",20),t.YNc(4,s,2,4,"div",20),t.BQk()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.note),t.xp6(1),t.Q6J("ngIf",n.showCaparra&&n.model.modalitaPagamento.caparraTotale>0),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.Holipay),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.ScalaPay)}}function h(r,o){if(1&r&&(t.TgZ(0,"div",21),t._UZ(1,"app-inner-html",22),t.qZA()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("_text",n.model.modalitaPagamento.note)}}function b(r,o){if(1&r&&(t.TgZ(0,"div",21)(1,"span",23),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",24),t._uU(5),t.ALo(6,"eurCurrency"),t.qZA()()),2&r){const n=t.oxw(3);t.xp6(2),t.hij(" ",t.lcZ(3,2,"interfaces.pagamento-form.caparra")," "),t.xp6(3),t.hij(" ",t.Dn7(6,4,n.model.modalitaPagamento.caparraTotale,null,n.valuta)," ")}}function x(r,o){if(1&r&&t._UZ(0,"img",40),2&r){const n=o.$implicit;t.Q6J("src",n,t.LSH)}}function k(r,o){if(1&r&&(t.TgZ(0,"div",38),t.YNc(1,x,1,1,"img",39),t.qZA()),2&r){const n=t.oxw(3);t.xp6(1),t.Q6J("ngForOf",n.immaginiCarteCredito)}}function V(r,o){if(1&r&&(t.ynx(0),t.YNc(1,h,2,1,"div",20),t.YNc(2,b,7,8,"div",20),t.YNc(3,k,2,1,"div",37),t.BQk()),2&r){const n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.note),t.xp6(1),t.Q6J("ngIf",n.showCaparra&&n.model.modalitaPagamento.caparraTotale>0),t.xp6(1),t.Q6J("ngIf",null!=n.immaginiCarteCredito&&n.immaginiCarteCredito.length>0)}}function K(r,o){if(1&r&&(t.TgZ(0,"mat-option",19),t._uU(1),t.qZA()),2&r){const n=o.$implicit;t.Q6J("value",n),t.xp6(1),t.hij(" ",n.nome," ")}}function ot(r,o){if(1&r&&(t.TgZ(0,"div",41)(1,"div",42),t._uU(2),t.ALo(3,"translate"),t.TgZ(4,"div",43),t._UZ(5,"img",44)(6,"img",45),t.qZA()(),t.TgZ(7,"div",46),t._UZ(8,"app-credit-card",47),t.qZA()()),2&r){t.oxw();const n=t.MAs(28),c=t.MAs(13),l=t.MAs(24),u=t.MAs(19);t.xp6(2),t.hij(" ",t.lcZ(3,5,"interfaces.pagamento-form.crittografiaCarte")," "),t.xp6(6),t.Q6J("nameInput",n)("cardNumberInput",c)("expirationDateInput",l)("securityCodeInput",u)}}const Tt=function(r,o){return{"col-12 col-md-8":r,"col-12":o}};function Rt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"div",26)(2,"div",27),t.YNc(3,V,4,3,"ng-container",7),t.TgZ(4,"div",26)(5,"div",28)(6,"mat-form-field",29)(7,"mat-select",30),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.tipoCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(8,"translate"),t.YNc(9,K,2,2,"mat-option",6),t.qZA()()(),t.TgZ(10,"div",28)(11,"mat-form-field",29)(12,"input",31,32),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.numeroCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(14,"translate"),t.qZA()()()(),t.TgZ(15,"div",26)(16,"div",28)(17,"mat-form-field",29)(18,"input",31,33),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.codiceSicurezza=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(20,"translate"),t.qZA()()(),t.TgZ(21,"div",28)(22,"mat-form-field",29)(23,"input",31,34),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.dataScadenza=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return l.splitDataScadenza(),t.KtG(l.verifyValidity())}),t.ALo(25,"translate"),t.qZA()()()(),t.TgZ(26,"mat-form-field",29)(27,"input",31,35),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.titolareCarta=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())}),t.ALo(29,"translate"),t.qZA()()(),t.YNc(30,ot,9,7,"div",36),t.qZA()()}if(2&r){const n=t.oxw();t.xp6(2),t.Q6J("ngClass",t.WLB(34,Tt,!n.disabled,n.disabled)),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(4),t.Q6J("panelClass","booking-select-unlimited-height")("ngModel",n.model.tipoCarta)("placeholder",t.lcZ(8,24,"interfaces.pagamento-form.tipoCarta"))("disabled",n.disabled),t.xp6(2),t.Q6J("ngForOf",n.carteCredito),t.xp6(3),t.Q6J("ngModel",n.model.numeroCarta)("placeholder",t.lcZ(14,26,"interfaces.pagamento-form.numero"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(6),t.Q6J("ngModel",n.model.codiceSicurezza)("placeholder",t.lcZ(20,28,"interfaces.pagamento-form.codiceSicurezza"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(5),t.Q6J("ngModel",n.dataScadenza)("placeholder",t.lcZ(25,30,"interfaces.pagamento-form.scadenza"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(4),t.Q6J("ngModel",n.model.titolareCarta)("placeholder",t.lcZ(29,32,"interfaces.pagamento-form.titolare"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(3),t.Q6J("ngIf",!n.disabled)}}function wt(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.banca")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.banca)}}function Et(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.intestatario")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.intestatarioConto)}}function Y(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.iban")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.iban)}}function vt(r,o){if(1&r&&(t.TgZ(0,"div",28)(1,"span",51),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"span",52),t._uU(5),t.qZA()()),2&r){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"interfaces.pagamento-form.swift")),t.xp6(3),t.Oqu(n.model.modalitaPagamento.swift)}}function Pt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",56)(1,"a",57),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(3);return l.preventDefault(),t.KtG(u.openCroDialog())}),t._uU(2),t.ALo(3,"translate"),t.qZA()()}2&r&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"interfaces.pagamento-form.cosaSignifica")))}function Mt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",26)(1,"div",53)(2,"mat-form-field",29)(3,"input",54),t.NdJ("ngModelChange",function(l){t.CHM(n);const u=t.oxw(2);return t.KtG(u.model.codiceRiferimentoOperazione=l)})("ngModelChange",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.verifyValidity())}),t.ALo(4,"translate"),t.qZA()()(),t.YNc(5,Pt,4,3,"div",55),t.qZA()}if(2&r){const n=t.oxw(2);t.xp6(3),t.Q6J("ngModel",n.model.codiceRiferimentoOperazione)("placeholder",t.lcZ(4,5,"interfaces.pagamento-form.codiceRiferimentoOperazione"))("readOnly",n.disabled)("disabled",n.disabled),t.xp6(2),t.Q6J("ngIf",!n.disabled)}}const It=function(r){return{"mb-3":r}};function Lt(r,o){if(1&r&&(t.TgZ(0,"div")(1,"div",48),t.YNc(2,wt,6,4,"div",49),t.YNc(3,Et,6,4,"div",49),t.YNc(4,Y,6,4,"div",49),t.YNc(5,vt,6,4,"div",49),t.qZA(),t.YNc(6,Mt,6,7,"div",50),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngClass",t.VKq(6,It,!n.isVisualizzaCRO)),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.banca),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.intestatarioConto),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.iban),t.xp6(1),t.Q6J("ngIf",!!n.model.modalitaPagamento.swift),t.xp6(1),t.Q6J("ngIf",!n.disabled&&n.isVisualizzaCRO)}}function z(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"mat-checkbox",58),t.NdJ("change",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.privacy=l)}),t.TgZ(2,"a",59),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw();return l.preventDefault(),t.KtG(u.openPrivacyDialog())}),t._uU(3),t.ALo(4,"translate"),t.qZA()()()}if(2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngModel",n.model.privacy)("disabled",n.disabled),t.xp6(2),t.Oqu(t.lcZ(4,3,"interfaces.pagamento-form.privacy"))}}function kt(r,o){1&r&&(t.TgZ(0,"span",63),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.accettoLeCondizioniDiContratto")))}function Bt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"a",64),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(3);return l.preventDefault(),t.KtG(u.openCondizioniContrattoDialog())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.accettoLeCondizioniDiContratto")))}function Ut(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"mat-checkbox",58),t.NdJ("change",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw(2);return t.KtG(u.contrattoAccettatto=l)}),t.YNc(1,kt,3,3,"span",61),t.YNc(2,Bt,3,3,"a",62),t.qZA()}if(2&r){const n=t.oxw(2);t.Q6J("ngModel",n.contrattoAccettatto)("disabled",n.disabled),t.xp6(1),t.Q6J("ngIf",!n.condizioniContratto),t.xp6(1),t.Q6J("ngIf",!!n.condizioniContratto)}}function St(r,o){if(1&r&&(t.TgZ(0,"div"),t.YNc(1,Ut,3,4,"mat-checkbox",60),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.isAccettaContrattoPrenotazioneStep2)}}function Ot(r,o){1&r&&(t.TgZ(0,"span",63),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.trattamentoDatiPersonali")))}function bt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"a",67),t.NdJ("click",function(l){t.CHM(n);const u=t.oxw(2);return l.preventDefault(),t.KtG(u.openNewsletterDialog())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"interfaces.pagamento-form.trattamentoDatiPersonali")))}function pt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div")(1,"mat-checkbox",65),t.NdJ("change",function(){t.CHM(n);const l=t.oxw();return t.KtG(l.verifyValidity())})("ngModelChange",function(l){t.CHM(n);const u=t.oxw();return t.KtG(u.model.newsletter=l)}),t.YNc(2,Ot,3,3,"span",61),t.YNc(3,bt,3,3,"a",66),t.qZA()()}if(2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngModel",n.model.newsletter)("disabled",n.disabled),t.xp6(1),t.Q6J("ngIf",null==n.newsLetterPortale||!n.newsLetterPortale.html&&!n.newsLetterPortale.url),t.xp6(1),t.Q6J("ngIf",!(null==n.newsLetterPortale||!n.newsLetterPortale.html&&!n.newsLetterPortale.url))}}function Ft(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"div",68)(1,"re-captcha",69),t.NdJ("resolved",function(){t.CHM(n);const l=t.oxw();return l.recaptchaResolved=!0,t.KtG(l.verifyValidity())}),t.qZA()()}2&r&&(t.xp6(1),t.Q6J("siteKey","6LcsQ90ZAAAAAD6motJOcWzKpaG4R33OtsR7jVn1"))}const At=function(r){return{"w-100":r}};function xt(r,o){if(1&r){const n=t.EpF();t.TgZ(0,"button",72),t.NdJ("click",function(){t.CHM(n);const l=t.oxw(2);return t.KtG(l.pay())}),t.TgZ(1,"span",73),t._uU(2,"check"),t.qZA(),t.TgZ(3,"span",52),t._uU(4),t.ALo(5,"translate"),t.qZA()()}if(2&r){const n=t.oxw(2);t.Q6J("ngClass",t.VKq(5,At,n.fullWidthButton))("disabled",!n.paymentFormValid||!n.formValid),t.xp6(4),t.Oqu(n.model.modalitaPagamento.testoBottonePaga?n.model.modalitaPagamento.testoBottonePaga:t.lcZ(5,3,"interfaces.pagamento-form.paga"))}}function Dt(r,o){if(1&r&&(t.TgZ(0,"div",70),t.YNc(1,xt,6,7,"button",71),t.qZA()),2&r){const n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.PayPal)}}const ut=function(r){return{"mat-elevation-z5":r}};class mt extends N.H{set _totale(o){this.totale=o,this.calculateCaparra()}set _isAccettaContrattoPrenotazioneStep2(o){null!=o&&(this.isAccettaContrattoPrenotazioneStep2=o,this.contrattoAccettatto=!o)}set _recaptchaAttiva(o){null!=o&&(this.recaptchaAttiva=o,this.recaptchaResolved=!o)}set linguaPortaleAlbergo(o){if(null!=o&&o.oidAlbergo&&o.lingua){this.oidAlbergo=o.oidAlbergo,this.oidPortale=o.oidPortale,this.lingua=o.lingua;let n=new p.F0x;if(n.oidAlbergo=this.oidAlbergo,n.oidPortale=this.oidPortale,n.lingua=this.lingua,this.apiService.getPagamentoFormView(n).subscribe(c=>{if(this.carteCredito=c.data.tipiCarteCredito,this.immaginiCarteCredito=[],null!=this.carteCredito&&this.carteCredito.length>0){this.model.tipoCarta=this.carteCredito[0];for(let l of this.carteCredito)if(null!=l.tipoCartaCredito){let u=this.immaginiTipiCarteCredito.get(l.tipoCartaCredito);u&&!this.immaginiCarteCredito.includes(u)&&this.immaginiCarteCredito.push(u)}}this.newsLetterPortale=c.data.newsLetterPortale}),null==this.modalitaPagamento||0==this.modalitaPagamento.length){this.gettingModalitaPagamentoDefault=!0;let c=new p.X00;c.oidAlbergo=this.oidAlbergo,c.lingua=this.lingua,this.apiService.getModalitaPagamentoDefault(c).subscribe(l=>{this.modalitaPagamentoSet?this.gettingModalitaPagamentoDefault1||(this.modalitaPagamentoSet=!1):null!=l.data?(this.modalitaPagamento=[l.data],this.model.modalitaPagamento=l.data,this.calculateCaparra()):(this.modalitaPagamento=[],this.model.modalitaPagamento=new p.XL7(-1),this.noPaymentMethod.emit()),this.gettingModalitaPagamentoDefault=!1})}}}set _modalitaPagamento(o){if(null!=o)if(this.modalitaPagamento=o,this.modalitaPagamento.length>0){if((this.gettingModalitaPagamentoDefault||this.gettingModalitaPagamentoDefault1)&&(this.modalitaPagamentoSet=!0),null==this.model.modalitaPagamento||this.model.modalitaPagamento.paymentId<=0)this.model.modalitaPagamento=this.modalitaPagamento[0];else{let n=this.modalitaPagamento.find(c=>c.paymentId==this.model.modalitaPagamento.paymentId);this.model.modalitaPagamento=null==n?this.modalitaPagamento[0]:n}this.calculateCaparra()}else if(this.oidAlbergo>0&&this.lingua){this.gettingModalitaPagamentoDefault1=!0;let n=new p.X00;n.oidAlbergo=this.oidAlbergo,n.lingua=this.lingua,this.apiService.getModalitaPagamentoDefault(n).subscribe(c=>{this.modalitaPagamentoSet?this.gettingModalitaPagamentoDefault||(this.modalitaPagamentoSet=!1):null!=c.data?(this.modalitaPagamento=[c.data],this.model.modalitaPagamento=c.data,this.calculateCaparra()):(this.modalitaPagamento=[],this.model.modalitaPagamento=new p.XL7(-1),this.noPaymentMethod.emit()),this.gettingModalitaPagamentoDefault1=!1})}}set _formValid(o){this.formValid=o,this.checkPaypalButtonEnabled()}set _camere(o){null!=o&&(null==this.camere||JSON.stringify(o)!=JSON.stringify(this.camere))&&(this.camere=o,this.calculateCaparra())}set allModalitaPagamento(o){null!=o&&setTimeout(()=>{let n=o.find(q=>q.tipo==_.sc.PayPal);null!=n&&this.initPaypalConfig(n.paypalClientId);let c=o.find(q=>q.tipo==_.sc.Stripe);null!=c&&null!=document.getElementById("card-number-element")&&this.utilityService.loadExternalScript(this.STRIPE_JS_URL).then(()=>{this.stripe=Stripe(c.stripePublicKey);let q=this.stripe.elements();this.cardNumberElement=q.create("cardNumber",{placeholder:""}),this.cardNumberElement.mount("#card-number-element"),this.cardNumberElement.on("change",_t=>{_t.complete?this.stripeCardNumberValid=!0:_t.error&&(this.stripeCardNumberValid=!1),this.verifyValidity()});let zt=q.create("cardExpiry");zt.mount("#card-expiry-element"),zt.on("change",_t=>{_t.complete?this.stripeExpirationValid=!0:_t.error&&(this.stripeExpirationValid=!1),this.verifyValidity()});let Nt=q.create("cardCvc",{placeholder:""});Nt.mount("#card-cvc-element"),Nt.on("change",_t=>{_t.complete?this.stripeCvcValid=!0:_t.error&&(this.stripeCvcValid=!1),this.verifyValidity()})});let l=o.find(q=>q.tipo==_.sc.Satispay);null!=l&&this.utilityService.loadExternalScript(l.isTest?this.SATISPAY_BUTTON_URL_TEST:this.SATISPAY_BUTTON_URL,[{name:"data-payment-id",value:"test"}]),null!=o.find(q=>q.tipo==_.sc.SumUp)&&this.utilityService.loadExternalScript(this.SUMUP_WIDGET_URL),null!=o.find(q=>q.tipo==_.sc.AddonPayments)&&this.utilityService.loadExternalScript(this.ADDON_PAYMENTS_LIGHTBOX_URL);let Zt=o.find(q=>q.tipo==_.sc.Axepta);null!=Zt&&this.utilityService.loadExternalScript(Zt.isTest?this.AXEPTA_JS_URL_TEST:this.AXEPTA_JS_URL);let Vt=o.find(q=>q.tipo==_.sc.Holipay);null!=Vt&&this.utilityService.loadExternalScript(this.HOLIPAY_WIDGET_URL+Vt.holipayHotelId),null!=o.find(q=>q.tipo==_.sc.ScalaPay)&&(this.utilityService.loadExternalScript(this.SCALAPAY_ESM_WIDGET_URL,[new p.u$m("type","module")]),this.utilityService.loadExternalScript(this.SCALAPAY_WIDGET_URL,[new p.u$m("nomodule")]))},500)}set _caparra(o){this.caparra=o,this.calculateCaparra()}set _isCaparraPercentuale(o){this.isCaparraPercentuale=o,this.calculateCaparra()}set privacy(o){null!=o&&(this.model.privacy=o,this.verifyValidity())}set newsletter(o){null!=o&&(this.model.newsletter=o)}beforeUnloadHandler(o){null!=this.window&&this.window.close()}constructor(o,n,c,l){super(),this.apiService=o,this.containerService=n,this.utilityService=c,this.localStorage=l,this.testEnvironment="localhost",this.enumTipoModalitaPagamento=_.sc,this.model=new p.l_j,this.modalitaPagamento=[],this.gettingModalitaPagamentoDefault=!1,this.gettingModalitaPagamentoDefault1=!1,this.modalitaPagamentoSet=!1,this.immaginiCarteCredito=[],this.pagamentoSuccessUrl="https://booking."+("waf"==W.N.environmentName?"passstage":"passepartout")+".cloud/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl="https://booking."+("waf"==W.N.environmentName?"passstage":"passepartout")+".cloud/booking/pagamentoError?oidTransazione=",this.stripeCardNumberValid=!1,this.stripeExpirationValid=!1,this.stripeCvcValid=!1,this.immaginiTipiCarteCredito=new Map([[_.Cf.Visa,"/assets/images/booking/credit-card/visa.svg"],[_.Cf.AmericanExpress,"/assets/images/booking/credit-card/american-express.svg"],[_.Cf.MasterCard,"/assets/images/booking/credit-card/mastercard.svg"],[_.Cf.DiscoveryCard,"/assets/images/booking/credit-card/discover.svg"],[_.Cf.DinersClub,"/assets/images/booking/credit-card/diners.svg"],[_.Cf.JCB,"/assets/images/booking/credit-card/jcb.svg"],[_.Cf.EuroCard,""],[_.Cf.BankCard,""],[_.Cf.CarteBlanche,""],[_.Cf.CarteBleu,""],[_.Cf.UniversalAir,""],[_.Cf.Maestro,"/assets/images/booking/credit-card/maestro.svg"],[_.Cf.EnRoute,""],[_.Cf.AccessCard,""],[_.Cf.BankAmeriCard,""],[_.Cf.ChinaUnionPay,"/assets/images/booking/credit-card/unionpay.svg"],[_.Cf.Dankort,""],[_.Cf.DinersClub_USACanada,""],[_.Cf.InstaPayment,""],[_.Cf.Laser,""],[_.Cf.VisaElectron,""],[_.Cf.Sconosciuto,""]]),this.paymentSuccess=!1,this.descrizione="Prenotazione",this.elevation=!0,this.showCaparra=!0,this.fullWidthButton=!1,this.createOrder=new t.vpe,this.noPaymentMethod=new t.vpe,this.onPaymentError=new t.vpe,this.onCaparraChange=new t.vpe,this.satispayCompleted=!1,this.recaptchaAttiva=!1,this.recaptchaResolved=!0,this.isAccettaContrattoPrenotazioneStep2=!1,this.contrattoAccettatto=!0,this.axeptaPaymentResultReceived=!1,this.popupSuccess=!1,this.ADDONPAYMENTS_API_URL="https://hpp.addonpayments.com/pay",this.ADDONPAYMENTS_API_URL_TEST="https://hpp.sandbox.addonpayments.com/pay",this.ADDON_PAYMENTS_LIGHTBOX_URL="/assets/js/booking/rxp-hpp.js",this.SATISPAY_BUTTON_URL="https://online.satispay.com/web-button.js",this.SATISPAY_BUTTON_URL_TEST="https://staging.online.satispay.com/web-button.js",this.SUMUP_WIDGET_URL="https://gateway.sumup.com/gateway/ecom/card/v2/sdk.js",this.STRIPE_JS_URL="https://js.stripe.com/v3/",this.AXEPTA_JS_URL="https://pay.axepta.it/sdk/axepta-pg-sdk.js",this.AXEPTA_JS_URL_TEST="https://pay-sandbox.axepta.it/sdk/axepta-pg-sdk.js",this.HOLIPAY_WIDGET_URL="https://api.holipay.com/holipay.js?hotel_id=",this.SCALAPAY_WIDGET_URL="https://cdn.scalapay.com/widget/v3/js/scalapay-widget.js",this.SCALAPAY_ESM_WIDGET_URL="https://cdn.scalapay.com/widget/v3/js/scalapay-widget.esm.js"}ngOnInit(){window.addEventListener("message",o=>{"https://staging.online.satispay.com"!=o.origin&&"https://online.satispay.com"!=o.origin||null==o.data||"webButtonEvent"!=o.data.type?("axepta_SUCCESS_message"==o.data||"axepta_FAILURE_message"==o.data||"Axepta3dsClosed"==o.data)&&!this.axeptaPaymentResultReceived&&this.checkAxeptaMessage(o):"close"==o.data.action&&setTimeout(()=>{this.satispayCompleted?this.satispayCompleted=!1:this.satispayPaymentId&&this.cancelSatispayOrder(!1).then(()=>{},()=>{})},500)},!1),this.localStorageSub=this.localStorage.observe("popupCheckSuccess").subscribe(()=>{null!=this.window&&(this.popupSuccess=!0,this.openPaymentWindow(!0))}),this.testEnvironment&&this.isLocalhost&&("localhost"==this.testEnvironment?(this.pagamentoSuccessUrl=window.location.origin+"/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl=window.location.origin+"/booking/pagamentoError?oidTransazione="):"waf"==this.testEnvironment&&(this.pagamentoSuccessUrl="https://booking.passstage.cloud/booking/pagamentoSuccess?oidTransazione=",this.pagamentoErrorUrl="https://booking.passstage.cloud/booking/pagamentoError?oidTransazione="))}checkAxeptaMessage(o){this.axeptaPaymentResultReceived=!0,"axepta_SUCCESS_message"==o.data?setTimeout(()=>{this.dialog.close(),this.createOrder.emit(this.model)},2e3):"axepta_FAILURE_message"==o.data?setTimeout(()=>{this.dialog.close(),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit("")},2e3):"Axepta3dsClosed"==o.data&&(this.dialog.close(),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""))}initPaypalConfig(o){this.payPalConfig={clientId:o,currency:"EUR",style:{label:"pay",shape:"pill",color:"gold",layout:"horizontal",tagline:!1},createOrderOnServer:n=>this.createPaypalOrder(),authorizeOnServer:(n,c)=>this.capturePaypalOrder().then(l=>{this.createOrder.emit(this.model)},l=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l)}),onApprove:(n,c)=>{},onCancel:(n,c)=>{},onError:n=>{},onClick:(n,c)=>{!this.formValid&&this.errorMessage||!this.paymentFormValid?!this.formValid&&this.errorMessage?this.showError(this.errorMessage):this.recaptchaResolved?this.showError("globals.messages.inserireDati"):this.showError("interfaces.pagamento-form.risolvereReCaptcha"):this.getImportoPagamento()<=0&&this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento")},onInit:(n,c)=>{this.paypalButton=c}}}reset(){this.model.codiceRiferimentoOperazione=null,null!=this.carteCredito&&this.carteCredito.length>0&&(this.model.tipoCarta=this.carteCredito[0]),this.model.numeroCarta=null,this.model.codiceSicurezza=null,this.model.scadenzaCartaMese=null,this.model.scadenzaCartaAnno=null,this.model.titolareCarta=null,this.verifyValidity()}verifyValidity(){this.model.privacy&&this.recaptchaResolved&&this.contrattoAccettatto?this.model.modalitaPagamento.tipo==_.sc.CartaCredito?this.model.titolareCarta&&this.model.numeroCarta&&this.model.codiceSicurezza&&this.model.scadenzaCartaMese&&this.model.scadenzaCartaAnno&&null!=this.model.tipoCarta?this.paymentFormValid=!0:this.paymentFormValid=!1:this.model.modalitaPagamento.tipo==_.sc.Stripe?this.paymentFormValid=this.stripeCardNumberValid&&this.stripeExpirationValid&&this.stripeCvcValid:this.model.modalitaPagamento.tipo==_.sc.BonificoBancario?this.paymentFormValid=!this.isVisualizzaCRO||!!this.model.codiceRiferimentoOperazione:this.paymentFormValid=!0:this.paymentFormValid=!1,this.checkPaypalButtonEnabled()}openPrivacyDialog(){this.setIsLoading(!0);let o=new p.YZY;o.oidPortale=this.oidPortale,o.lingua=this.lingua,this.apiService.getPrivacyPortale(o).subscribe(n=>{this.setIsLoading(!1),this.openPrivacyNewsletterDialog(n.data)})}openNewsletterDialog(){this.openPrivacyNewsletterDialog(this.newsLetterPortale)}openPrivacyNewsletterDialog(o){o.html?this.openDialog(!0,null,o.html):o.url&&this.utilityService.openUrlInNewTab(o.url)}openCondizioniContrattoDialog(){this.openDialog(!0,null,this.condizioniContratto)}openCroDialog(){this.openDialog(!1,"interfaces.pagamento-form.croTitle","interfaces.pagamento-form.croText")}openDialog(o,n,c){let l=new p.Zpt;this.containerService.dimension.width>=992?l.width="50vw":l.width="80vw";let ft=this.showModalDialog(rt,l).componentInstance;ft.html=o,ft.title=n,ft.text=c}pay(){this.getImportoPagamento()>0?this.model.modalitaPagamento.tipo==_.sc.BancaSella?this.createTransaction().then(()=>{this.encryptGestPayOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.XPay?this.arrivo&&this.partenza?this.createTransaction().then(()=>{this.createXPayReservation().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction()})}):this.createTransaction().then(()=>{this.createXPayOrder().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction()})}):this.model.modalitaPagamento.tipo==_.sc.Satispay?this.createSatispayOrder().then(o=>{this.satispayPaymentId=o.transaction_id,SatispayWebButton.configure({paymentId:o.transaction_id,completed:()=>{this.satispayCompleted=!0,this.verifySatispayOrder().then(c=>{"KO"==c.payment_status?(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(c.payment_status),this.setIsLoading(!1)):"OK"==c.payment_status&&this.createOrder.emit(this.model)},c=>{this.cancelSatispayOrder().then(()=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(c)},l=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l)})})}}).open()},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)}):this.model.modalitaPagamento.tipo==_.sc.Stripe?(this.setIsLoading(!0),this.stripe.createPaymentMethod({type:"card",card:this.cardNumberElement}).then(o=>{null!=o.paymentMethod?this.model.modalitaPagamento.isUsePost?this.createTransaction().then(()=>{this.checkPayment(),this.stripePayment(o.paymentMethod.id)}):this.stripePayment(o.paymentMethod.id).then(n=>{null!=n.error?(n.error.message?this.showError(n.error.message):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(n.error),this.setIsLoading(!1)):null!=n.paymentIntent&&this.createOrder.emit(this.model)},()=>{}):null!=o.error&&(o.error.message?this.showError(o.error.message):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error.message),this.setIsLoading(!1))})):this.model.modalitaPagamento.tipo==_.sc.PayWay?this.createTransaction().then(()=>{this.createPayWayOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.Unicredit?this.createTransaction().then(()=>{this.createUnicreditOrder().then(o=>{this.setTransactionId(o.transaction_id).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.CartaCredito?this.isVerificaCartaCredito?this.verificaCartaCredito().then(()=>{this.createOrder.emit(this.model)},()=>{this.showError("interfaces.pagamento-form.cartaCreditoNonValida")}):this.createOrder.emit(this.model):this.model.modalitaPagamento.tipo==_.sc.AddonPayments?this.openLightBoxAddonPayments():this.model.modalitaPagamento.tipo==_.sc.BeSafePay?this.createTransaction().then(()=>{this.createBeSafePayOrder().then(o=>{this.openWindow(o.redirect_url)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.SumUp?this.createSumUpOrder().then(o=>{this.openIFrameSumUp()},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)}):this.model.modalitaPagamento.tipo==_.sc.Hobex?(this.setIsLoading(!0),this.apiService.payment(p.sK_.getHobexCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.hobexEntityId,this.model.modalitaPagamento.hobexAccessToken,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,"EUR",this.model.modalitaPagamento.tipoContabilizzazione==_.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.transaction_id?this.createTransaction(o.transaction_id).then(()=>{this.checkPayment(),this.openIFrameHobex(o.transaction_id)}):(this.setIsLoading(!1),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error))})):this.model.modalitaPagamento.tipo==_.sc.Axepta?(this.setIsLoading(!0),this.apiService.payment(p.sK_.getAxeptaCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.axeptaApiKey,this.model.modalitaPagamento.axeptaAccessToken,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN","EUR",this.model.modalitaPagamento.tipoContabilizzazione==_.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.transaction_id?(this.setIsLoading(!1),this.openAxeptaModal(o.transaction_id)):(this.setIsLoading(!1),this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error))})):this.model.modalitaPagamento.tipo==_.sc.Holipay?this.createTransaction().then(()=>{this.apiService.payment(p.sK_.getHolipayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.holipayHotelId,this.model.modalitaPagamento.holipaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest)).subscribe(o=>{o.success&&o.redirect_url?this.openWindow(o.redirect_url):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error),this.deleteTransaction(),this.setIsLoading(!1))})}):this.model.modalitaPagamento.tipo==_.sc.Siapay?this.createTransaction().then(()=>{this.apiService.payment(p.sK_.getSiapayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.siapayShopId,this.model.modalitaPagamento.siapaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"ITA":"EN",this.model.modalitaPagamento.tipoContabilizzazione==_.XI.Immediata?"I":"D")).subscribe(o=>{o.success&&o.redirect_url?this.openWindow(o.redirect_url):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.error),this.deleteTransaction(),this.setIsLoading(!1))})}):this.model.modalitaPagamento.tipo==_.sc.ScalaPay?this.createTransaction().then(()=>{this.createScalaPayOrder().then(o=>{this.setTransactionId(this.model.modalitaPagamento.scalaPayApiKey+" "+o.token).then(()=>{this.openWindow(o.redirect_url)})},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.VirtualPay?this.createTransaction().then(()=>{this.createVirtualPayOrder().then(o=>{this.openWindow(o.redirect_url)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo==_.sc.MyPOS?this.createTransaction().then(()=>{this.createMyPOSOrder().then(o=>{this.openWindow(null,o.form)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o),this.deleteTransaction(),this.setIsLoading(!1)})}):this.model.modalitaPagamento.tipo!=_.sc.PayPal&&this.createOrder.emit(this.model):this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento")}stripePayment(o){return new Promise((n,c)=>{this.apiService.payment(p.sK_.getStripeCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.stripeSecretKey,this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,this.descrizione,"EUR",this.model.modalitaPagamento.tipoContabilizzazione==_.XI.Differita)).subscribe(l=>{l.success&&l.transaction_id&&l.client_secret?this.stripe.confirmCardPayment(l.client_secret,{payment_method:o}).then(u=>{n(u)}):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(l.error),this.deleteTransaction(),this.setIsLoading(!1),c())})})}openLightBoxAddonPayments(){this.getConfigAddonPayments().then(o=>{RealexHpp.setHppUrl(this.model.modalitaPagamento.isTest?this.ADDONPAYMENTS_API_URL_TEST:this.ADDONPAYMENTS_API_URL),RealexHpp.lightbox.init("autoload",this.addonPaymentsCallback.bind(this),o.config)},o=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o)})}addonPaymentsCallback(o,n){null!=o&&o.MERCHANT_ID&&o.ORDER_ID&&"00"==o.RESULT?this.createOrder.emit(this.model):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.MESSAGE)),n()}onPopupCheckFail(){this.localStorage.set("popupCheckFailed",!0),this.setIsLoading(!1);let o=new p.Zpt,n=this.showModalDialog(T,o),c=n.componentInstance;c.paymentUrl=this.windowUrl,c.dialogRef=n,n.afterClosed().subscribe(l=>{null!=l?(this.setIsLoading(!0),this.window=l,this.openPaymentWindow(!1)):this.deleteTransaction()})}openWindow(o,n){this.setIsLoading(!0),o?this.windowUrl=o:n&&(this.localStorage.set("paymentForm",n),this.windowUrl=window.location.origin+"/booking/paymentForm"),this.popupSuccess=!1,this.localStorage.set("popupCheckFailed",!1),this.window=window.open(window.location.origin+"/booking/popupCheck","_blank"),null==this.window?this.onPopupCheckFail():setTimeout(()=>{this.popupSuccess||this.onPopupCheckFail()},5e3)}openPaymentWindow(o){o&&(this.window.location.href=this.windowUrl),this.window.focus();let n=setInterval(()=>{null!=this.window?this.window.closed&&(clearInterval(this.interval),clearInterval(n),this.paymentSuccess?this.createOrder.emit(this.model):(this.deleteTransaction(),this.setIsLoading(!1)),this.window=null):clearInterval(n)},1e3);this.checkPayment()}openIFrameSumUp(){let o=new p.Zpt;this.containerService.dimension.width>=992?o.width="80vw":o.width="100vw",o.disableClose=!0,o.panelClass="no-padding-overflow-dialog",o.maxHeight="100vh";let n=this.showModalDialog(rt,o),c=n.componentInstance;c.sumupTransactionId=this.sumupTransactionId,c.lingua=this.lingua,c.dialogRef=n,n.afterClosed().subscribe(l=>{l?this.verifySumUpOrder().then(u=>{"KO"==u.payment_status?(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""),this.setIsLoading(!1)):"OK"==u.payment_status&&this.createOrder.emit(this.model)},u=>{this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(u),this.setIsLoading(!1)}):(this.showError("interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(""),this.setIsLoading(!1))})}openIFrameHobex(o){let n=new p.Zpt;n.disableClose=!0,n.panelClass="no-padding-overflow-dialog",n.minHeight="0vh",this.dialog=this.showModalDialog(rt,n);let c=this.dialog.componentInstance;c.hobexTransactionId=o,c.paymentSuccessUrl=this.getSuccessUrl(),c.isTest=this.model.modalitaPagamento.isTest,c.lingua=this.lingua,c.dialogRef=this.dialog,this.dialog.afterClosed().subscribe(l=>{this.dialog=null,l?(clearInterval(this.interval),this.createOrder.emit(this.model)):(this.deleteTransaction(),this.setIsLoading(!1))})}openAxeptaModal(o){let n=new p.Zpt;n.disableClose=!0,n.panelClass="no-padding-overflow-dialog",n.minHeight="0vh",this.dialog=this.showModalDialog(rt,n);let c=this.dialog.componentInstance;c.axeptaTransactionId=o,c.axeptaApiKeySmartCheckout=this.model.modalitaPagamento.axeptaApiKeySmartCheckout,c.isTest=this.model.modalitaPagamento.isTest,this.axeptaPaymentResultReceived=!1,this.dialog.afterClosed().subscribe(()=>this.dialog=null)}createPaypalOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getPaypalCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.paypalClientId,this.model.modalitaPagamento.paypalSecretKey,this.getImportoPagamento(),this.model.modalitaPagamento.isTest,this.descrizione,"it"==this.lingua?"it-IT":"en-US");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?(this.paypalTransactionId=u.transaction_id,this.paypalToken=u.token,n(u.transaction_id)):c(u.error),this.setIsLoading(!1)})})}capturePaypalOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getPaypalCaptureRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.paypalClientId,this.model.modalitaPagamento.paypalSecretKey,this.paypalTransactionId,this.paypalToken,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}encryptGestPayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getGestpayEncryptRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.gestpayShopId,this.model.modalitaPagamento.gestpayApiKey,this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}createXPayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getXPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.xPayAlias,this.model.modalitaPagamento.xPaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}createXPayReservation(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getXPayCreateReservationRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.xPayAlias,this.model.modalitaPagamento.xPaySecretKey,this.utilityService.getEnumKeyOriginal(_.$w,this.model.modalitaPagamento.xPayTipoPrenotazione),this.model.modalitaPagamento.xPayCodiceStruttura,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}getConfigAddonPayments(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getAddonPaymentsConfigurationRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.addonPaymentsMerchantId,this.model.modalitaPagamento.addonPaymentsSecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}createSatispayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getSatispayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.getImportoPagamento(),this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}verifySatispayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getSatispayVerifyRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.satispayPaymentId,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error)})})}cancelSatispayOrder(o=!0){return new Promise((c,l)=>{o&&this.setIsLoading(!0);let u=p.sK_.getSatispayCancelRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.satispayKeyId,this.satispayPaymentId,this.model.modalitaPagamento.isTest);this.apiService.payment(u).subscribe(ft=>{ft.success?c(ft):l(ft.error),o&&this.setIsLoading(!1)})})}createPayWayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getPayWayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.payWayTerminalId,this.model.modalitaPagamento.payWaySecretKey,this.getSuccessUrl(),this.getErrorUrl(),this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?n(u):c(u.error)})})}createUnicreditOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getUnicreditCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.unicreditTerminalId,this.model.modalitaPagamento.unicreditSecretKey,this.getSuccessUrl(),this.getErrorUrl(),this.getImportoPagamento(),this.model.oidTransazione,this.model.modalitaPagamento.isTest,"it"==this.lingua?"IT":"EN");this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?n(u):c(u.error)})})}createBeSafePayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getBeSafePayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.beSafePayApiKey,this.getImportoPagamento(),this.descrizione,this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione);this.apiService.payment(l).subscribe(u=>{u.success&&u.redirect_url?n(u):c(u.error)})})}createSumUpOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getSumUpCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.sumUpMerchantId,this.model.modalitaPagamento.sumUpClientId,this.model.modalitaPagamento.sumUpSecretKey,this.getImportoPagamento(),this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.transaction_id?(this.sumupTransactionId=u.transaction_id,this.sumupToken=u.token,n(u.transaction_id)):c(u.error),this.setIsLoading(!1)})})}verifySumUpOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getSumUpVerifyRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.sumupToken,this.sumupTransactionId,this.model.modalitaPagamento.sumUpClientId,this.model.modalitaPagamento.sumUpSecretKey,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success?n(u):c(u.error),this.setIsLoading(!1)})})}createScalaPayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getScalaPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.scalaPayApiKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.token&&u.redirect_url?n(u):c(u.error)})})}createVirtualPayOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getVirtualPayCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.virtualPayMerchantId,this.model.modalitaPagamento.virtualPayABI,this.model.modalitaPagamento.virtualPaySecretKey,this.getImportoPagamento(),this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione);this.apiService.payment(l).subscribe(u=>{u.success&&u.redirect_url?n(u):c(u.error)})})}createMyPOSOrder(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=p.sK_.getMyPOSCreateRQ(this.oidAlbergo,this.oidPortale,this.model.modalitaPagamento.paymentId,this.cliente,this.lingua,this.arrivo,this.partenza,this.camere,this.extras,this.note,this.oidCodicePromozione,this.oidMotivoViaggio,this.model.modalitaPagamento.caparraTotale,this.model.privacy,this.model.newsletter,this.bookingSolutionUid,this.model.modalitaPagamento.myPOSWalletNumber,this.model.modalitaPagamento.myPOSSID,this.model.modalitaPagamento.myPOSKeyIndex,this.getImportoPagamento(),this.lingua,this.descrizione,this.getSuccessUrl(),this.getErrorUrl(),this.model.oidTransazione,this.model.modalitaPagamento.isTest);this.apiService.payment(l).subscribe(u=>{u.success&&u.form?n(u):c(u.error)})})}verificaCartaCredito(){return new Promise((n,c)=>{this.setIsLoading(!0);let l=new p.vMP;l.oidAlbergo=this.oidAlbergo,l.oidPortaleXAlbergo=this.oidPortale,l.intestatarioCC=this.model.titolareCarta,l.numeroCC=this.model.numeroCarta,l.tipoCartaCC=null!=this.model.tipoCarta?this.model.tipoCarta.nome:"",l.annoCC=this.model.scadenzaCartaAnno,l.meseCC=this.model.scadenzaCartaMese,l.codiceSicurezzaCC=this.model.codiceSicurezza,this.apiService.verificaCartaCredito(l).subscribe(u=>{null!=u.data&&null!=u.data.tipoEsito&&0==u.data.tipoEsito?n():c(),this.setIsLoading(!1)})})}onModalitaPagamentoChange(){this.calculateCaparra(),this.reset()}calculateCaparra(){if(null!=this.model.modalitaPagamento)if(this.showCaparra){if(this.caparra>0)this.isCaparraPercentuale?this.model.modalitaPagamento.caparraTotale=this.totale*this.caparra/100:this.model.modalitaPagamento.caparraTotale=this.caparra;else if(this.model.modalitaPagamento.numeroNottiCaparra>0&&null!=this.camere){let o=Math.min(this.model.modalitaPagamento.numeroNottiCaparra,2);this.model.modalitaPagamento.caparraTotale=0;for(let n of this.camere){let c=n.tariffa?.giorni;if(null!=c&&c.length>0)for(let l=0;l<Math.min(o,c.length);l++){let u=null!=c[l].prezzoScontato&&c[l].prezzoScontato>0?c[l].prezzoScontato:c[l].prezzo;this.model.modalitaPagamento.caparraTotale+=u}}}else this.model.modalitaPagamento.caparra>0?this.model.modalitaPagamento.isCaparraPercentuale?this.model.modalitaPagamento.caparraTotale=Math.max(this.totale*this.model.modalitaPagamento.caparra/100,this.model.modalitaPagamento.importoMinimoCaparra):this.model.modalitaPagamento.isCaparraPerCamera&&null!=this.camere?this.model.modalitaPagamento.caparraTotale=this.model.modalitaPagamento.caparra*this.camere.length:this.model.modalitaPagamento.caparraTotale=this.model.modalitaPagamento.caparra:this.model.modalitaPagamento.caparraTotale=0;this.model.modalitaPagamento.caparraTotale=Math.min(this.model.modalitaPagamento.caparraTotale,this.totale)}else this.model.modalitaPagamento.caparraTotale=0;this.checkPaypalButtonEnabled(),this.onCaparraChange.emit(this.model.modalitaPagamento.caparraTotale),this.refreshHolipayWidget()}splitDataScadenza(){if(this.dataScadenza){let o=this.dataScadenza.split("/");if(2==o.length)try{this.model.scadenzaCartaMese=parseInt(o[0],10),this.model.scadenzaCartaAnno=parseInt(o[1],10),isNaN(this.model.scadenzaCartaMese)&&(this.model.scadenzaCartaMese=null),isNaN(this.model.scadenzaCartaAnno)&&(this.model.scadenzaCartaAnno=null)}catch{}}}createTransaction(o){return new Promise(n=>{this.setIsLoading(!0);let c=new f.LHu;c.data=this.getDate(O(),"YYYY-MM-DD HH:mm:ss"),c.statoEsecuzione=_.g_.NonEseguito,c.albergo=new f.Z$(this.oidAlbergo),c.importo=this.getImportoPagamento(),c.idTransazione=o,this.apiService.updateTransazione(c).subscribe(l=>{this.model.oidTransazione=l.data.obj.oid,n()})})}setTransactionId(o){return new Promise(n=>{if(this.model.oidTransazione>0){let c=new f.LHu(this.model.oidTransazione);c.idTransazione=o,this.apiService.updateTransazione(c).subscribe(()=>{n()})}else n()})}deleteTransaction(){this.model.oidTransazione>0&&(this.model.oidTransazione=null)}checkPayment(){this.paymentSuccess=!1,this.model.isPrenotazioneCreata=!1,this.interval=setInterval(()=>{this.model.oidTransazione>0?this.apiService.getTransazione(this.model.oidTransazione,!1).subscribe(o=>{null!=o.data&&(o.data.statoEsecuzione==_.g_.Eseguito?(this.model.isPrenotazioneCreata=o.data.isPrenotazioneCreata,this.model.codicePrenotazione=o.data.prenotazione?.codiceOTA,null!=this.window?(this.paymentSuccess=!0,this.window.close()):null!=this.dialog?this.dialog.close(!0):(clearInterval(this.interval),this.createOrder.emit(this.model))):o.data.statoEsecuzione==_.g_.Errore?(null!=this.window?(this.paymentSuccess=!1,this.window.close()):null!=this.dialog?this.dialog.close():(this.deleteTransaction(),this.setIsLoading(!1)),this.showError(o.data.descrizioneEsito?o.data.descrizioneEsito:"interfaces.pagamento-form.impossibileEffettuarePagamento"),this.onPaymentError.emit(o.data.descrizioneEsito)):o.data.statoEsecuzione==_.g_.Annullato&&(null!=this.window?(this.paymentSuccess=!1,this.window.close()):null!=this.dialog?this.dialog.close():(this.deleteTransaction(),this.setIsLoading(!1))))}):clearInterval(this.interval)},5e3)}getSuccessUrl(){return this.pagamentoSuccessUrl+this.model.oidTransazione+"&oidModalitaPagamento="+this.model.modalitaPagamento.paymentId+"&oidPortale="+this.oidPortale}getErrorUrl(){return this.pagamentoErrorUrl+this.model.oidTransazione+"&oidModalitaPagamento="+this.model.modalitaPagamento.paymentId+"&oidPortale="+this.oidPortale}getImportoPagamento(){return this.model.modalitaPagamento.caparraTotale>0?this.model.modalitaPagamento.caparraTotale:this.totale}checkPaypalButtonEnabled(){null!=this.paypalButton&&(this.formValid&&this.paymentFormValid&&this.getImportoPagamento()>0?this.paypalButton.enable():this.paypalButton.disable())}refreshHolipayWidget(){this.model.modalitaPagamento.tipo==_.sc.Holipay&&setTimeout(()=>{holipay.updateWidgets()},200)}ngOnDestroy(){this.localStorageSub.unsubscribe()}}mt.\u0275fac=function(o){return new(o||mt)(t.Y36(w.s),t.Y36(Z.J),t.Y36(F.t),t.Y36(it.n))},mt.\u0275cmp=t.Xpm({type:mt,selectors:[["app-pagamento-form"]],hostBindings:function(o,n){1&o&&t.NdJ("beforeunload",function(l){return n.beforeUnloadHandler(l)},!1,t.Jf7)},inputs:{_totale:"_totale",_isAccettaContrattoPrenotazioneStep2:"_isAccettaContrattoPrenotazioneStep2",isVerificaCartaCredito:"isVerificaCartaCredito",isVisualizzaCRO:"isVisualizzaCRO",condizioniContratto:"condizioniContratto",descrizione:"descrizione",disabled:"disabled",elevation:"elevation",_recaptchaAttiva:"_recaptchaAttiva",linguaPortaleAlbergo:"linguaPortaleAlbergo",_modalitaPagamento:"_modalitaPagamento",cliente:"cliente",errorMessage:"errorMessage",_formValid:"_formValid",arrivo:"arrivo",partenza:"partenza",_camere:"_camere",extras:"extras",allModalitaPagamento:"allModalitaPagamento",showCaparra:"showCaparra",_caparra:"_caparra",_isCaparraPercentuale:"_isCaparraPercentuale",fullWidthButton:"fullWidthButton",note:"note",oidCodicePromozione:"oidCodicePromozione",oidMotivoViaggio:"oidMotivoViaggio",valuta:"valuta",bookingSolutionUid:"bookingSolutionUid",privacy:"privacy",newsletter:"newsletter"},outputs:{createOrder:"createOrder",noPaymentMethod:"noPaymentMethod",onPaymentError:"onPaymentError",onCaparraChange:"onCaparraChange"},features:[t.qOj],decls:35,vars:34,consts:[[3,"hidden"],[1,"pagamento-container","border","p-3",3,"ngClass"],[1,"w-100","text-center",3,"ngClass"],[1,"color-light-blue","mr-4","align-middle","font-weight-bold"],[1,"align-middle","pagamento-form-modalita-select"],["required","",1,"pagamento-form-select",3,"panelClass","ngModel","disabled","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"pt-2","pb-4",3,"hidden"],[1,"stripe-label"],["id","card-number-element",1,"border","rounded","mt-1","p-1"],[1,"row","mt-2"],[1,"col-6"],["id","card-expiry-element",1,"border","rounded","mt-1","p-1"],["id","card-cvc-element",1,"border","rounded","mt-1","p-1"],["class","mt-4 d-table mx-auto",4,"ngIf"],["class","w-100 text-center mt-4",4,"ngIf"],[1,"text-center",3,"hidden"],[3,"config"],[3,"value"],["class","mb-3",4,"ngIf"],[1,"mb-3"],[3,"_text"],[1,"d-inline-block","align-middle","mr-1"],[1,"font-weight-bold","d-inline-block","align-middle"],["type","checkout"],[1,"row"],[3,"ngClass"],[1,"col-12","col-sm-6"],[1,"w-100"],["required","",1,"pagamento-form-select",3,"panelClass","ngModel","placeholder","disabled","ngModelChange"],["autocompleteOff","","matInput","","required","",3,"ngModel","placeholder","readOnly","disabled","ngModelChange"],["cardNumberInput",""],["securityCodeInput",""],["expirationDateInput",""],["nameInput",""],["class","col-4 d-none d-md-block",4,"ngIf"],["class","mt-3 mb-3",4,"ngIf"],[1,"mt-3","mb-3"],["class","carta-credito-image mr-1 ml-1",3,"src",4,"ngFor","ngForOf"],[1,"carta-credito-image","mr-1","ml-1",3,"src"],[1,"col-4","d-none","d-md-block"],[1,"border","rounded-lg","p-3"],[1,"mt-3"],["src","/assets/images/booking/norton.svg",1,"norton-image"],["src","/assets/images/booking/pci.svg",1,"pci-image","float-right"],[1,"mb-4","mt-3"],[3,"nameInput","cardNumberInput","expirationDateInput","securityCodeInput"],[1,"row",3,"ngClass"],["class","col-12 col-sm-6",4,"ngIf"],["class","row",4,"ngIf"],[1,"align-middle","font-weight-bold"],[1,"align-middle"],[1,"col-12","col-sm-8"],["autocompleteOff","","matInput","",3,"ngModel","placeholder","readOnly","disabled","ngModelChange"],["class","col-4 d-none d-sm-block",4,"ngIf"],[1,"col-4","d-none","d-sm-block"],["href","#",1,"d-inline-block","mt-3",3,"click"],["required","",1,"pagamento-form-checkbox",3,"ngModel","disabled","change","ngModelChange"],["href","#",1,"checkbox","privacyLink",3,"click"],["class","pagamento-form-checkbox","required","",3,"ngModel","disabled","change","ngModelChange",4,"ngIf"],["class","checkbox",4,"ngIf"],["class","checkbox condizioniContrattoLink","href","#",3,"click",4,"ngIf"],[1,"checkbox"],["href","#",1,"checkbox","condizioniContrattoLink",3,"click"],[1,"pagamento-form-checkbox",3,"ngModel","disabled","change","ngModelChange"],["class","checkbox newsletterLink","href","#",3,"click",4,"ngIf"],["href","#",1,"checkbox","newsletterLink",3,"click"],[1,"mt-4","d-table","mx-auto"],[3,"siteKey","resolved"],[1,"w-100","text-center","mt-4"],["mat-flat-button","","class","button-blue paga-button",3,"ngClass","disabled","click",4,"ngIf"],["mat-flat-button","",1,"button-blue","paga-button",3,"ngClass","disabled","click"],[1,"material-icons","align-middle","mr-1","icon-small"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"mat-form-field",4)(7,"mat-select",5),t.NdJ("ngModelChange",function(l){return n.model.modalitaPagamento=l})("ngModelChange",function(){return n.onModalitaPagamentoChange()}),t.YNc(8,m,2,2,"mat-option",6),t.qZA()()(),t.YNc(9,d,5,4,"ng-container",7),t.YNc(10,Rt,31,37,"div",7),t.YNc(11,Lt,7,8,"div",7),t.TgZ(12,"div",8)(13,"div",9),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"div",10),t.TgZ(17,"div",11)(18,"div",12)(19,"div",9),t._uU(20),t.ALo(21,"translate"),t.qZA(),t._UZ(22,"div",13),t.qZA(),t.TgZ(23,"div",12)(24,"div",9),t._uU(25),t.ALo(26,"translate"),t.qZA(),t._UZ(27,"div",14),t.qZA()()(),t.YNc(28,z,5,5,"div",7),t.YNc(29,St,2,1,"div",7),t.YNc(30,pt,4,4,"div",7),t.qZA(),t.YNc(31,Ft,2,1,"div",15),t.YNc(32,Dt,2,1,"div",16),t.TgZ(33,"div",17),t._UZ(34,"ngx-paypal",18),t.qZA()()),2&o&&(t.Q6J("hidden",n.model.modalitaPagamento.paymentId<=0),t.xp6(1),t.Q6J("ngClass",t.VKq(30,ut,n.elevation)),t.xp6(1),t.Q6J("ngClass",t.VKq(32,It,!n.disabled||n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.CartaCredito||n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.BonificoBancario)),t.xp6(2),t.hij(" ",t.lcZ(5,22,"interfaces.pagamento-form.metodoPagamento")," "),t.xp6(3),t.Q6J("panelClass","booking-select")("ngModel",n.model.modalitaPagamento)("disabled",n.disabled),t.xp6(1),t.Q6J("ngForOf",n.modalitaPagamento),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.CartaCredito&&!n.disabled),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.CartaCredito),t.xp6(1),t.Q6J("ngIf",n.model.modalitaPagamento.tipo==n.enumTipoModalitaPagamento.BonificoBancario),t.xp6(1),t.Q6J("hidden",n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.Stripe||n.disabled),t.xp6(2),t.hij(" ",t.lcZ(15,24,"interfaces.pagamento-form.numero")," "),t.xp6(6),t.hij(" ",t.lcZ(21,26,"interfaces.pagamento-form.scadenza")," "),t.xp6(5),t.hij(" ",t.lcZ(26,28,"interfaces.pagamento-form.codiceSicurezza")," "),t.xp6(3),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("ngIf",n.recaptchaAttiva&&!n.disabled),t.xp6(1),t.Q6J("ngIf",!n.disabled),t.xp6(1),t.Q6J("hidden",n.disabled||n.model.modalitaPagamento.tipo!=n.enumTipoModalitaPagamento.PayPal),t.xp6(1),t.Q6J("config",n.payPalConfig))},dependencies:[J.X,M.mk,M.sg,M.O5,P.Fj,P.JJ,P.Q7,P.On,at.FC,ht.e_,Q.eB,lt.v_,H.k0,X.CK,D.x8,nt.nu,dt.wT,L.W,G.G,ct.f,E.A,M.JJ,R.X$],styles:[".checkbox[_ngcontent-%COMP%]{white-space:normal!important}  .buttons-container{display:none!important}  .pagamento-form-select.mat-select-disabled .mat-select-value{color:#000000de!important}.pagamento-container[_ngcontent-%COMP%]{border-radius:5px;background-color:#fff}  .pagamento-form-checkbox .mat-checkbox-inner-container{margin-top:5px!important;margin-right:15px!important}  .pagamento-form-modalita-select .mat-form-field-infix{border-top:0!important}  .pagamento-form-modalita-select .mat-form-field-flex{border:1px solid #dddddd!important;border-radius:7px!important;padding-left:.25rem!important;padding-right:.25rem!important}  .pagamento-form-modalita-select .mat-form-field-underline{visibility:hidden!important}  .pagamento-form-modalita-select .mat-form-field-wrapper{padding-bottom:0!important}.paga-button[_ngcontent-%COMP%]{min-width:200px;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.privacyLink[_ngcontent-%COMP%], .privacyLink[_ngcontent-%COMP%]:hover, .newsletterLink[_ngcontent-%COMP%], .newsletterLink[_ngcontent-%COMP%]:hover, .condizioniContrattoLink[_ngcontent-%COMP%], .condizioniContrattoLink[_ngcontent-%COMP%]:hover{color:#004987!important}.info-icon[_ngcontent-%COMP%]{top:7px;right:0;font-size:18px;line-height:18px;color:#004987}.icon-small[_ngcontent-%COMP%]{font-size:20px}.norton-image[_ngcontent-%COMP%]{width:60px}.pci-image[_ngcontent-%COMP%]{width:40px}.carta-credito-image[_ngcontent-%COMP%]{width:60px}.addonPaymentsButton[_ngcontent-%COMP%]{visibility:hidden!important;width:0!important;height:0!important}.stripe-label[_ngcontent-%COMP%]{font-size:13px}"]})},5742:(Ct,$,v)=>{v.d($,{A:()=>O});var t=v(5879);class O{transform(f,p,_){return f.replace(new RegExp(p,"g"),_)}}O.\u0275fac=function(f){return new(f||O)},O.\u0275pipe=t.Yjl({name:"replace",type:O,pure:!0})},4186:(Ct,$)=>{var t=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],O=["address","article","aside","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","nav","noscript","ol","output","p","pre","section","table","tbody","tfoot","thead","tr","ul","video"],N=["audio","math","svg","video"],f=10,p=33,_=34,W=38,F=39,M=47,P=59,L=60,R=61,B=62,j=/[<&\n\ud800-\udbff]/,tt=/[<&\ud800-\udbff]/,st=/\s+/g;function A(g,T){for(var w=g.length,Z=T;Z<w;Z++)if(et(g.charCodeAt(Z)))return Z;return w}function I(g){return g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122}function U(g,T){var w=g.charCodeAt(T);if(w===f)return!0;if(w===L){var Z="("+O.join("|")+"|br)";return new RegExp("^<"+Z+"[\t\n\f\r ]*/?>","i").test(g.slice(T))}return!1}function et(g){return 9===g||10===g||12===g||13===g||32===g}function yt(g){for(var T=g.length-1;T>=0;T--){var w=g[T];if("li"===w||"td"===w)return!1;if("ol"===w||"table"===w||"ul"===w)return!0}return!1}function gt(g){return g.trim().replace(st," ")}function rt(g,T){var w=g.charCodeAt(T);if(55296==(64512&w)){var Z=g.charCodeAt(T+1);if(56320==(64512&Z))return String.fromCharCode(w,Z)}return String.fromCharCode(w)}$.Z=function S(g,T,w){return void 0===w&&(w={}),g?(g=g.toString(),w.html?function y(g,T,w){for(var Z=w.imageWeight,it=void 0===Z?2:Z,J=w.indicator,at=void 0===J?"\u2026":J,ht=w.maxLines,lt=void 0===ht?1/0:ht,H=w.stripTags,X=void 0!==H&&H,D=at.length,nt=1,dt="boolean"==typeof X?function(){return X}:function(ut){return X.includes(ut)},G=[],ct=function(ut){for(var mt;void 0!==(mt=G.pop());)dt(mt)||(ut+="</"+mt+">");return ut},E=0,m=-1,e=g.length;E<e;E++){var i=E?g.slice(E):g,a=yt(G),s=m>-1||a?tt:j,d=i.search(s),h=d>-1?d:i.length;if(-1===m)if(a){var b=gt(h===i.length?i:i.slice(0,d));if(dt(G[G.length-1])){var x=E>0&&!et(g.charCodeAt(E-1)),k=!et(g.charCodeAt(E+h));b.length>0?b=(x?" ":"")+b+(k?" ":""):x&&k&&(b=" "),g=g.slice(0,E)+b+g.slice(E+h),h=b.length}if((D+=b.length)>T)break}else if((D+=h)>T){E=Math.max(E+h-D+T,0);break}if(E+=h,-1===d)break;if((V=g.charCodeAt(E))===L){var ot=(K=g.charCodeAt(E+1))===p;if(ot&&"--"===g.substr(E+2,2))E=g.indexOf("--\x3e",E+4)+3-1;else if(ot&&"[CDATA["===g.substr(E+2,7)){E=g.indexOf("]]>",E+9)+3-1}else{var wt=K===M;if(D===T&&!wt){D++;break}for(var Et=0,Y=E,vt=!1;;){if(++Y>=e)throw new Error("Invalid HTML: "+g);var Pt=g.charCodeAt(Y);if(vt)Et?Pt===Et&&(vt=!1):et(Pt)?vt=!1:Pt===B&&(vt=!1,Y--);else if(Pt===R){for(;et(g.charCodeAt(Y+1));)Y++;vt=!0;var Mt=g.charCodeAt(Y+1);Mt===_||Mt===F?(Et=Mt,Y++):Et=0}else if(Pt===B){var It=E+(wt?2:1),Lt=Math.min(A(g,It),Y);(z=g.slice(It,Lt).toLowerCase()).charCodeAt(z.length-1)===M&&(z=z.slice(0,z.length-1));var kt=dt(z);if(wt){if(G.pop()!==z)throw new Error("Invalid HTML: "+g);if(N.includes(z)&&!N.some(function(ut){return G.includes(ut)}))if(kt)E=m,m=-1;else if(m=-1,(D+=it)>T)break;if(O.includes(z)&&-1===m&&!kt&&++nt>lt){G.push(z);break}}else if(t.includes(z)||g.charCodeAt(Y-1)===M){if(!kt)if("br"===z){if(++nt>lt)break}else if("img"===z&&(D+=it)>T)break}else N.some(function(ut){return G.includes(ut)})||N.includes(z)&&(m=E),G.push(z);kt&&-1===m?(g=g.slice(0,E)+g.slice(Y+1),E--):E=Y;break}}if(D>T||nt>lt)break}}else if(V===W){Y=E+1;for(var St=!0;;){var Ot=g.charCodeAt(Y);if(!I(Ot)){if(Ot===P)break;St=!1;break}Y++}if(-1===m&&++D>T)break;St&&(E=Y)}else if(V===f){if(++D>T||++nt>lt)break}else{if(-1===m&&++D>T)break;var K;if(55296==(64512&V))56320==(64512&(K=g.charCodeAt(E+1)))&&E++}}if(D>T){var bt=function Q(g,T){var w=rt(g,T);if("&"===w)for(;;){T++;var Z=g.charCodeAt(T);if(!I(Z)){if(Z===P){w+=String.fromCharCode(Z);break}break}w+=String.fromCharCode(Z)}return w}(g,E);if(at){for(var pt=E+bt.length;g.charCodeAt(pt)===L&&g.charCodeAt(pt+1)===M;){var Ft=g.indexOf(">",pt+2)+1;if(!Ft)break;pt=Ft}pt&&(pt===g.length||U(g,pt))&&(E+=bt.length,bt=g.charAt(E))}for(;"<"===bt&&g.charCodeAt(E+1)===M;){var z;if(!(z=G.pop()))break;var At=g.indexOf(">",E+2);if(-1===At||g.slice(E+2,At).trim()!==z)throw new Error("Invalid HTML: "+g);dt(z)?g=g.slice(0,E)+g.slice(At+1):E=At+1,bt=g.charAt(E)}if(E<g.length){if(!w.breakWords)for(var xt=E-at.length;xt>=0;xt--){var V;if((V=g.charCodeAt(xt))===B||V===P)break;if(V===f||V===L){E=xt;break}if(et(V)){E=xt+(at?1:0);break}}var Dt=g.slice(0,E);return U(g,E)||(Dt+=at),ct(Dt)}}else if(nt>lt)return ct(g.slice(0,E));return g}(g,T,w):function C(g,T,w){for(var Z=w.indicator,it=void 0===Z?"\u2026":Z,J=w.maxLines,at=void 0===J?1/0:J,ht=it.length,lt=1,H=0,X=g.length;H<X&&!(++ht>T);H++){if((D=g.charCodeAt(H))===f){if(++lt>at)break}else if(55296==(64512&D)){56320==(64512&g.charCodeAt(H+1))&&H++}}if(ht>T){var dt=rt(g,H);if(it){var G=H+dt.length;if(G===g.length)return g;if(g.charCodeAt(G)===f)return g.slice(0,H+dt.length)}if(!w.breakWords)for(var ct=H-it.length;ct>=0;ct--){var D;if((D=g.charCodeAt(ct))===f){H=ct,dt="\n";break}if(et(D)){H=ct+(it?1:0);break}}return g.slice(0,H)+("\n"===dt?"":it)}if(lt>at)return g.slice(0,H);return g}(g,T,w)):""}}}]);